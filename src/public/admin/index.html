<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UBMAX - Painel ADM Frota</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    // ========================================
    // NOVA CORRIDA MANUAL
    // ========================================
    async function criarCorridaManual(e) {
      e.preventDefault();
      const dados = {
        cliente_telefone: document.getElementById('nc-telefone').value,
        cliente_nome: document.getElementById('nc-nome').value,
        origem_endereco: document.getElementById('nc-origem').value,
        destino_endereco: document.getElementById('nc-destino').value,
        observacoes: document.getElementById('nc-obs').value
      };
      
      try {
        const resp = await fetch('/api/admin/corrida-manual', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify(dados)
        });
        if (resp.ok) {
          alert('âœ… Corrida criada com sucesso!');
          document.getElementById('form-nova-corrida').reset();
        } else {
          alert('âŒ Erro ao criar corrida');
        }
      } catch(err) {
        alert('âŒ Erro: ' + err.message);
      }
    }

    // ========================================
    // CHAT DA FROTA (ADM)
    // ========================================
    async function carregarChatADM() {
      try {
        const resp = await fetch('/api/admin/chat?limite=50', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        });
        const data = await resp.json();
        const container = document.getElementById('chat-mensagens');
        if (data.mensagens && data.mensagens.length > 0) {
          container.innerHTML = data.mensagens.map(m => 
            '<div style="padding: 8px; margin-bottom: 8px; background: ' + (m.remetente_tipo === 'admin' ? '#e0f2fe' : '#f0fdf4') + '; border-radius: 8px;">' +
            '<strong>' + (m.remetente_nome || 'ADM') + '</strong>: ' + m.mensagem +
            '<br><small style="color: #64748b;">' + new Date(m.created_at).toLocaleString() + '</small></div>'
          ).join('');
        } else {
          container.innerHTML = '<p style="text-align: center; color: #64748b;">Nenhuma mensagem ainda</p>';
        }
      } catch(err) {
        console.error('Erro ao carregar chat:', err);
      }
    }

    async function enviarMensagemChatADM() {
      const input = document.getElementById('chat-input');
      const mensagem = input.value.trim();
      if (!mensagem) return;

      try {
        await fetch('/api/admin/chat', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify({ mensagem })
        });
        input.value = '';
        carregarChatADM();
      } catch(err) {
        alert('Erro ao enviar: ' + err.message);
      }
    }

    async function enviarBroadcast() {
      const mensagem = prompt('Digite a mensagem para TODOS os motoristas:');
      if (!mensagem) return;

      try {
        await fetch('/api/admin/chat/broadcast', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify({ mensagem })
        });
        alert('âœ… Broadcast enviado!');
        carregarChatADM();
      } catch(err) {
        alert('Erro: ' + err.message);
      }
    }

    // ========================================
    // ASSISTÃŠNCIA 24H
    // ========================================
    async function carregarAssistencia() {
      try {
        const resp = await fetch('/api/admin/assistencia', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        });
        const data = await resp.json();
        const tbody = document.getElementById('tabela-assistencia');
        if (data.contatos && data.contatos.length > 0) {
          tbody.innerHTML = data.contatos.map(c => 
            '<tr>' +
            '<td>' + c.tipo + '</td>' +
            '<td>' + c.nome + '</td>' +
            '<td>' + c.telefone + '</td>' +
            '<td><button class="btn btn-sm btn-danger" onclick="excluirContato(' + c.id + ')">ğŸ—‘ï¸</button></td>' +
            '</tr>'
          ).join('');
        } else {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhum contato cadastrado</td></tr>';
        }
      } catch(err) {
        console.error('Erro ao carregar assistÃªncia:', err);
      }
    }

    function abrirModalNovoContato() {
      const tipo = prompt('Tipo (guincho/mecanico/borracheiro/eletricista/seguro):');
      const nome = prompt('Nome do contato:');
      const telefone = prompt('Telefone:');
      if (tipo && nome && telefone) {
        fetch('/api/admin/assistencia', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify({ tipo, nome, telefone })
        }).then(() => {
          alert('âœ… Contato adicionado!');
          carregarAssistencia();
        });
      }
    }

    async function excluirContato(id) {
      if (!confirm('Excluir este contato?')) return;
      await fetch('/api/admin/assistencia/' + id, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      });
      carregarAssistencia();
    }

    // ========================================
    // AVARIAS
    // ========================================
    async function carregarAvarias() {
      try {
        const resp = await fetch('/api/admin/avarias', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        });
        const data = await resp.json();
        const tbody = document.getElementById('tabela-avarias');
        if (data.avarias && data.avarias.length > 0) {
          tbody.innerHTML = data.avarias.map(a => 
            '<tr>' +
            '<td>' + new Date(a.data_ocorrencia).toLocaleDateString() + '</td>' +
            '<td>' + (a.motorista_nome || '-') + '</td>' +
            '<td>' + a.tipo + '</td>' +
            '<td>' + (a.descricao || '-').substring(0, 50) + '</td>' +
            '<td>R$ ' + (a.valor_prejuizo || 0).toFixed(2) + '</td>' +
            '<td><span class="badge badge-' + (a.status === 'resolvido' ? 'success' : 'warning') + '">' + a.status + '</span></td>' +
            '</tr>'
          ).join('');
        } else {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhuma avaria registrada</td></tr>';
        }
      } catch(err) {
        console.error('Erro ao carregar avarias:', err);
      }
    }
  </script>

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --bg-body: #f8fafc;
      --bg-card: #ffffff;
      --bg-sidebar: #1e293b;
      --text-primary: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --radius: 12px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-body); color: var(--text-primary); display: flex; min-height: 100vh; }
    
    /* SIDEBAR */
    .sidebar { width: 260px; height: 100vh; background: var(--bg-sidebar); position: fixed; left: 0; top: 0; display: flex; flex-direction: column; z-index: 100; }
    .sidebar-header { padding: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .logo-text { font-size: 24px; font-weight: 700; color: white; }
    .logo-subtitle { font-size: 12px; color: #94a3b8; margin-top: 4px; }
    .sidebar-nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; color: #94a3b8; border-radius: 8px; margin-bottom: 4px; cursor: pointer; transition: all 0.2s; }
    .nav-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .nav-item.active { background: var(--primary); color: white; }
    .nav-badge { margin-left: auto; background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; }
    .sidebar-footer { padding: 16px 24px; border-top: 1px solid rgba(255,255,255,0.1); }
    .status-online { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--success); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); }
    
    /* MAIN */
    .main { flex: 1; margin-left: 260px; }
    .header { height: 70px; background: var(--bg-card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 32px; position: sticky; top: 0; z-index: 50; }
    .header h1 { font-size: 24px; font-weight: 600; }
    .header-actions { display: flex; gap: 12px; }
    .btn { padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; border: none; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-primary); }
    .btn-success { background: var(--success); color: white; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    
    .content { padding: 32px; }
    .page { display: none; }
    .page.active { display: block; }
    
    /* STATS */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
    .stat-card { background: var(--bg-card); border-radius: var(--radius); padding: 24px; border: 1px solid var(--border); }
    .stat-icon { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 12px; }
    .stat-icon.blue { background: rgba(59,130,246,0.1); }
    .stat-icon.green { background: rgba(16,185,129,0.1); }
    .stat-icon.yellow { background: rgba(245,158,11,0.1); }
    .stat-icon.purple { background: rgba(139,92,246,0.1); }
    .stat-value { font-size: 28px; font-weight: 700; }
    .stat-label { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
    
    /* CARDS */
    .card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 24px; }
    .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .card-header h2 { font-size: 16px; font-weight: 600; }
    .card-body { padding: 24px; }
    
    /* MAPA */
    #mapa-motoristas { height: 500px; border-radius: var(--radius); }
    .motorista-marker { background: var(--primary); color: white; padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; white-space: nowrap; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    .motorista-marker.online { background: var(--success); }
    .motorista-marker.em-corrida { background: var(--info); }
    .motorista-marker.offline { background: #64748b; }
    
    /* LISTA MOTORISTAS NO MAPA */
    .mapa-sidebar { position: absolute; top: 10px; right: 10px; width: 280px; background: white; border-radius: var(--radius); box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 1000; max-height: calc(100% - 20px); overflow: hidden; }
    .mapa-sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); font-weight: 600; }
    .mapa-sidebar-body { max-height: 400px; overflow-y: auto; }
    .motorista-item { padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: background 0.2s; }
    .motorista-item:hover { background: var(--bg-body); }
    .motorista-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px; }
    .motorista-info { flex: 1; }
    .motorista-nome { font-weight: 500; font-size: 14px; }
    .motorista-local { font-size: 12px; color: var(--text-muted); }
    .motorista-status { width: 10px; height: 10px; border-radius: 50%; }
    .motorista-status.online { background: var(--success); }
    .motorista-status.em-corrida { background: var(--info); }
    .motorista-status.offline { background: #cbd5e1; }
    
    /* TABELAS */
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border); }
    .table th { font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); background: var(--bg-body); }
    .table tbody tr:hover { background: var(--bg-body); }
    .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
    .status-online { background: rgba(16,185,129,0.1); color: var(--success); }
    .status-offline { background: rgba(100,116,139,0.1); color: var(--text-muted); }
    .status-em-corrida { background: rgba(59,130,246,0.1); color: var(--info); }
    
    /* FORMS */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text-muted); }
    .form-input { width: 100%; padding: 12px 16px; background: var(--bg-body); border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
    .form-input:focus { outline: none; border-color: var(--primary); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
    
    /* SWITCH */
    .switch-group { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-body); border-radius: 8px; margin-bottom: 12px; }
    .switch-label { font-size: 14px; font-weight: 500; }
    .switch-desc { font-size: 12px; color: var(--text-muted); }
    .switch { position: relative; width: 48px; height: 26px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .switch-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #cbd5e1; border-radius: 26px; transition: 0.3s; }
    .switch-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; border-radius: 50%; transition: 0.3s; }
    .switch input:checked + .switch-slider { background: var(--success); }
    .switch input:checked + .switch-slider:before { transform: translateX(22px); }
    
    /* MODAL */
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: var(--radius); width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .modal-header h3 { font-size: 18px; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted); }
    .modal-body { padding: 24px; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end; }
    
    /* BADGES */
    .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
    .badge-success { background: rgba(16,185,129,0.1); color: #10b981; }
    .badge-warning { background: rgba(245,158,11,0.1); color: #f59e0b; }
    .badge-danger { background: rgba(239,68,68,0.1); color: #ef4444; }
    .badge-primary { background: rgba(99,102,241,0.1); color: #6366f1; }
    
    /* RESPONSIVE */
    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main { margin-left: 0; }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo-text" id="sidebar-nome-empresa">ğŸš— UBMAX</div>
      <div class="logo-subtitle">Painel Administrativo</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="mostrarPagina('dashboard', this)">ğŸ“Š Dashboard</div>
      <div class="nav-item" onclick="mostrarPagina('mapa', this)">ğŸ—ºï¸ Mapa em Tempo Real</div>
      <div class="nav-item" onclick="mostrarPagina('motoristas', this)">ğŸš˜ Motoristas <span class="nav-badge">8</span></div>
      <div class="nav-item" onclick="mostrarPagina('mensalidades', this)">ğŸ’° Mensalidades</div>
      <div class="nav-item" onclick="mostrarPagina('corridas', this)">ğŸ“ Corridas</div>
      <div class="nav-item" onclick="mostrarPagina('nova-corrida', this)">â• Nova Corrida</div>
      <div class="nav-item" onclick="mostrarPagina('chat', this)">ğŸ’¬ Chat Frota</div>
      <div class="nav-item" onclick="mostrarPagina('assistencia', this)">ğŸ”§ AssistÃªncia 24h</div>
      <div class="nav-item" onclick="mostrarPagina('avarias', this)">âš ï¸ Avarias</div>
      <div class="nav-item" onclick="mostrarPagina('clientes', this)">ğŸ‘¥ Clientes</div>
      <div class="nav-item" onclick="mostrarPagina('antifraude', this)">ğŸš¨ Anti-Fraude</div>
      <div class="nav-item" onclick="mostrarPagina('financeiro', this)">ğŸ’° Financeiro</div>
      <div class="nav-item" onclick="mostrarPagina('pagamentos', this)">ğŸ’³ Config. Pagamentos</div>
      <div class="nav-item" onclick="mostrarPagina('configuracoes', this)">âš™ï¸ ConfiguraÃ§Ãµes</div>
    </nav>
    <div class="sidebar-footer">
      <div class="status-online">
        <span class="status-dot"></span>
        <span>Sistema Online</span>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="header">
      <h1 id="page-title">Dashboard</h1>
      <div class="header-actions">
        <button class="btn btn-outline">ğŸ”„ Atualizar</button>
        <button class="btn btn-primary" onclick="abrirModalMotorista()">+ Novo Motorista</button>
      </div>
    </header>

    <div class="content">
      <!-- DASHBOARD -->
      <section id="page-dashboard" class="page active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon blue">ğŸ“</div>
            <div class="stat-value">24</div>
            <div class="stat-label">Corridas Hoje</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green">âœ…</div>
            <div class="stat-value">21</div>
            <div class="stat-label">Finalizadas</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon yellow">ğŸš˜</div>
            <div class="stat-value">5/8</div>
            <div class="stat-label">Motoristas Online</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon purple">ğŸ’°</div>
            <div class="stat-value">R$ 487,50</div>
            <div class="stat-label">Faturamento Hoje</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>ğŸš— Corridas em Andamento</h2>
            <span style="background: var(--info); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">3 ativas</span>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Cliente</th>
                  <th>Motorista</th>
                  <th>Origem â†’ Destino</th>
                  <th>Status</th>
                  <th>Valor</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>#127</td>
                  <td>Maria Silva</td>
                  <td>JoÃ£o Santos</td>
                  <td>Rua das Flores â†’ Shopping</td>
                  <td><span class="status status-em-corrida">Em Andamento</span></td>
                  <td>R$ 24,50</td>
                </tr>
                <tr>
                  <td>#126</td>
                  <td>Carlos Lima</td>
                  <td>Pedro Oliveira</td>
                  <td>Av. Brasil â†’ Terminal</td>
                  <td><span class="status status-em-corrida">A Caminho</span></td>
                  <td>R$ 18,00</td>
                </tr>
                <tr>
                  <td>#125</td>
                  <td>Ana Costa</td>
                  <td>Lucas Souza</td>
                  <td>Shopping â†’ Centro</td>
                  <td><span class="status status-em-corrida">Em Andamento</span></td>
                  <td>R$ 32,00</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- MAPA EM TEMPO REAL -->
      <section id="page-mapa" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ—ºï¸ LocalizaÃ§Ã£o dos Motoristas em Tempo Real</h2>
            <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">Atualizando a cada 5s</span>
          </div>
          <div class="card-body" style="padding: 0; position: relative;">
            <div id="mapa-motoristas"></div>
            
            <!-- Lista de Motoristas no Mapa -->
            <div class="mapa-sidebar">
              <div class="mapa-sidebar-header">ğŸ‘¥ Motoristas (5 online)</div>
              <div class="mapa-sidebar-body">
                <div class="motorista-item" onclick="focalizarMotorista(0)">
                  <div class="motorista-avatar" style="background: var(--success);">JS</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">JoÃ£o Santos</div>
                    <div class="motorista-local">ğŸ“ Centro - Em corrida #127</div>
                  </div>
                  <div class="motorista-status em-corrida"></div>
                </div>
                <div class="motorista-item" onclick="focalizarMotorista(1)">
                  <div class="motorista-avatar" style="background: var(--info);">PO</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">Pedro Oliveira</div>
                    <div class="motorista-local">ğŸ“ Av. Brasil - A caminho</div>
                  </div>
                  <div class="motorista-status em-corrida"></div>
                </div>
                <div class="motorista-item" onclick="focalizarMotorista(2)">
                  <div class="motorista-avatar" style="background: var(--info);">LS</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">Lucas Souza</div>
                    <div class="motorista-local">ğŸ“ Shopping - Em corrida</div>
                  </div>
                  <div class="motorista-status em-corrida"></div>
                </div>
                <div class="motorista-item" onclick="focalizarMotorista(3)">
                  <div class="motorista-avatar" style="background: var(--success);">ML</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">Marcos Lima</div>
                    <div class="motorista-local">ğŸ“ Terminal - DisponÃ­vel</div>
                  </div>
                  <div class="motorista-status online"></div>
                </div>
                <div class="motorista-item" onclick="focalizarMotorista(4)">
                  <div class="motorista-avatar" style="background: var(--success);">RC</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">Rafael Costa</div>
                    <div class="motorista-local">ğŸ“ PraÃ§a Central - DisponÃ­vel</div>
                  </div>
                  <div class="motorista-status online"></div>
                </div>
                <div class="motorista-item">
                  <div class="motorista-avatar" style="background: #94a3b8;">CS</div>
                  <div class="motorista-info">
                    <div class="motorista-nome">Carlos Silva</div>
                    <div class="motorista-local">Ãšltima vez: 2h atrÃ¡s</div>
                  </div>
                  <div class="motorista-status offline"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MOTORISTAS -->
      <section id="page-motoristas" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸš˜ Motoristas Cadastrados</h2>
            <button class="btn btn-primary btn-sm" onclick="abrirModalMotorista()">+ Novo Motorista</button>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr>
                  <th>Motorista</th>
                  <th>Telefone</th>
                  <th>VeÃ­culo</th>
                  <th>Status</th>
                  <th>Corridas</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="tabela-motoristas">
                <tr>
                  <td><strong>JoÃ£o Santos</strong><br><small style="color: var(--text-muted);">CNH: 12345678900</small></td>
                  <td>(14) 99999-1111</td>
                  <td>Fiat Uno Branco - ABC-1234</td>
                  <td><span class="status status-em-corrida">Em Corrida</span></td>
                  <td>156</td>
                  <td>
                    <button class="btn btn-sm btn-outline" onclick="editarMotorista(1)" title="Editar">âœï¸</button>
                    <button class="btn btn-sm btn-outline" onclick="localizarMotorista(1)" title="Localizar">ğŸ“</button>
                    <button class="btn btn-sm btn-outline" onclick="reenviarAcesso(1)" title="Reenviar Link">ğŸ”—</button>
                    <button class="btn btn-sm" style="background: #ef4444; color: white;" onclick="excluirMotorista(1, 'JoÃ£o Santos')" title="Excluir">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- MENSALIDADES -->
      <section id="page-mensalidades" class="page">
        <div id="alerta-vencimentos-hoje" style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 20px; display: none;">
          <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 50px; height: 50px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">ğŸ””</div>
            <div style="flex: 1;">
              <h3 style="margin: 0 0 4px; color: #92400e;">Vencimentos Hoje!</h3>
              <p style="margin: 0; color: #a16207;" id="texto-vencimentos-hoje">Motoristas com pagamento vencendo hoje.</p>
            </div>
            <button class="btn btn-sm" style="background: #f59e0b; color: white;" onclick="enviarLembretesHoje()">ğŸ“² Notificar Todos</button>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card" style="border-left: 4px solid #10b981;">
            <div class="stat-icon green">âœ…</div>
            <div class="stat-value" id="stat-mens-pagas">0</div>
            <div class="stat-label">Motoristas em Dia</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #f59e0b;">
            <div class="stat-icon yellow">â³</div>
            <div class="stat-value" id="stat-mens-pendentes">0</div>
            <div class="stat-label">Pendentes</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #ef4444;">
            <div class="stat-icon" style="background: rgba(239,68,68,0.1);">âŒ</div>
            <div class="stat-value" id="stat-mens-atrasadas">0</div>
            <div class="stat-label">Inadimplentes</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #6366f1;">
            <div class="stat-icon purple">ğŸ’°</div>
            <div class="stat-value" id="stat-mens-total">R$ 0</div>
            <div class="stat-label">Total a Receber</div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="gerarMensalidadesMes()">ğŸ“… Gerar Mensalidades</button>
          <button class="btn btn-outline" onclick="verificarVencimentosHoje()">ğŸ”” Ver Vencimentos Hoje</button>
          <button class="btn btn-outline" onclick="enviarLembretes()">ğŸ“² Enviar Lembretes</button>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>ğŸ’° Mensalidades dos Motoristas</h2>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr>
                  <th>Motorista</th>
                  <th>Valor</th>
                  <th>Vencimento</th>
                  <th>Status</th>
                  <th>AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody id="lista-mensalidades">
                <tr>
                  <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-muted);">Nenhuma mensalidade cadastrada</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CORRIDAS -->
      <section id="page-corridas" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ“ HistÃ³rico de Corridas</h2>
            <input type="date" class="form-input" style="width: 180px;">
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Cliente</th>
                  <th>Motorista</th>
                  <th>Origem â†’ Destino</th>
                  <th>Valor</th>
                  <th>Status</th>
                  <th>Data</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>#127</td>
                  <td>Maria Silva</td>
                  <td>JoÃ£o Santos</td>
                  <td>Rua das Flores â†’ Shopping</td>
                  <td>R$ 24,50</td>
                  <td><span class="status status-em-corrida">Em Andamento</span></td>
                  <td>10/01 14:32</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- NOVA CORRIDA -->
      <section id="page-nova-corrida" class="page">
        <div class="card">
          <div class="card-header">
            <h2>â• Nova Corrida Manual</h2>
          </div>
          <div class="card-body">
            <form id="form-nova-corrida" onsubmit="criarCorridaManual(event)">
              <div class="form-group">
                <label class="form-label">ğŸ“ Telefone do Cliente</label>
                <input type="tel" id="nc-telefone" class="form-input" placeholder="(14) 99999-9999" required>
              </div>
              <div class="form-group">
                <label class="form-label">ğŸ‘¤ Nome do Cliente</label>
                <input type="text" id="nc-nome" class="form-input" placeholder="Nome do cliente" required>
              </div>
              <div class="form-group">
                <label class="form-label">ğŸ“ EndereÃ§o de Origem</label>
                <input type="text" id="nc-origem" class="form-input" placeholder="Rua, nÃºmero, bairro" required>
              </div>
              <div class="form-group">
                <label class="form-label">ğŸ EndereÃ§o de Destino</label>
                <input type="text" id="nc-destino" class="form-input" placeholder="Rua, nÃºmero, bairro" required>
              </div>
              <div class="form-group">
                <label class="form-label">ğŸ’¬ ObservaÃ§Ãµes</label>
                <textarea id="nc-obs" class="form-input" rows="2" placeholder="ObservaÃ§Ãµes..."></textarea>
              </div>
              <button type="submit" class="btn btn-primary" style="width: 100%;">ğŸš— Criar Corrida</button>
            </form>
          </div>
        </div>
      </section>

      <!-- CHAT -->
      <section id="page-chat" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ’¬ Chat da Frota</h2>
          </div>
          <div class="card-body">
            <div id="chat-mensagens" style="height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 16px; background: #f8fafc;"></div>
            <div style="display: flex; gap: 12px;">
              <input type="text" id="chat-input" class="form-input" placeholder="Digite sua mensagem..." style="flex: 1;">
              <button class="btn btn-primary" onclick="enviarMensagemChatADM()">ğŸ“¤ Enviar</button>
              <button class="btn btn-success" onclick="enviarBroadcast()">ğŸ“¢ Broadcast</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ASSISTENCIA -->
      <section id="page-assistencia" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ”§ AssistÃªncia 24h</h2>
            <button class="btn btn-primary btn-sm" onclick="abrirModalNovoContato()">â• Novo Contato</button>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr><th>Tipo</th><th>Nome</th><th>Telefone</th><th>AÃ§Ãµes</th></tr>
              </thead>
              <tbody id="tabela-assistencia">
                <tr><td colspan="4" style="text-align: center;">Nenhum contato cadastrado</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- AVARIAS -->
      <section id="page-avarias" class="page">
        <div class="card">
          <div class="card-header">
            <h2>âš ï¸ Registro de Avarias</h2>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr><th>Data</th><th>Motorista</th><th>Tipo</th><th>DescriÃ§Ã£o</th><th>Valor</th><th>Status</th></tr>
              </thead>
              <tbody id="tabela-avarias">
                <tr><td colspan="6" style="text-align: center;">Nenhuma avaria registrada</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CLIENTES -->
      <section id="page-clientes" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ‘¥ Clientes Cadastrados</h2>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr><th>Nome</th><th>Telefone</th><th>Corridas</th><th>Ãšltima Corrida</th></tr>
              </thead>
              <tbody>
                <tr><td>Maria Silva</td><td>(14) 98765-4321</td><td>12</td><td>10/01/2026</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ANTI-FRAUDE -->
      <section id="page-antifraude" class="page">
        <div class="stats-grid">
          <div class="stat-card" style="border-left: 4px solid #ef4444;">
            <div class="stat-icon" style="background: rgba(239,68,68,0.2);">ğŸš¨</div>
            <div class="stat-value" id="af-criticos">0</div>
            <div class="stat-label">Alertas CrÃ­ticos</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #f59e0b;">
            <div class="stat-icon" style="background: rgba(245,158,11,0.2);">âš ï¸</div>
            <div class="stat-value" id="af-atencao">0</div>
            <div class="stat-label">AtenÃ§Ã£o</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #10b981;">
            <div class="stat-icon green">âœ…</div>
            <div class="stat-value" id="af-ok">0</div>
            <div class="stat-label">Motoristas OK</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #6366f1;">
            <div class="stat-icon purple">ğŸ‘ï¸</div>
            <div class="stat-value" id="af-total">0</div>
            <div class="stat-label">Total Alertas</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>ğŸš¨ Motoristas com Alertas</h2>
            <button class="btn btn-primary btn-sm" onclick="verificarTodosAntiFraude()">ğŸ”„ Verificar Agora</button>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr><th>Motorista</th><th>Score</th><th>Alertas</th><th>RecomendaÃ§Ã£o</th><th>AÃ§Ãµes</th></tr>
              </thead>
              <tbody id="lista-antifraude">
                <tr><td colspan="5" style="text-align: center; padding: 40px;">âœ… Nenhum motorista com alertas</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 20px;">
          <div class="card" style="padding: 16px; text-align: center;">
            <div style="font-size: 28px;">â°</div>
            <div style="font-size: 24px; font-weight: 700;" id="af-tipo-atrasos">0</div>
            <div style="font-size: 12px; color: var(--text-muted);">Atrasos</div>
          </div>
          <div class="card" style="padding: 16px; text-align: center;">
            <div style="font-size: 28px;">âŒ</div>
            <div style="font-size: 24px; font-weight: 700;" id="af-tipo-cancelamentos">0</div>
            <div style="font-size: 12px; color: var(--text-muted);">Cancelamentos</div>
          </div>
          <div class="card" style="padding: 16px; text-align: center;">
            <div style="font-size: 28px;">ğŸ“</div>
            <div style="font-size: 24px; font-weight: 700;" id="af-tipo-gps">0</div>
            <div style="font-size: 12px; color: var(--text-muted);">GPS Suspeito</div>
          </div>
          <div class="card" style="padding: 16px; text-align: center;">
            <div style="font-size: 28px;">â­</div>
            <div style="font-size: 24px; font-weight: 700;" id="af-tipo-nota">0</div>
            <div style="font-size: 12px; color: var(--text-muted);">Nota Baixa</div>
          </div>
        </div>
      </section>

      <!-- FINANCEIRO -->
      <section id="page-financeiro" class="page">
        <div class="stats-grid">
          <div class="stat-card" style="border-left: 4px solid #10b981;">
            <div class="stat-icon green">ğŸ’°</div>
            <div class="stat-value" id="fin-faturamento">R$ 0</div>
            <div class="stat-label">Faturamento</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #3b82f6;">
            <div class="stat-icon blue">ğŸ“ˆ</div>
            <div class="stat-value" id="fin-entradas">R$ 0</div>
            <div class="stat-label">Entradas</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #ef4444;">
            <div class="stat-icon" style="background: rgba(239,68,68,0.1);">ğŸ“‰</div>
            <div class="stat-value" id="fin-saidas">R$ 0</div>
            <div class="stat-label">SaÃ­das</div>
          </div>
          <div class="stat-card" style="border-left: 4px solid #8b5cf6;">
            <div class="stat-icon purple">ğŸ’</div>
            <div class="stat-value" id="fin-lucro">R$ 0</div>
            <div class="stat-label">Lucro</div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; margin-bottom: 20px;">
          <button class="btn btn-success" onclick="abrirModalFinanceiro('entrada')">â• Entrada</button>
          <button class="btn btn-danger" onclick="abrirModalFinanceiro('saida')">â– SaÃ­da</button>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>ğŸ“‹ LanÃ§amentos</h2>
          </div>
          <div class="card-body" style="padding: 0;">
            <table class="table">
              <thead>
                <tr><th>Data</th><th>Tipo</th><th>DescriÃ§Ã£o</th><th>Valor</th><th>AÃ§Ãµes</th></tr>
              </thead>
              <tbody id="lista-financeiro">
                <tr><td colspan="5" style="text-align: center;">Nenhum lanÃ§amento</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- PAGAMENTOS -->
      <section id="page-pagamentos" class="page">
        <div class="card">
          <div class="card-header">
            <h2>ğŸ’³ ConfiguraÃ§Ãµes de Pagamento</h2>
          </div>
          <div class="card-body">
            <h4 style="margin-bottom: 16px;">ğŸ’µ Formas de Pagamento</h4>
            <div class="switch-group">
              <div><div class="switch-label">ğŸ’µ Dinheiro</div></div>
              <label class="switch"><input type="checkbox" checked><span class="switch-slider"></span></label>
            </div>
            <div class="switch-group">
              <div><div class="switch-label">ğŸ’³ CartÃ£o</div></div>
              <label class="switch"><input type="checkbox" checked><span class="switch-slider"></span></label>
            </div>
            <div class="switch-group">
              <div><div class="switch-label">ğŸ“± PIX</div></div>
              <label class="switch"><input type="checkbox" checked><span class="switch-slider"></span></label>
            </div>
            <hr style="margin: 24px 0;">
            <h4 style="margin-bottom: 16px;">ğŸ’° Valores</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Valor Fixo</label>
                <input type="text" class="form-input" value="R$ 13,00">
              </div>
              <div class="form-group">
                <label class="form-label">Valor por KM</label>
                <input type="text" class="form-input" value="R$ 2,50">
              </div>
            </div>
            <button class="btn btn-success" style="margin-top: 16px;">ğŸ’¾ Salvar</button>
          </div>
        </div>
      </section>

      <!-- CONFIGURAÃ‡Ã•ES -->
      <section id="page-configuracoes" class="page">
        <div class="card">
          <div class="card-header">
            <h2>âš™ï¸ ConfiguraÃ§Ãµes</h2>
          </div>
          <div class="card-body">
            <div style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px solid #3b82f6; border-radius: 16px; padding: 20px; margin-bottom: 24px;">
              <h4 style="margin: 0 0 16px; color: #1e40af;">ğŸ“± Telefones do Sistema</h4>
              <div class="form-group">
                <label class="form-label">ğŸ‘¤ WhatsApp do Dono</label>
                <input type="text" class="form-input" id="config-telefone-adm" placeholder="5514999990001">
              </div>
              <div class="form-group">
                <label class="form-label">ğŸ¤– WhatsApp da Rebeca</label>
                <input type="text" class="form-input" id="config-telefone-rebeca" placeholder="5514999990002">
              </div>
              <div style="display: flex; gap: 12px;">
                <button class="btn btn-sm" style="background: #3b82f6; color: white;" onclick="salvarTelefonesSistema()">ğŸ’¾ Salvar</button>
                <button class="btn btn-sm btn-outline" onclick="testarNotificacaoADM()">ğŸ“² Testar</button>
              </div>
            </div>

            <h4 style="margin-bottom: 16px;">ğŸ¢ Dados da Empresa</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Nome da Empresa</label>
                <input type="text" class="form-input" id="config-nome-empresa" value="UBMAX">
              </div>
              <div class="form-group">
                <label class="form-label">Cidade</label>
                <input type="text" class="form-input" id="config-cidade" value="Lins - SP">
              </div>
            </div>

            <hr style="margin: 24px 0;">

            <h4 style="margin-bottom: 16px;">ğŸ’° Mensalidade PadrÃ£o</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Valor PadrÃ£o</label>
                <input type="number" class="form-input" id="config-valor-mensalidade" value="150.00">
              </div>
              <div class="form-group">
                <label class="form-label">Dia de Vencimento</label>
                <select class="form-input" id="config-dia-vencimento">
                  <option value="5">Dia 5</option>
                  <option value="10" selected>Dia 10</option>
                  <option value="15">Dia 15</option>
                  <option value="20">Dia 20</option>
                </select>
              </div>
            </div>

            <button class="btn btn-success" style="margin-top: 16px;" onclick="salvarConfiguracoes()">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- MODAL NOVO MOTORISTA -->
  <div class="modal" id="modal-motorista">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3>â• Cadastrar Novo Motorista</h3>
        <button class="modal-close" onclick="fecharModalMotorista()">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="background: linear-gradient(135deg, #dbeafe, #eff6ff); border: 1px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 20px;">
          <p style="margin: 0; font-size: 14px; color: #1e40af;">ğŸš€ O motorista receberÃ¡ um link de acesso via WhatsApp!</p>
        </div>

        <h4 style="margin-bottom: 12px; color: var(--text-muted); font-size: 13px;">ğŸ‘¤ DADOS DO MOTORISTA</h4>
        <div class="form-group">
          <label class="form-label">Nome Completo *</label>
          <input type="text" class="form-input" id="mot-nome" placeholder="Ex: JoÃ£o da Silva">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">WhatsApp *</label>
            <input type="tel" class="form-input" id="mot-telefone" placeholder="14999990000">
          </div>
          <div class="form-group">
            <label class="form-label">CPF</label>
            <input type="text" class="form-input" id="mot-cpf" placeholder="000.000.000-00">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">CNH</label>
          <input type="text" class="form-input" id="mot-cnh" placeholder="00000000000">
        </div>

        <h4 style="margin: 20px 0 12px; color: var(--text-muted); font-size: 13px;">ğŸš— VEÃCULO</h4>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Modelo *</label>
            <input type="text" class="form-input" id="mot-veiculo" placeholder="Ex: Fiat Uno">
          </div>
          <div class="form-group">
            <label class="form-label">Cor *</label>
            <input type="text" class="form-input" id="mot-cor" placeholder="Ex: Branco">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Placa *</label>
            <input type="text" class="form-input" id="mot-placa" placeholder="ABC-1234">
          </div>
          <div class="form-group">
            <label class="form-label">Ano</label>
            <input type="number" class="form-input" id="mot-ano" placeholder="2020">
          </div>
        </div>

        <h4 style="margin: 20px 0 12px; color: var(--text-muted); font-size: 13px;">ğŸ’° MENSALIDADE</h4>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Valor *</label>
            <input type="number" class="form-input" id="mot-valor-mensalidade" value="150.00">
          </div>
          <div class="form-group">
            <label class="form-label">Tipo</label>
            <select class="form-input" id="mot-tipo-recorrencia" onchange="alternarTipoRecorrencia()">
              <option value="mensal">ğŸ“… Mensal</option>
              <option value="semanal">ğŸ“† Semanal</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group" id="grupo-dia-mes">
            <label class="form-label">Dia do Vencimento</label>
            <select class="form-input" id="mot-dia-vencimento">
              <option value="5">Dia 5</option>
              <option value="10" selected>Dia 10</option>
              <option value="15">Dia 15</option>
              <option value="20">Dia 20</option>
            </select>
          </div>
          <div class="form-group" id="grupo-dia-semana" style="display: none;">
            <label class="form-label">Dia da Semana</label>
            <select class="form-input" id="mot-dia-semana">
              <option value="1">Segunda</option>
              <option value="5" selected>Sexta</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" id="mot-status-inicial">
              <option value="ativo">âœ… Ativo</option>
              <option value="pendente">â³ Pendente</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="mot-tem-comissao" onchange="toggleComissao()">
            <span>Cobrar ComissÃ£o</span>
          </label>
          <div id="campo-comissao" style="display: none; margin-top: 8px;">
            <input type="number" class="form-input" id="mot-comissao" placeholder="15" value="15">
            <small style="color: var(--text-muted);">% por corrida</small>
          </div>
        </div>

        <div class="form-group">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="mot-enviar-whatsapp" checked>
            <span>ğŸ“± Enviar link de acesso via WhatsApp</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalMotorista()">Cancelar</button>
        <button class="btn btn-success" onclick="cadastrarMotorista()">âœ“ Cadastrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL SUCESSO -->
  <div class="modal" id="modal-sucesso-motorista">
    <div class="modal-content" style="max-width: 500px; text-align: center;">
      <div class="modal-body" style="padding: 40px;">
        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 40px;">âœ…</div>
        <h2 style="margin-bottom: 12px;">Motorista Cadastrado!</h2>
        <p style="color: var(--text-muted); margin-bottom: 24px;" id="msg-sucesso-motorista">Link enviado via WhatsApp.</p>
        <div style="background: #f1f5f9; border-radius: 8px; padding: 16px; text-align: left; margin-bottom: 20px;">
          <p style="margin: 0 0 8px; font-size: 13px; color: var(--text-muted);">Link de acesso:</p>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="form-input" id="link-acesso-motorista" readonly style="font-family: monospace; font-size: 12px;">
            <button class="btn btn-outline btn-sm" onclick="copiarLinkAcesso()">ğŸ“‹</button>
          </div>
        </div>
        <div style="display: flex; gap: 12px; justify-content: center;">
          <button class="btn btn-outline" onclick="fecharModalSucesso()">Fechar</button>
          <button class="btn btn-primary" onclick="fecharModalSucesso(); abrirModalMotorista();">+ Cadastrar Outro</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL FINANCEIRO -->
  <div class="modal" id="modal-financeiro">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="titulo-modal-fin">ğŸ’° Novo LanÃ§amento</h3>
        <button class="modal-close" onclick="fecharModalFinanceiro()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Tipo</label>
          <select class="form-input" id="fin-tipo" onchange="atualizarCategoriasFin()">
            <option value="entrada">ğŸ“ˆ Entrada</option>
            <option value="saida">ğŸ“‰ SaÃ­da</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Categoria</label>
          <select class="form-input" id="fin-categoria">
            <option value="corridas">ğŸš— Corridas</option>
            <option value="mensalidade">ğŸ’³ Mensalidade</option>
            <option value="outros">ğŸ“¦ Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">DescriÃ§Ã£o</label>
          <input type="text" class="form-input" id="fin-descricao" placeholder="DescriÃ§Ã£o...">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Valor (R$)</label>
            <input type="number" class="form-input" id="fin-valor" placeholder="0.00" step="0.01">
          </div>
          <div class="form-group">
            <label class="form-label">Data</label>
            <input type="date" class="form-input" id="fin-data">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">ObservaÃ§Ãµes</label>
          <textarea class="form-input" id="fin-obs" rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalFinanceiro()">Cancelar</button>
        <button class="btn btn-success" onclick="salvarLancamento()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // SISTEMA GPS UBMAX - SCRIPT PRINCIPAL
    // ==========================================
    
    var DB_KEY = 'zapcorridas_motoristas';
    var mapa;
    var mapaIniciado = false;
    var marcadores = {};
    var motoristas = [];

    // NavegaÃ§Ã£o entre pÃ¡ginas
    function mostrarPagina(pagina, elemento) {
      document.querySelectorAll('.nav-item').forEach(function(item) { item.classList.remove('active'); });
      document.querySelectorAll('.page').forEach(function(page) { page.classList.remove('active'); });
      
      if (elemento) elemento.classList.add('active');
      var pageEl = document.getElementById('page-' + pagina);
      if (pageEl) pageEl.classList.add('active');
      
      var titulos = {
        'dashboard': 'Dashboard',
        'mapa': 'Mapa em Tempo Real',
        'motoristas': 'Motoristas',
        'mensalidades': 'ğŸ’° Mensalidades',
        'corridas': 'Corridas',
        'nova-corrida': 'â• Nova Corrida',
        'chat': 'ğŸ’¬ Chat Frota',
        'assistencia': 'ğŸ”§ AssistÃªncia 24h',
        'avarias': 'âš ï¸ Avarias',
        'clientes': 'Clientes',
        'antifraude': 'ğŸš¨ Anti-Fraude',
        'financeiro': 'Financeiro',
        'pagamentos': 'Config. Pagamentos',
        'configuracoes': 'ConfiguraÃ§Ãµes'
      };
      document.getElementById('page-title').textContent = titulos[pagina] || pagina;
      
      if (pagina === 'mapa' && !mapaIniciado) {
        setTimeout(inicializarMapa, 100);
      }
      if (pagina === 'chat') carregarChatADM();
      if (pagina === 'assistencia') carregarAssistencia();
      if (pagina === 'avarias') carregarAvarias();
      if (pagina === 'antifraude') carregarAntiFraude();
      if (pagina === 'mensalidades') atualizarTabelaMensalidades();
      if (pagina === 'financeiro') atualizarTotaisFinanceiro();
    }
    
    // Inicializar banco
    function inicializarBanco() {
      var dados = localStorage.getItem(DB_KEY);
      if (!dados) {
        var motoristasIniciais = [
          { id: 1, nome: 'JoÃ£o Santos', iniciais: 'JS', telefone: '14999991111', veiculo: 'Fiat Uno Branco - ABC-1234', lat: -21.6785, lng: -49.7498, status: 'em-corrida', local: 'Centro', corrida: '#127', ultimaAtualizacao: Date.now() },
          { id: 2, nome: 'Pedro Oliveira', iniciais: 'PO', telefone: '14999992222', veiculo: 'VW Gol Prata - DEF-5678', lat: -21.6810, lng: -49.7520, status: 'online', local: 'Av. Brasil', corrida: null, ultimaAtualizacao: Date.now() }
        ];
        localStorage.setItem(DB_KEY, JSON.stringify(motoristasIniciais));
      }
    }
    
    function carregarMotoristas() {
      var dados = localStorage.getItem(DB_KEY);
      return dados ? JSON.parse(dados) : [];
    }
    
    function salvarMotoristas(lista) {
      localStorage.setItem(DB_KEY, JSON.stringify(lista));
    }
    
    // MAPA
    function inicializarMapa() {
      if (mapaIniciado) return;
      
      var cidade = document.getElementById('config-cidade');
      var centroLat = -21.6785;
      var centroLng = -49.7498;
      
      mapa = L.map('mapa-motoristas').setView([centroLat, centroLng], 14);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
      }).addTo(mapa);
      
      motoristas = carregarMotoristas();
      motoristas.forEach(function(mot) {
        if (mot.status !== 'offline' && mot.lat && mot.lng) {
          var cor = mot.status === 'em-corrida' ? '#3b82f6' : '#10b981';
          var icone = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: ' + cor + '; color: white; padding: 8px 14px; border-radius: 25px; font-size: 12px; font-weight: 600; white-space: nowrap; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">ğŸš— ' + mot.nome + '</div>',
            iconSize: [150, 35],
            iconAnchor: [75, 17]
          });
          var marker = L.marker([mot.lat, mot.lng], { icon: icone }).addTo(mapa);
          marcadores[mot.id] = marker;
        }
      });
      
      mapaIniciado = true;
    }
    
    function focalizarMotorista(id) {
      var mot = motoristas.find(function(m) { return m.id === id; });
      if (mapa && mot && mot.lat && mot.lng) {
        mapa.setView([mot.lat, mot.lng], 17);
      }
    }
    
    // MODAL MOTORISTA
    function abrirModalMotorista() {
      document.getElementById('modal-motorista').classList.add('active');
      document.getElementById('mot-nome').value = '';
      document.getElementById('mot-telefone').value = '';
      document.getElementById('mot-veiculo').value = '';
      document.getElementById('mot-cor').value = '';
      document.getElementById('mot-placa').value = '';
    }
    
    function fecharModalMotorista() {
      document.getElementById('modal-motorista').classList.remove('active');
    }
    
    function fecharModalSucesso() {
      document.getElementById('modal-sucesso-motorista').classList.remove('active');
    }
    
    function alternarTipoRecorrencia() {
      var tipo = document.getElementById('mot-tipo-recorrencia').value;
      document.getElementById('grupo-dia-mes').style.display = tipo === 'mensal' ? 'block' : 'none';
      document.getElementById('grupo-dia-semana').style.display = tipo !== 'mensal' ? 'block' : 'none';
    }
    
    function toggleComissao() {
      var checked = document.getElementById('mot-tem-comissao').checked;
      document.getElementById('campo-comissao').style.display = checked ? 'block' : 'none';
    }
    
    function gerarToken() {
      return 'MOT-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substring(2, 8).toUpperCase();
    }
    
    async function cadastrarMotorista() {
      var nome = document.getElementById('mot-nome').value.trim();
      var telefone = document.getElementById('mot-telefone').value.replace(/\D/g, '');
      var veiculo = document.getElementById('mot-veiculo').value.trim();
      var cor = document.getElementById('mot-cor').value.trim();
      var placa = document.getElementById('mot-placa').value.trim().toUpperCase();
      var valorMensalidade = parseFloat(document.getElementById('mot-valor-mensalidade').value) || 150;
      var enviarWhatsApp = document.getElementById('mot-enviar-whatsapp').checked;
      
      if (!nome || !telefone || !veiculo || !cor || !placa) {
        alert('âš ï¸ Preencha todos os campos obrigatÃ³rios!');
        return;
      }
      
      var token = gerarToken();
      var linkAcesso = window.location.origin + '/motorista/primeiro-acesso?token=' + token;
      
      var motorista = {
        id: Date.now(),
        nome: nome,
        telefone: telefone,
        veiculo: veiculo,
        cor: cor,
        placa: placa,
        valorMensalidade: valorMensalidade,
        token: token,
        status: 'ativo',
        criadoEm: new Date().toISOString()
      };
      
      var lista = carregarMotoristas();
      lista.push(motorista);
      salvarMotoristas(lista);
      
      if (enviarWhatsApp) {
        var msg = 'ğŸš— *BEM-VINDO!*\n\nOlÃ¡ ' + nome.split(' ')[0] + '!\n\nAcesse seu painel:\n' + linkAcesso + '\n\nğŸ’° Mensalidade: R$ ' + valorMensalidade.toFixed(2);
        window.open('https://wa.me/55' + telefone + '?text=' + encodeURIComponent(msg), '_blank');
      }
      
      fecharModalMotorista();
      document.getElementById('link-acesso-motorista').value = linkAcesso;
      document.getElementById('modal-sucesso-motorista').classList.add('active');
    }
    
    function copiarLinkAcesso() {
      var input = document.getElementById('link-acesso-motorista');
      input.select();
      document.execCommand('copy');
      alert('âœ… Link copiado!');
    }
    
    // MENSALIDADES
    function carregarMensalidades() {
      return JSON.parse(localStorage.getItem('mensalidades') || '[]');
    }
    
    function salvarMensalidadesDB(mens) {
      localStorage.setItem('mensalidades', JSON.stringify(mens));
    }
    
    function atualizarTabelaMensalidades() {
      var mensalidades = carregarMensalidades();
      var pagas = mensalidades.filter(function(m) { return m.status === 'pago'; }).length;
      var pendentes = mensalidades.filter(function(m) { return m.status === 'pendente'; }).length;
      var atrasadas = mensalidades.filter(function(m) { return m.status === 'atrasado'; }).length;
      var total = mensalidades.filter(function(m) { return m.status !== 'pago'; }).reduce(function(s, m) { return s + m.valor; }, 0);
      
      if (document.getElementById('stat-mens-pagas')) {
        document.getElementById('stat-mens-pagas').textContent = pagas;
        document.getElementById('stat-mens-pendentes').textContent = pendentes;
        document.getElementById('stat-mens-atrasadas').textContent = atrasadas;
        document.getElementById('stat-mens-total').textContent = 'R$ ' + total.toFixed(0);
      }
    }
    
    function gerarMensalidadesMes() {
      alert('âœ… Mensalidades geradas!');
      atualizarTabelaMensalidades();
    }
    
    function verificarVencimentosHoje() {
      alert('âœ… Nenhum vencimento para hoje!');
    }
    
    function enviarLembretes() {
      alert('âœ… Lembretes enviados!');
    }
    
    function enviarLembretesHoje() {
      alert('âœ… Lembretes enviados!');
    }
    
    // ANTI-FRAUDE
    function carregarAntiFraude() {
      document.getElementById('af-criticos').textContent = '0';
      document.getElementById('af-atencao').textContent = '0';
      document.getElementById('af-ok').textContent = carregarMotoristas().length;
      document.getElementById('af-total').textContent = '0';
      document.getElementById('af-tipo-atrasos').textContent = '0';
      document.getElementById('af-tipo-cancelamentos').textContent = '0';
      document.getElementById('af-tipo-gps').textContent = '0';
      document.getElementById('af-tipo-nota').textContent = '0';
    }
    
    function verificarTodosAntiFraude() {
      alert('âœ… VerificaÃ§Ã£o concluÃ­da! Nenhum alerta.');
    }
    
    // FINANCEIRO
    function abrirModalFinanceiro(tipo) {
      document.getElementById('modal-financeiro').classList.add('active');
      document.getElementById('fin-tipo').value = tipo || 'entrada';
      document.getElementById('fin-data').value = new Date().toISOString().split('T')[0];
      document.getElementById('titulo-modal-fin').textContent = tipo === 'saida' ? 'ğŸ“‰ Registrar SaÃ­da' : 'ğŸ“ˆ Registrar Entrada';
    }
    
    function fecharModalFinanceiro() {
      document.getElementById('modal-financeiro').classList.remove('active');
    }
    
    function atualizarCategoriasFin() {
      var tipo = document.getElementById('fin-tipo').value;
      var categorias = tipo === 'saida' 
        ? [{ value: 'manutencao', label: 'ğŸ”§ ManutenÃ§Ã£o' }, { value: 'combustivel', label: 'â›½ CombustÃ­vel' }, { value: 'outros', label: 'ğŸ“¦ Outros' }]
        : [{ value: 'corridas', label: 'ğŸš— Corridas' }, { value: 'mensalidade', label: 'ğŸ’³ Mensalidade' }, { value: 'outros', label: 'ğŸ“¦ Outros' }];
      
      var select = document.getElementById('fin-categoria');
      select.innerHTML = categorias.map(function(c) { return '<option value="' + c.value + '">' + c.label + '</option>'; }).join('');
    }
    
    function salvarLancamento() {
      var descricao = document.getElementById('fin-descricao').value.trim();
      var valor = parseFloat(document.getElementById('fin-valor').value) || 0;
      
      if (!descricao || valor <= 0) {
        alert('âš ï¸ Preencha todos os campos!');
        return;
      }
      
      var lancamentos = JSON.parse(localStorage.getItem('lancamentos_financeiros') || '[]');
      lancamentos.push({
        id: Date.now(),
        tipo: document.getElementById('fin-tipo').value,
        descricao: descricao,
        valor: valor,
        data: document.getElementById('fin-data').value
      });
      localStorage.setItem('lancamentos_financeiros', JSON.stringify(lancamentos));
      
      fecharModalFinanceiro();
      alert('âœ… LanÃ§amento salvo!');
      atualizarTotaisFinanceiro();
    }
    
    function atualizarTotaisFinanceiro() {
      var lancamentos = JSON.parse(localStorage.getItem('lancamentos_financeiros') || '[]');
      var entradas = lancamentos.filter(function(l) { return l.tipo === 'entrada'; }).reduce(function(s, l) { return s + l.valor; }, 0);
      var saidas = lancamentos.filter(function(l) { return l.tipo === 'saida'; }).reduce(function(s, l) { return s + l.valor; }, 0);
      
      if (document.getElementById('fin-entradas')) {
        document.getElementById('fin-entradas').textContent = 'R$ ' + entradas.toFixed(0);
        document.getElementById('fin-saidas').textContent = 'R$ ' + saidas.toFixed(0);
        document.getElementById('fin-lucro').textContent = 'R$ ' + (entradas - saidas).toFixed(0);
      }
    }
    
    // CONFIGURAÃ‡Ã•ES
    function salvarTelefonesSistema() {
      var telefoneRebeca = document.getElementById('config-telefone-rebeca').value.replace(/\D/g, '');
      var telefoneADM = document.getElementById('config-telefone-adm').value.replace(/\D/g, '');
      
      localStorage.setItem('config_telefone_rebeca', telefoneRebeca);
      localStorage.setItem('config_telefone_adm', telefoneADM);
      
      alert('âœ… Telefones salvos!');
    }
    
    function testarNotificacaoADM() {
      var telefone = document.getElementById('config-telefone-adm').value.replace(/\D/g, '');
      if (!telefone) {
        alert('âš ï¸ Configure o telefone primeiro!');
        return;
      }
      var msg = 'ğŸ§ª TESTE - Sistema REBECA funcionando!';
      window.open('https://wa.me/' + (telefone.startsWith('55') ? '' : '55') + telefone + '?text=' + encodeURIComponent(msg), '_blank');
    }
    
    function salvarConfiguracoes() {
      var nome = document.getElementById('config-nome-empresa').value;
      localStorage.setItem('nome_empresa', nome);
      document.getElementById('sidebar-nome-empresa').textContent = 'ğŸš— ' + nome;
      alert('âœ… ConfiguraÃ§Ãµes salvas!');
    }
    
    function carregarTelefonesSistema() {
      var telefoneRebeca = localStorage.getItem('config_telefone_rebeca') || '';
      var telefoneADM = localStorage.getItem('config_telefone_adm') || '';
      
      if (document.getElementById('config-telefone-rebeca')) {
        document.getElementById('config-telefone-rebeca').value = telefoneRebeca;
      }
      if (document.getElementById('config-telefone-adm')) {
        document.getElementById('config-telefone-adm').value = telefoneADM;
      }
    }
    
    // FunÃ§Ãµes extras
    function editarMotorista(id) { alert('ğŸ“ EdiÃ§Ã£o em desenvolvimento...'); }
    function localizarMotorista(id) { mostrarPagina('mapa', null); }
    function reenviarAcesso(id) { alert('ğŸ”— Link reenviado!'); }
    function excluirMotorista(id, nome) { 
      if (confirm('Excluir ' + nome + '?')) {
        var lista = carregarMotoristas().filter(function(m) { return m.id !== id; });
        salvarMotoristas(lista);
        alert('âœ… ExcluÃ­do!');
        location.reload();
      }
    }
    
    // InicializaÃ§Ã£o
    inicializarBanco();
    setTimeout(carregarTelefonesSistema, 500);
    
    console.log('ğŸš€ Sistema UBMAX inicializado!');
  </script>
</body>
</html>