<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UBMAX - ADM MASTER</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f8fafc;
      --bg-card: #ffffff;
      --bg-input: #f1f5f9;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0; top: 0; bottom: 0;
      width: 260px;
      background: var(--bg-card);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      overflow-y: auto;
    }
    .sidebar-logo {
      padding: 0 20px 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .sidebar-logo h1 {
      font-size: 20px;
      background: linear-gradient(135deg, #6366f1, #a855f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .sidebar-logo span {
      font-size: 11px;
      color: var(--text-muted);
      display: block;
      margin-top: 4px;
    }
    .nav-section {
      padding: 0 12px;
      margin-bottom: 20px;
    }
    .nav-title {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      padding: 0 8px;
      margin-bottom: 8px;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 10px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    .nav-item:hover { background: var(--bg-input); color: var(--text); }
    .nav-item.active { background: var(--primary); color: white; }
    .nav-item .badge {
      margin-left: auto;
      background: var(--danger);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
    }

    /* Se√ß√µes */
    .secao { display: none; }
    .secao.active { display: block; }

    /* Main */
    .main {
      margin-left: 260px;
      padding: 24px;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .header h2 { font-size: 24px; font-weight: 600; }
    .header-actions { display: flex; gap: 12px; }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-success { background: var(--success); color: white; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border);
    }
    .stat-icon {
      width: 48px; height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 12px;
    }
    .stat-icon.blue { background: rgba(99, 102, 241, 0.2); }
    .stat-icon.green { background: rgba(16, 185, 129, 0.2); }
    .stat-icon.yellow { background: rgba(245, 158, 11, 0.2); }
    .stat-icon.red { background: rgba(239, 68, 68, 0.2); }
    .stat-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
    .stat-label { font-size: 13px; color: var(--text-muted); }

    /* Cards */
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      border: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-title { font-size: 16px; font-weight: 600; }
    .card-body { padding: 20px; }

    /* Table */
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    .table th, .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .table th {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      font-weight: 600;
    }
    .table td { font-size: 14px; }
    .table tr:hover { background: var(--bg-input); }

    /* Status badges */
    .status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status.ativo { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .status.pendente { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .status.bloqueado { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .status.trial { background: rgba(99, 102, 241, 0.2); color: #6366f1; }

    /* Avatar */
    .avatar {
      width: 36px; height: 36px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }
    .user-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .user-name { font-weight: 500; }
    .user-phone { font-size: 12px; color: var(--text-muted); }

    /* Actions */
    .actions { display: flex; gap: 8px; }
    .action-btn {
      width: 32px; height: 32px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    .action-btn.edit { background: rgba(99, 102, 241, 0.2); color: #6366f1; }
    .action-btn.view { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .action-btn.block { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .action-btn.chat { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

    /* Suporte Chat */
    .suporte-panel {
      position: fixed;
      right: 0; top: 0; bottom: 0;
      width: 380px;
      background: var(--bg-card);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s;
      z-index: 1000;
    }
    .suporte-panel.open { transform: translateX(0); }
    .suporte-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .suporte-cliente {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .suporte-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }
    .suporte-msg {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 12px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .suporte-msg.cliente {
      background: var(--bg-input);
      align-self: flex-start;
    }
    .suporte-msg.adm {
      background: var(--primary);
      margin-left: auto;
    }
    .suporte-msg .time {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    .suporte-input {
      padding: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
    }
    .suporte-input input {
      flex: 1;
      background: var(--bg-input);
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      color: var(--text);
      font-size: 14px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      display: none;
    }
    .modal {
      background: var(--bg-card);
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title { font-size: 18px; font-weight: 600; }
    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
    }
    .modal-body { padding: 24px; }
    .form-group { margin-bottom: 20px; }
    .form-label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .form-input {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 16px;
      color: var(--text);
      font-size: 14px;
    }
    .form-select {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 16px;
      color: var(--text);
      font-size: 14px;
    }
    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Planos */
    .planos-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .plano-card {
      background: var(--bg-input);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }
    .plano-card:hover { border-color: var(--primary); }
    .plano-card.popular { border-color: var(--success); }
    .plano-nome { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
    .plano-preco { font-size: 32px; font-weight: 700; color: var(--success); }
    .plano-preco span { font-size: 14px; color: var(--text-muted); }
    .plano-features { margin-top: 16px; text-align: left; }
    .plano-feature {
      font-size: 13px;
      color: var(--text-muted);
      padding: 6px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .plano-feature::before { content: '‚úì'; color: var(--success); }

    /* Se√ß√µes */
    .secao { display: none; }
    .secao.active { display: block; }
  </style>
</head>
<body>
  <!-- TELA DE LOGIN -->
  <div id="tela-login" style="display: flex; min-height: 100vh; align-items: center; justify-content: center; background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);">
    <div style="background: white; padding: 40px; border-radius: 20px; width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <div style="text-align: center; margin-bottom: 32px;">
        <div style="font-size: 48px; margin-bottom: 12px;">üöÄ</div>
        <h1 style="font-size: 24px; color: #1e293b;">UBMAX</h1>
        <p style="color: #64748b; font-size: 14px;">Painel Master - Administra√ß√£o SaaS</p>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #475569;">Email</label>
        <input type="email" id="login-email" placeholder="seu@email.com"  style="width: 100%; padding: 14px 16px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 15px;">
      </div>
      
      <div style="margin-bottom: 24px;">
        <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #475569;">Senha</label>
        <input type="password" id="login-senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"  style="width: 100%; padding: 14px 16px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 15px;">
      </div>
      
      <button onclick="fazerLogin()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #6366f1, #a855f7); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
        Entrar
      </button>
      
      <p id="login-erro" style="color: #ef4444; text-align: center; margin-top: 16px; display: none;"></p>
    </div>
  </div>

  <!-- PAINEL PRINCIPAL (escondido at√© login) -->
  <div id="painel-principal" style="display: none;">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <h1>üöÄ UBMAX</h1>
      <span>ADM MASTER</span>
    </div>

    <div class="nav-section">
      <div class="nav-title">Principal</div>
      <div class="nav-item active" onclick="mostrarSecao('dashboard', this)">üìä Dashboard</div>
      <div class="nav-item" onclick="mostrarSecao('empresas', this)">üè¢ Empresas</div>
      <div class="nav-item" onclick="abrirSuporte()">üí¨ Suporte <span class="badge">3</span></div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Financeiro</div>
      <div class="nav-item" onclick="mostrarSecao('assinaturas', this)">üí≥ Assinaturas</div>
      <div class="nav-item" onclick="mostrarSecao('planos', this)">üìã Planos e Pre√ßos</div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Sistema</div>
      <div class="nav-item" onclick="mostrarSecao('telefonia', this)">üìû Telefonia IA</div>
      <div class="nav-item" onclick="mostrarSecao('config', this)">‚öôÔ∏è Configura√ß√µes</div>
      <div class="nav-item" onclick="mostrarSecao('logs', this)">üìÑ Logs</div>
      <div class="nav-item" onclick="mostrarSecao('suporte-ia', this)">ü§ñ Suporte IA</div>
      <div class="nav-item" onclick="mostrarSecao('manutencao', this)" style="color: #f59e0b;">üîß Manuten√ß√£o Servidor</div>
      <div class="nav-item" onclick="mostrarSecao('relatorios', this)">üìà Relat√≥rios Globais</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <!-- SE√á√ÉO DASHBOARD -->
    <section id="sec-dashboard" class="secao active">
    <!-- Header -->
    <div class="header">
      <h2 id="titulo-secao">Dashboard</h2>
      <div class="header-actions">
        <button class="btn btn-outline" onclick="abrirSuporte()">üí¨ Suporte (3)</button>
        <button class="btn btn-primary" onclick="abrirModalEmpresa()">+ Nova Empresa</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon green">‚úÖ</div>
        <div class="stat-value" id="stat-empresas-ativas">0</div>
        <div class="stat-label">Empresas Ativas</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon blue">üí∞</div>
        <div class="stat-value" id="stat-receita-mensal">R$ 0</div>
        <div class="stat-label">Receita Mensal</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon red">üö´</div>
        <div class="stat-value" id="stat-bloqueadas">0</div>
        <div class="stat-label">Bloqueadas</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon yellow">‚ö†Ô∏è</div>
        <div class="stat-value" id="stat-vencendo">0</div>
        <div class="stat-label">Vence em 3 dias</div>
      </div>
    </div>

    <!-- IA - An√°lise Preditiva -->
    <div class="card" style="border-left: 4px solid #8b5cf6; margin-bottom: 20px;">
      <div class="card-header" style="background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(99,102,241,0.1));">
        <span class="card-title">ü§ñ IA - An√°lise Preditiva</span>
        <span class="status" style="background: #8b5cf6; color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px;">Atualizado agora</span>
      </div>
      <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
          <!-- Alerta 1 -->
          <div style="background: #fef3c7; border-radius: 12px; padding: 16px; border-left: 4px solid #f59e0b;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <span style="font-size: 20px;">‚ö†Ô∏è</span>
              <span style="font-weight: 600; color: #92400e;">Aten√ß√£o</span>
            </div>
            <p style="font-size: 13px; color: #92400e; margin-bottom: 8px;"><strong>UBMAX</strong> - Motorista Jo√£o Santos com 3 reclama√ß√µes esta semana</p>
            <small style="color: #b45309;">Probabilidade de problema: 72%</small>
          </div>
          <!-- Alerta 2 -->
          <div style="background: #fee2e2; border-radius: 12px; padding: 16px; border-left: 4px solid #ef4444;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <span style="font-size: 20px;">üö®</span>
              <span style="font-weight: 600; color: #991b1b;">Cr√≠tico</span>
            </div>
            <p style="font-size: 13px; color: #991b1b; margin-bottom: 8px;"><strong>R√°pido City</strong> - Fatura vence em 2 dias, sem pagamento</p>
            <small style="color: #b91c1c;">Risco de inadimpl√™ncia: 85%</small>
          </div>
          <!-- Alerta 3 -->
          <div style="background: #d1fae5; border-radius: 12px; padding: 16px; border-left: 4px solid #10b981;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <span style="font-size: 20px;">üìà</span>
              <span style="font-weight: 600; color: #065f46;">Oportunidade</span>
            </div>
            <p style="font-size: 13px; color: #065f46; margin-bottom: 8px;"><strong>T√°xi Central</strong> - Crescimento de 40% no m√™s, considerar upgrade</p>
            <small style="color: #047857;">Chance de upgrade: 68%</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Empresas -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">üè¢ Empresas e Assinaturas</span>
        <input type="text" class="form-input" placeholder="Buscar..." style="width: 200px;">
      </div>
      <div class="card-body" style="padding: 0;">
        <table class="table">
          <thead>
            <tr>
              <th>Empresa</th>
              <th>Plano</th>
              <th>Motoristas</th>
              <th>Pagamento</th>
              <th>Vencimento</th>
              <th>Sistema</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabela-empresas">
            <!-- Dados carregados da API -->
            <tr>
              <td colspan="7" style="text-align: center; padding: 50px; color: #888;">
                <div style="font-size: 40px; margin-bottom: 15px;">üè¢</div>
                <div style="font-size: 16px; margin-bottom: 5px;">Nenhuma empresa cadastrada</div>
                <small>Novos clientes aparecer√£o aqui ap√≥s se cadastrarem em /cadastro</small>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Tickets Suporte dos Motoristas -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">üÜò Suporte dos Motoristas</span>
        <span class="status bloqueado">3 abertos</span>
      </div>
      <div class="card-body" style="padding: 0;">
        <table class="table">
          <thead>
            <tr>
              <th>Ticket</th>
              <th>Motorista</th>
              <th>Empresa</th>
              <th>Assunto</th>
              <th>Prioridade</th>
              <th>Data</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background: #fef2f2;">
              <td><strong>#TK001</strong></td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 32px; height: 32px; background: #6366f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">JS</div>
                  <div>
                    <div style="font-weight: 500;">Jo√£o Santos</div>
                    <div style="font-size: 11px; color: var(--text-muted);">(14) 99999-1234</div>
                  </div>
                </div>
              </td>
              <td>UBMAX</td>
              <td>App travando, n√£o recebe corridas</td>
              <td><span class="status bloqueado">üö® Urgente</span></td>
              <td>Agora</td>
              <td>
                <div class="actions">
                  <button class="action-btn view" onclick="abrirTicket('TK001')" title="Ver detalhes">üëÅÔ∏è</button>
                  <button class="action-btn edit" onclick="ligarMotorista('14999991234')" title="Ligar">üìû</button>
                  <button class="action-btn chat" onclick="whatsappMotorista('14999991234')" title="WhatsApp">üí¨</button>
                </div>
              </td>
            </tr>
            <tr>
              <td><strong>#TK002</strong></td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 32px; height: 32px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">MP</div>
                  <div>
                    <div style="font-weight: 500;">Maria Pereira</div>
                    <div style="font-size: 11px; color: var(--text-muted);">(11) 98888-5678</div>
                  </div>
                </div>
              </td>
              <td>R√°pido City</td>
              <td>Problema com GPS</td>
              <td><span class="status pendente">‚ö†Ô∏è M√©dia</span></td>
              <td>Hoje 11:20</td>
              <td>
                <div class="actions">
                  <button class="action-btn view" title="Ver detalhes">üëÅÔ∏è</button>
                  <button class="action-btn edit" title="Ligar">üìû</button>
                  <button class="action-btn chat" title="WhatsApp">üí¨</button>
                </div>
              </td>
            </tr>
            <tr>
              <td><strong>#TK003</strong></td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 32px; height: 32px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">CL</div>
                  <div>
                    <div style="font-weight: 500;">Carlos Lima</div>
                    <div style="font-size: 11px; color: var(--text-muted);">(19) 97777-9012</div>
                  </div>
                </div>
              </td>
              <td>T√°xi Central</td>
              <td>D√∫vida sobre extrato</td>
              <td><span class="status ativo">‚úÖ Baixa</span></td>
              <td>Ontem</td>
              <td>
                <div class="actions">
                  <button class="action-btn view" title="Ver detalhes">üëÅÔ∏è</button>
                  <button class="action-btn edit" title="Ligar">üìû</button>
                  <button class="action-btn chat" title="WhatsApp">üí¨</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    </section>
    <!-- FIM SE√á√ÉO DASHBOARD -->

    <!-- SE√á√ÉO EMPRESAS -->
    <section id="sec-empresas" class="secao">
      <div class="header">
        <h2>üè¢ Gerenciar Empresas</h2>
        <button class="btn btn-primary" onclick="abrirModalEmpresa()">+ Nova Empresa</button>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">Todas as Empresas</span>
          <input type="text" class="form-input" placeholder="Buscar..." style="width: 200px;" oninput="filtrarEmpresas(this.value)">
        </div>
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th>Empresa</th>
                <th>Plano</th>
                <th>Motoristas</th>
                <th>WhatsApp Rebeca</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabela-empresas-body">
              <tr>
                <td>
                  <strong>UBMAX Transportes</strong><br>
                  <small style="color: #64748b;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d4b7bbbaa0b5a0bb94a1b6b9b5acfab7bbb9">[email&#160;protected]</a></small>
                </td>
                <td><span class="badge badge-success">Profissional</span></td>
                <td>25</td>
                <td>(14) 99999-1111</td>
                <td>
                  <span class="badge badge-success" style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                    Conectado
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-success" onclick="abrirModalQRCode(1, '14999991111')" title="WhatsApp">üì±</button>
                  <button class="btn btn-sm btn-primary" onclick="editarEmpresa(1)" title="Editar">‚úèÔ∏è</button>
                  <button class="btn btn-sm btn-secondary" onclick="verDashboardEmpresa(1)" title="Dashboard">üìä</button>
                </td>
              </tr>
              <tr>
                <td>
                  <strong>T√°xi Central</strong><br>
                  <small style="color: #64748b;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8afeebf2e3cae9efe4fef8ebe6a4e9e5e7">[email&#160;protected]</a></small>
                </td>
                <td><span class="badge badge-primary">B√°sico</span></td>
                <td>12</td>
                <td>(11) 98888-2222</td>
                <td>
                  <span class="badge badge-warning" style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></span>
                    Desconectado
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-success" onclick="abrirModalQRCode(2, '11988882222')" title="Conectar WhatsApp">üì±</button>
                  <button class="btn btn-sm btn-primary" onclick="editarEmpresa(2)" title="Editar">‚úèÔ∏è</button>
                  <button class="btn btn-sm btn-secondary" onclick="verDashboardEmpresa(2)" title="Dashboard">üìä</button>
                </td>
              </tr>
              <tr>
                <td>
                  <strong>Auto Express</strong><br>
                  <small style="color: #64748b;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a3c0cccdd7c2d7cce3c2d6d7ccc6dbd3d1c6d0d08dc0ccce">[email&#160;protected]</a></small>
                </td>
                <td><span class="badge badge-purple">Enterprise</span></td>
                <td>45</td>
                <td>(19) 97777-3333</td>
                <td>
                  <span class="badge badge-success" style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                    Conectado
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-success" onclick="abrirModalQRCode(3, '19977773333')" title="WhatsApp">üì±</button>
                  <button class="btn btn-sm btn-primary" onclick="editarEmpresa(3)" title="Editar">‚úèÔ∏è</button>
                  <button class="btn btn-sm btn-secondary" onclick="verDashboardEmpresa(3)" title="Dashboard">üìä</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div style="margin-top: 20px; padding: 16px; background: #f0fdf4; border-radius: 8px; border: 1px solid #86efac;">
        <h4 style="color: #166534; margin-bottom: 8px;">üì± Como conectar o WhatsApp da Rebeca:</h4>
        <ol style="margin: 0; padding-left: 20px; color: #166534;">
          <li>Clique no bot√£o üì± da empresa desejada</li>
          <li>Um QR Code ser√° gerado automaticamente</li>
          <li>O cliente escaneia com o WhatsApp dele</li>
          <li>Pronto! A Rebeca come√ßa a atender naquele n√∫mero</li>
        </ol>
      </div>
    </section>

    <!-- SE√á√ÉO ASSINATURAS -->
    <section id="sec-assinaturas" class="secao">
      <div class="header">
        <h2>üí≥ Assinaturas</h2>
        <button class="btn btn-success">üìä Exportar Relat√≥rio</button>
      </div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-icon green">üí∞</div><div class="stat-value">R$ 3.883</div><div class="stat-label">Receita Mensal</div></div>
        <div class="stat-card"><div class="stat-icon blue">‚úÖ</div><div class="stat-value">10</div><div class="stat-label">Assinaturas Ativas</div></div>
        <div class="stat-card"><div class="stat-icon yellow">‚è≥</div><div class="stat-value">R$ 594</div><div class="stat-label">A Vencer</div></div>
        <div class="stat-card"><div class="stat-icon red">üö´</div><div class="stat-value">2</div><div class="stat-label">Bloqueadas</div></div>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">Hist√≥rico de Pagamentos</span>
        </div>
        <div class="card-body" style="padding: 0;">
          <table class="table">
            <thead>
              <tr>
                <th>Empresa</th>
                <th>Plano</th>
                <th>Valor</th>
                <th>Data Pgto</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>UBMAX Transportes</td>
                <td>Profissional</td>
                <td>R$ 397,00</td>
                <td>05/01/2026</td>
                <td><span class="status ativo">‚úÖ Pago</span></td>
              </tr>
              <tr>
                <td>T√°xi Central</td>
                <td>Enterprise</td>
                <td>R$ 797,00</td>
                <td>03/01/2026</td>
                <td><span class="status ativo">‚úÖ Pago</span></td>
              </tr>
              <tr>
                <td>R√°pido City</td>
                <td>B√°sico</td>
                <td>R$ 197,00</td>
                <td>-</td>
                <td><span class="status pendente">‚ö†Ô∏è Aguardando</span></td>
              </tr>
              <tr>
                <td>Move Express</td>
                <td>B√°sico</td>
                <td>R$ 197,00</td>
                <td>-</td>
                <td><span class="status bloqueado">‚ùå Vencido</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SE√á√ÉO CONFIGURA√á√ïES -->
    <section id="sec-config" class="secao">
      <div class="header">
        <h2>‚öôÔ∏è Configura√ß√µes</h2>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">Configura√ß√µes Gerais</span>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Nome do Sistema</label>
            <input type="text" class="form-input" value="UBMAX">
          </div>
          <div class="form-group">
            <label class="form-label">WhatsApp Principal</label>
            <input type="text" class="form-input" value="+55 14 99999-0000">
          </div>
          <div class="form-group">
            <label class="form-label">Dias de Toler√¢ncia (ap√≥s vencimento)</label>
            <input type="number" class="form-input" value="3">
          </div>
          <div class="form-group">
            <label class="form-label">Mensagem WhatsApp Bloqueio</label>
            <textarea class="form-input" rows="3">Sua assinatura est√° vencida. Entre em contato para regularizar e continuar usando o sistema.</textarea>
          </div>
          <button class="btn btn-primary">Salvar</button>
        </div>
      </div>
    </section>

    <!-- SE√á√ÉO PLANOS E PRE√áOS -->
    <section id="sec-planos" class="secao">
      <div class="header">
        <h2>üìã Planos e Pre√ßos</h2>
        <button class="btn btn-primary" onclick="novoPlano()">+ Novo Plano</button>
      </div>
      
      <!-- Cards de Planos Edit√°veis -->
      <div class="card" style="margin-bottom: 20px;">
        <div class="card-header">
          <span class="card-title">Planos Dispon√≠veis</span>
        </div>
        <div class="card-body">
          <div class="planos-grid">
            <!-- Plano B√°sico -->
            <div class="plano-card" style="position: relative;">
              <button onclick="editarPlano('basico')" style="position: absolute; top: 10px; right: 10px; background: var(--bg-input); border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer;">‚úèÔ∏è</button>
              <div class="plano-nome">B√°sico</div>
              <div class="plano-preco">R$ 197<span>/m√™s</span></div>
              <div style="background: var(--bg-input); padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center;">
                <span style="font-size: 24px; font-weight: 700; color: var(--primary);">5</span>
                <span style="font-size: 12px; color: var(--text-muted); display: block;">motoristas</span>
              </div>
              <div class="plano-features">
                <div class="plano-feature">WhatsApp Bot</div>
                <div class="plano-feature">Painel Motorista</div>
                <div class="plano-feature">Suporte por email</div>
              </div>
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                <small style="color: var(--text-muted);">R$ 39,40 por motorista</small>
              </div>
            </div>
            
            <!-- Plano Profissional -->
            <div class="plano-card popular" style="position: relative;">
              <button onclick="editarPlano('profissional')" style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; color: white;">‚úèÔ∏è</button>
              <div class="plano-nome">Profissional</div>
              <div class="plano-preco">R$ 397<span>/m√™s</span></div>
              <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center;">
                <span style="font-size: 24px; font-weight: 700;">15</span>
                <span style="font-size: 12px; opacity: 0.8; display: block;">motoristas</span>
              </div>
              <div class="plano-features">
                <div class="plano-feature">Tudo do B√°sico</div>
                <div class="plano-feature">Chat da Frota</div>
                <div class="plano-feature">Rastreamento GPS</div>
                <div class="plano-feature">Suporte priorit√°rio</div>
              </div>
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">
                <small style="opacity: 0.8;">R$ 26,47 por motorista</small>
              </div>
            </div>
            
            <!-- Plano Enterprise -->
            <div class="plano-card" style="position: relative;">
              <button onclick="editarPlano('enterprise')" style="position: absolute; top: 10px; right: 10px; background: var(--bg-input); border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer;">‚úèÔ∏è</button>
              <div class="plano-nome">Enterprise</div>
              <div class="plano-preco">R$ 797<span>/m√™s</span></div>
              <div style="background: var(--bg-input); padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center;">
                <span style="font-size: 24px; font-weight: 700; color: var(--primary);">‚àû</span>
                <span style="font-size: 12px; color: var(--text-muted); display: block;">ilimitado</span>
              </div>
              <div class="plano-features">
                <div class="plano-feature">Tudo do Profissional</div>
                <div class="plano-feature">API Personalizada</div>
                <div class="plano-feature">Marca Branca</div>
                <div class="plano-feature">Suporte 24h</div>
              </div>
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                <small style="color: var(--text-muted);">Melhor custo-benef√≠cio</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pre√ßo por Motorista Adicional -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">üí∞ Pre√ßo por Motorista Adicional</span>
        </div>
        <div class="card-body">
          <p style="color: var(--text-muted); margin-bottom: 16px;">Quando a empresa exceder o limite de motoristas do plano:</p>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
            <div class="form-group">
              <label class="form-label">Plano B√°sico</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span>R$</span>
                <input type="number" class="form-input" value="25" style="width: 100px;">
                <span style="color: var(--text-muted);">/motorista</span>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Plano Profissional</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span>R$</span>
                <input type="number" class="form-input" value="20" style="width: 100px;">
                <span style="color: var(--text-muted);">/motorista</span>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Plano Enterprise</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span>R$</span>
                <input type="number" class="form-input" value="0" style="width: 100px;" disabled>
                <span style="color: var(--text-muted);">ilimitado</span>
              </div>
            </div>
          </div>
          <button class="btn btn-primary" style="margin-top: 16px;">Salvar Pre√ßos</button>
        </div>
      </div>
    </section>

    <!-- SE√á√ÉO TELEFONIA IA -->
    <section id="sec-telefonia" class="secao">
      <div class="header">
        <h2>üìû Telefonia IA</h2>
        <div class="header-actions">
          <button class="btn btn-outline" onclick="carregarTelefonia()">üîÑ Atualizar</button>
        </div>
      </div>

      <!-- Explica√ß√£o -->
      <div class="card" style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; margin-bottom: 20px;">
        <div class="card-body">
          <h3 style="margin-bottom: 12px;">ü§ñ Atendimento Autom√°tico com IA</h3>
          <p style="opacity: 0.9; margin-bottom: 16px;">Configure n√∫meros de WhatsApp e telefone para empresas que desejam atendimento autom√°tico. A Rebeca atender√° os clientes dessas frotas automaticamente.</p>
          <div style="display: flex; gap: 24px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 24px;">üí¨</span>
              <div>
                <strong>WhatsApp Rebeca</strong>
                <div style="font-size: 12px; opacity: 0.8;">Bot de atendimento por mensagem</div>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 24px;">üìû</span>
              <div>
                <strong>Liga√ß√£o IA</strong>
                <div style="font-size: 12px; opacity: 0.8;">Atendimento por voz com IA</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empresas com Telefonia -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">üè¢ Empresas com Telefonia IA</span>
          <button class="btn btn-primary btn-sm" onclick="abrirModalTelefonia()">+ Configurar Empresa</button>
        </div>
        <div class="card-body">
          <table class="table" id="tabela-telefonia">
            <thead>
              <tr>
                <th>Empresa</th>
                <th>WhatsApp Rebeca</th>
                <th>Telefone Liga√ß√£o IA</th>
                <th>Liga√ß√£o Ativa</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="lista-telefonia">
              <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);">
                  Carregando empresas...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Instru√ß√µes -->
      <div class="card" style="margin-top: 20px;">
        <div class="card-header">
          <span class="card-title">üìñ Como Funciona</span>
        </div>
        <div class="card-body">
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
            <div>
              <h4 style="color: var(--primary); margin-bottom: 8px;">üí¨ WhatsApp Rebeca</h4>
              <ol style="padding-left: 20px; color: var(--text-muted); line-height: 1.8;">
                <li>Cadastre o n√∫mero do WhatsApp Business da empresa</li>
                <li>Configure o webhook na Evolution API</li>
                <li>A Rebeca atender√° automaticamente os clientes</li>
                <li>Corridas s√£o atribu√≠das aos motoristas da frota</li>
              </ol>
            </div>
            <div>
              <h4 style="color: var(--success); margin-bottom: 8px;">üìû Liga√ß√£o com IA</h4>
              <ol style="padding-left: 20px; color: var(--text-muted); line-height: 1.8;">
                <li>Cadastre o n√∫mero de telefone da empresa (Twilio)</li>
                <li>A IA atende liga√ß√µes e entende o pedido</li>
                <li>Converte voz em texto e processa com a Rebeca</li>
                <li>Responde por voz e registra a corrida</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SE√á√ÉO LOGS -->
    <section id="sec-logs" class="secao">
      <div class="header">
        <h2>üìÑ Logs do Sistema</h2>
        <div class="header-actions">
          <input type="date" class="form-input" style="width: 150px;">
          <button class="btn btn-outline">üîÑ Atualizar</button>
        </div>
      </div>
      <div class="card">
        <div class="card-body" style="font-family: monospace; font-size: 12px; background: #1e293b; color: #10b981; padding: 16px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
          [10/01/2026 15:45:00] INFO - Empresa Move Express BLOQUEADA - Pagamento vencido<br>
          [10/01/2026 15:30:22] INFO - Empresa UBMAX - Pagamento confirmado R$ 397,00<br>
          [10/01/2026 14:32:15] WARN - Empresa R√°pido City - Vencimento em 2 dias<br>
          [10/01/2026 14:25:00] INFO - Ticket #TK001 aberto - UBMAX - Jo√£o Santos<br>
          [10/01/2026 14:20:33] INFO - Nova empresa cadastrada: T√°xi Central<br>
          [10/01/2026 10:00:00] INFO - Sistema iniciado<br>
          [10/01/2026 14:20:33] INFO - Empresa R√°pido City acessou o painel<br>
        </div>
      </div>
    </section>

    <section id="sec-relatorios" class="secao">
      <div class="page-header">
        <h2>üìà Relat√≥rios Globais</h2>
        <p style="color: #64748b;">Vis√£o geral de todas as empresas</p>
      </div>
      <div class="card">
        <div class="card-body" style="text-align: center; padding: 40px;">
          <h3>üìä Em desenvolvimento</h3>
          <p>Os relat√≥rios globais ser√£o carregados da API</p>
        </div>
      </div>
    </section>

    <!-- SE√á√ÉO SUPORTE IA -->
    <section id="sec-suporte-ia" class="secao">
      <div class="header">
        <h2>ü§ñ Suporte IA - Claude</h2>
        <span style="color: #64748b;">Melhorias e corre√ß√µes em tempo real</span>
      </div>
      
      <!-- TELA DE SENHA -->
      <div id="suporte-login" class="card" style="max-width: 400px; margin: 50px auto;">
        <div class="card-body" style="text-align: center; padding: 40px;">
          <div style="font-size: 64px; margin-bottom: 20px;">üîê</div>
          <h3 style="margin-bottom: 20px;">Acesso Restrito</h3>
          <p style="color: #64748b; margin-bottom: 20px;">Esta √°rea √© protegida. Digite a senha para acessar o suporte t√©cnico.</p>
          <input type="password" id="suporte-senha" placeholder="Digite a senha..." 
                 style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; margin-bottom: 16px;">
          <button onclick="verificarSenhaSuporte()" 
                  style="width: 100%; padding: 14px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
            üîì Acessar
          </button>
          <p id="suporte-erro" style="color: #ef4444; margin-top: 16px; display: none;">Senha incorreta!</p>
        </div>
      </div>
      
      <!-- PAINEL DE SUPORTE (oculto at√© autenticar) -->
      <div id="suporte-painel" style="display: none;">
        
        <!-- STATUS DO SISTEMA -->
        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header">
            <span class="card-title">üìä Status do Sistema</span>
            <button class="btn btn-sm btn-primary" onclick="verificarStatusSistema()">üîÑ Atualizar</button>
          </div>
          <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
              <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px;">üü¢</div>
                <div style="font-weight: 600; color: #166534;">Servidor</div>
                <div style="color: #64748b; font-size: 12px;">Online</div>
              </div>
              <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px;">üü¢</div>
                <div style="font-weight: 600; color: #166534;">Banco de Dados</div>
                <div style="color: #64748b; font-size: 12px;">Conectado</div>
              </div>
              <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px;" id="status-whatsapp">üü¢</div>
                <div style="font-weight: 600; color: #166534;">WhatsApp</div>
                <div style="color: #64748b; font-size: 12px;" id="status-whatsapp-texto">Conectado</div>
              </div>
              <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px;">üü¢</div>
                <div style="font-weight: 600; color: #166534;">APIs</div>
                <div style="color: #64748b; font-size: 12px;">189 endpoints</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- CHAT COM CLAUDE -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">üí¨ Chat com Claude - Suporte T√©cnico</span>
            <span style="color: #64748b; font-size: 12px;">Descreva o problema ou melhoria desejada</span>
          </div>
          <div class="card-body" style="padding: 0;">
            
            <!-- √Årea de mensagens -->
            <div id="suporte-chat" style="height: 400px; overflow-y: auto; padding: 20px; background: #f8fafc;">
              
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; flex-shrink: 0;">ü§ñ</div>
                <div style="background: white; padding: 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 80%;">
                  <p style="margin: 0;">Ol√°! Sou a Claude, sua assistente de suporte t√©cnico. üëã</p>
                  <p style="margin: 8px 0 0 0;">Posso ajudar com:</p>
                  <ul style="margin: 8px 0 0 16px; padding: 0; color: #64748b;">
                    <li>Corrigir bugs e erros no sistema</li>
                    <li>Adicionar novas funcionalidades</li>
                    <li>Otimizar performance</li>
                    <li>Ajustar comportamento da Rebeca</li>
                    <li>Modificar configura√ß√µes</li>
                  </ul>
                  <p style="margin: 8px 0 0 0; color: #64748b; font-size: 12px;">Descreva detalhadamente o que precisa!</p>
                </div>
              </div>
              
            </div>
            
            <!-- Input de mensagem -->
            <div style="padding: 16px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px;">
              <textarea id="suporte-input" placeholder="Descreva o problema ou melhoria que deseja..." 
                        style="flex: 1; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; resize: none; height: 80px;"></textarea>
              <button onclick="enviarParaClaude()" 
                      style="padding: 0 24px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                Enviar üöÄ
              </button>
            </div>
            
          </div>
        </div>
        
        <!-- A√á√ïES R√ÅPIDAS -->
        <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <span class="card-title">‚ö° A√ß√µes R√°pidas</span>
          </div>
          <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
              <button onclick="acaoRapida('reiniciar-rebeca')" class="btn" style="padding: 16px; background: #f0fdf4; border: 1px solid #86efac; color: #166534;">
                üîÑ Reiniciar Rebeca
              </button>
              <button onclick="acaoRapida('limpar-cache')" class="btn" style="padding: 16px; background: #f0f9ff; border: 1px solid #93c5fd; color: #1e40af;">
                üóëÔ∏è Limpar Cache
              </button>
              <button onclick="acaoRapida('verificar-erros')" class="btn" style="padding: 16px; background: #fef3c7; border: 1px solid #fcd34d; color: #92400e;">
                üîç Verificar Erros
              </button>
              <button onclick="acaoRapida('backup')" class="btn" style="padding: 16px; background: #fce7f3; border: 1px solid #f9a8d4; color: #9d174d;">
                üíæ Fazer Backup
              </button>
              <button onclick="acaoRapida('atualizar-sistema')" class="btn" style="padding: 16px; background: #ede9fe; border: 1px solid #c4b5fd; color: #5b21b6;">
                üì¶ Atualizar Sistema
              </button>
              <button onclick="acaoRapida('reconectar-whatsapp')" class="btn" style="padding: 16px; background: #ecfdf5; border: 1px solid #6ee7b7; color: #047857;">
                üì± Reconectar WhatsApp
              </button>
            </div>
          </div>
        </div>
        
        <!-- LOG DE ALTERA√á√ïES -->
        <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <span class="card-title">üìã Log de Altera√ß√µes</span>
          </div>
          <div class="card-body">
            <div id="log-alteracoes" style="max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; background: #1e293b; color: #94a3b8; padding: 16px; border-radius: 8px;">
              <div style="color: #4ade80;">[2026-01-14 16:50] Sistema iniciado</div>
              <div style="color: #4ade80;">[2026-01-14 16:50] Claude Suporte ativado</div>
              <div style="color: #60a5fa;">[2026-01-14 16:50] Aguardando comandos...</div>
            </div>
          </div>
        </div>
        
      </div>
    </section>


    <!-- SE√á√ÉO MANUTEN√á√ÉO DO SERVIDOR -->
    <section id="sec-manutencao" class="secao">
      <div class="header">
        <h2>üîß Manuten√ß√£o do Servidor - Claude</h2>
        <span style="color: #64748b;">Acesso completo ao sistema para melhorias e corre√ß√µes em tempo real</span>
      </div>
      
      <!-- TELA DE SENHA -->
      <div id="manutencao-login" class="card" style="max-width: 450px; margin: 50px auto;">
        <div class="card-body" style="text-align: center; padding: 40px;">
          <div style="font-size: 64px; margin-bottom: 20px;">üîê</div>
          <h3 style="margin-bottom: 10px; color: #f59e0b;">‚ö†Ô∏è √Årea Restrita</h3>
          <p style="color: #64748b; margin-bottom: 20px;">Acesso exclusivo para manuten√ß√£o do servidor. Claude ter√° acesso completo ao sistema.</p>
          <input type="password" id="manutencao-senha" placeholder="Digite a senha de manuten√ß√£o..." 
                 style="width: 100%; padding: 14px; border: 2px solid #f59e0b; border-radius: 10px; font-size: 16px; margin-bottom: 16px;"
                 onkeypress="if(event.key==='Enter')verificarSenhaManutencao()">
          <button onclick="verificarSenhaManutencao()" 
                  style="width: 100%; padding: 14px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
            üîì Acessar Manuten√ß√£o
          </button>
          <p id="manutencao-erro" style="color: #ef4444; margin-top: 16px; display: none;">Senha incorreta!</p>
        </div>
      </div>
      
      <!-- PAINEL DE MANUTEN√á√ÉO (oculto at√© autenticar) -->
      <div id="manutencao-painel" style="display: none;">
        
        <!-- AVISO IMPORTANTE -->
        <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
  <!-- PLACEHOLDER_MELHORIAS -->
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 32px;">‚ö†Ô∏è</span>
            <div>
              <h4 style="margin: 0; color: #92400e;">Modo Manuten√ß√£o Ativo</h4>
              <p style="margin: 4px 0 0 0; color: #a16207;">Claude tem acesso total ao sistema. Todas as altera√ß√µes requerem sua confirma√ß√£o antes de serem aplicadas.</p>
            </div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          
          <!-- COLUNA ESQUERDA -->
          <div>
            

        <!-- ESCOPO DA MANUTEN√á√ÉO -->
        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;">
            <span class="card-title" style="color: white;">üéØ Escopo da Manuten√ß√£o</span>
            <span style="font-size: 12px; opacity: 0.9;">Selecione onde aplicar as altera√ß√µes</span>
          </div>
          <div class="card-body">
            
            <!-- SELETOR DE ESCOPO -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 20px;">
              <label style="display: flex; align-items: center; gap: 10px; padding: 14px; background: #f0fdf4; border: 2px solid #86efac; border-radius: 10px; cursor: pointer;">
                <input type="radio" name="escopo" value="sistema" checked onchange="selecionarEscopo('sistema')" style="width: 18px; height: 18px;">
                <div>
                  <strong style="color: #166534;">üåê Sistema Geral</strong>
                  <p style="margin: 4px 0 0 0; font-size: 11px; color: #64748b;">Todas as empresas</p>
                </div>
              </label>
              
              <label style="display: flex; align-items: center; gap: 10px; padding: 14px; background: #eff6ff; border: 2px solid #93c5fd; border-radius: 10px; cursor: pointer;">
                <input type="radio" name="escopo" value="frota" onchange="selecionarEscopo('frota')" style="width: 18px; height: 18px;">
                <div>
                  <strong style="color: #1e40af;">üè¢ Frota Espec√≠fica</strong>
                  <p style="margin: 4px 0 0 0; font-size: 11px; color: #64748b;">Uma empresa</p>
                </div>
              </label>
              
              <label style="display: flex; align-items: center; gap: 10px; padding: 14px; background: #fef3c7; border: 2px solid #fcd34d; border-radius: 10px; cursor: pointer;">
                <input type="radio" name="escopo" value="rebeca" onchange="selecionarEscopo('rebeca')" style="width: 18px; height: 18px;">
                <div>
                  <strong style="color: #92400e;">üì± Rebeca Espec√≠fica</strong>
                  <p style="margin: 4px 0 0 0; font-size: 11px; color: #64748b;">Por n√∫mero WhatsApp</p>
                </div>
              </label>
              
              <label style="display: flex; align-items: center; gap: 10px; padding: 14px; background: #fce7f3; border: 2px solid #f9a8d4; border-radius: 10px; cursor: pointer;">
                <input type="radio" name="escopo" value="motorista" onchange="selecionarEscopo('motorista')" style="width: 18px; height: 18px;">
                <div>
                  <strong style="color: #9d174d;">üöó Motorista Espec√≠fico</strong>
                  <p style="margin: 4px 0 0 0; font-size: 11px; color: #64748b;">Um motorista</p>
                </div>
              </label>
            </div>
            
            <!-- CAMPOS ESPEC√çFICOS (ocultos por padr√£o) -->
            <div id="campos-escopo" style="display: none; margin-bottom: 16px;">
              
              <div id="campo-frota" style="display: none;">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">üè¢ Selecione a Frota:</label>
                <select id="select-frota" class="form-select" style="width: 100%; padding: 12px;">
                  <option value="">-- Selecione uma empresa --</option>
                  <option value="1">UBMAX Transportes</option>
                  <option value="2">T√°xi Central</option>
                  <option value="3">Auto Express</option>
                </select>
              </div>
              
              <div id="campo-rebeca-numero" style="display: none;">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">üì± N√∫mero da Rebeca:</label>
                <input type="text" id="input-rebeca-numero" class="form-input" placeholder="Ex: 14999991111" style="width: 100%; padding: 12px;">
                <p style="font-size: 11px; color: #64748b; margin-top: 4px;">Digite o n√∫mero do WhatsApp da Rebeca (sem +55)</p>
              </div>
              
              <div id="campo-motorista-id" style="display: none;">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">üöó Telefone ou ID do Motorista:</label>
                <input type="text" id="input-motorista-id" class="form-input" placeholder="Ex: 14999990000 ou ID: 123" style="width: 100%; padding: 12px;">
              </div>
              
            </div>
            
            <!-- STATUS DO ESCOPO SELECIONADO -->
            <div id="status-escopo" style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px;">
              <p style="margin: 0; color: #166534;">
                <strong>üåê Escopo atual:</strong> Sistema Geral - Todas as altera√ß√µes afetar√£o todas as empresas
              </p>
            </div>
            
          </div>
        </div>
        
        <!-- HOR√ÅRIOS DE MANUTEN√á√ÉO -->
        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header">
            <span class="card-title">üïê Melhores Hor√°rios para Manuten√ß√£o</span>
            <button class="btn btn-sm btn-secondary" onclick="atualizarHorarios()">üîÑ</button>
          </div>
          <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              
              <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px;">
                <div style="font-size: 24px; margin-bottom: 8px;">üü¢</div>
                <strong style="color: #166534;">AGORA √â BOM!</strong>
                <p style="margin: 8px 0 0 0; font-size: 12px; color: #64748b;">Baixa atividade</p>
                <p style="margin: 4px 0 0 0; font-size: 11px; color: #166534;">2 corridas ativas</p>
              </div>
              
              <div style="padding: 16px; background: #f8fafc; border-radius: 8px;">
                <strong style="display: block; margin-bottom: 8px;">üìä Atividade Atual:</strong>
                <div style="font-size: 13px; color: #64748b;">
                  <p style="margin: 4px 0;">‚Ä¢ Motoristas online: <strong>5</strong></p>
                  <p style="margin: 4px 0;">‚Ä¢ Corridas em andamento: <strong>2</strong></p>
                  <p style="margin: 4px 0;">‚Ä¢ Clientes aguardando: <strong>0</strong></p>
                </div>
              </div>
              
              <div style="padding: 16px; background: #f8fafc; border-radius: 8px;">
                <strong style="display: block; margin-bottom: 8px;">‚è∞ Hor√°rios Recomendados:</strong>
                <div style="font-size: 13px; color: #64748b;">
                  <p style="margin: 4px 0;">üü¢ 02h - 06h (madrugada)</p>
                  <p style="margin: 4px 0;">üü° 10h - 11h (baixo movimento)</p>
                  <p style="margin: 4px 0;">üü° 14h - 16h (tarde calma)</p>
                  <p style="margin: 4px 0;">üî¥ 18h - 22h (pico - evitar)</p>
                </div>
              </div>
              
            </div>
          </div>
        </div>
        
        <!-- NOTIFICAR SOBRE ATUALIZA√á√ÉO -->
        <div class="card" style="margin-bottom: 20px;">
          <div class="card-header" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white;">
            <span class="card-title" style="color: white;">üì¢ Notificar sobre Atualiza√ß√£o</span>
            <span style="font-size: 12px; opacity: 0.9;">Avise motoristas e admins (clientes N√ÉO s√£o notificados)</span>
          </div>
          <div class="card-body">
            
            <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              <p style="margin: 0; color: #92400e; font-size: 13px;">
                ‚ö†Ô∏è <strong>Importante:</strong> Apenas MOTORISTAS e ADMINISTRADORES ser√£o notificados. CLIENTES n√£o recebem aviso de manuten√ß√£o.
              </p>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label style="font-weight: 600; margin-bottom: 8px; display: block;">üìù Mensagem de Atualiza√ß√£o:</label>
              <textarea id="msg-atualizacao" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; height: 80px; resize: none;" placeholder="Ex: Sistema passar√° por atualiza√ß√£o r√°pida. Pode haver instabilidade por alguns minutos.">üîß AVISO: O sistema UBMAX passar√° por uma atualiza√ß√£o r√°pida. Dura√ß√£o estimada: 5 minutos. Obrigado pela compreens√£o!</textarea>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
              <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                <input type="checkbox" id="notif-motoristas" checked style="width: 18px; height: 18px;">
                <span>üöó Notificar Motoristas</span>
              </label>
              <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer;">
                <input type="checkbox" id="notif-admins" checked style="width: 18px; height: 18px;">
                <span>üëî Notificar Admins</span>
              </label>
            </div>
            
            <div style="display: flex; gap: 12px;">
              <button onclick="enviarNotificacaoAtualizacao()" class="btn btn-primary" style="flex: 1;">
                üì¢ Enviar Notifica√ß√£o Agora
              </button>
              <button onclick="agendarNotificacao()" class="btn btn-secondary">
                ‚è∞ Agendar
              </button>
            </div>
            
            <div id="resultado-notificacao" style="margin-top: 12px; display: none;"></div>
            
          </div>
        </div>


        <!-- ABAS DE MELHORIAS -->
        <div class="card" style="margin-bottom: 20px;">
          <div style="display: flex; border-bottom: 2px solid #e2e8f0;">
            <button class="tab-btn active" onclick="mostrarAbaMelhoria('geral', this)" style="flex: 1; padding: 14px; background: none; border: none; cursor: pointer; font-weight: 600; color: #f59e0b; border-bottom: 3px solid #f59e0b;">
              ü§ñ Geral
            </button>
            <button class="tab-btn" onclick="mostrarAbaMelhoria('rebeca', this)" style="flex: 1; padding: 14px; background: none; border: none; cursor: pointer; font-weight: 600; color: #64748b;">
              üí¨ Rebeca (Prompts)
            </button>
            <button class="tab-btn" onclick="mostrarAbaMelhoria('admin', this)" style="flex: 1; padding: 14px; background: none; border: none; cursor: pointer; font-weight: 600; color: #64748b;">
              üñ•Ô∏è Painel Admin
            </button>
            <button class="tab-btn" onclick="mostrarAbaMelhoria('motorista', this)" style="flex: 1; padding: 14px; background: none; border: none; cursor: pointer; font-weight: 600; color: #64748b;">
              üöó Painel Motorista
            </button>
            <button class="tab-btn" onclick="mostrarAbaMelhoria('api', this)" style="flex: 1; padding: 14px; background: none; border: none; cursor: pointer; font-weight: 600; color: #64748b;">
              üîå APIs
            </button>
          </div>
          
          <!-- ABA GERAL -->
          <div id="aba-geral" class="aba-conteudo" style="padding: 20px;">
            <h4 style="margin: 0 0 16px 0;">üõ†Ô∏è Melhorias Gerais do Sistema</h4>
            <p style="color: #64748b; margin-bottom: 16px;">Selecione uma √°rea acima ou descreva qualquer melhoria no chat.</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
              <button onclick="solicitarMelhoria('performance')" class="btn" style="padding: 16px; background: #f0fdf4; border: 1px solid #86efac; color: #166534; text-align: left;">
                ‚ö° Otimizar Performance
              </button>
              <button onclick="solicitarMelhoria('seguranca')" class="btn" style="padding: 16px; background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; text-align: left;">
                üîí Revisar Seguran√ßa
              </button>
              <button onclick="solicitarMelhoria('banco')" class="btn" style="padding: 16px; background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; text-align: left;">
                üóÑÔ∏è Otimizar Banco
              </button>
              <button onclick="solicitarMelhoria('logs')" class="btn" style="padding: 16px; background: #fefce8; border: 1px solid #fde047; color: #854d0e; text-align: left;">
                üìã Melhorar Logs
              </button>
            </div>
          </div>
          
          <!-- ABA REBECA -->
          <div id="aba-rebeca" class="aba-conteudo" style="padding: 20px; display: none;">
            <h4 style="margin: 0 0 16px 0;">üí¨ Melhorias na Rebeca (Assistente WhatsApp)</h4>
            
            <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              <p style="margin: 0; font-size: 13px; color: #166534;">
                üìÅ <strong>Arquivos da Rebeca:</strong><br>
                ‚Ä¢ src/services/openai.js - Prompts e regras de comportamento<br>
                ‚Ä¢ src/conversation/fluxo.js - L√≥gica de conversa<br>
                ‚Ä¢ src/conversation/mensagens.js - Mensagens padr√£o
              </p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
              <button onclick="editarRebeca('prompt-sistema')" class="btn" style="padding: 14px; background: #ede9fe; border: 1px solid #c4b5fd; color: #5b21b6;">
                üìù Editar Prompt Sistema
              </button>
              <button onclick="editarRebeca('mensagens')" class="btn" style="padding: 14px; background: #fce7f3; border: 1px solid #f9a8d4; color: #9d174d;">
                üí¨ Editar Mensagens Padr√£o
              </button>
              <button onclick="editarRebeca('regras')" class="btn" style="padding: 14px; background: #fef3c7; border: 1px solid #fcd34d; color: #92400e;">
                üìã Editar Regras de Comportamento
              </button>
              <button onclick="editarRebeca('intencoes')" class="btn" style="padding: 14px; background: #dbeafe; border: 1px solid #93c5fd; color: #1e40af;">
                üéØ Adicionar Nova Inten√ß√£o
              </button>
            </div>
            
            <h5 style="margin: 16px 0 12px 0;">‚ö° Melhorias R√°pidas:</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
              <button onclick="melhoriaRapidaRebeca('mais-amigavel')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                üòä Tornar mais amig√°vel
              </button>
              <button onclick="melhoriaRapidaRebeca('mais-objetiva')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                üéØ Tornar mais objetiva
              </button>
              <button onclick="melhoriaRapidaRebeca('resposta-rapida')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                ‚ö° Respostas mais r√°pidas
              </button>
              <button onclick="melhoriaRapidaRebeca('melhor-erro')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                üîß Melhorar msgs de erro
              </button>
              <button onclick="melhoriaRapidaRebeca('confirmar-dados')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                ‚úÖ Confirmar dados cliente
              </button>
              <button onclick="melhoriaRapidaRebeca('cancelamento')" class="btn btn-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
                ‚ùå Melhorar cancelamento
              </button>
            </div>
            
            <!-- PREVIEW DO PROMPT ATUAL -->
            <h5 style="margin: 20px 0 12px 0;">üìÑ Prompt Sistema Atual:</h5>
            <div id="preview-prompt" style="background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 11px; max-height: 150px; overflow-y: auto;">
              Carregando prompt atual...
            </div>
            <button onclick="carregarPromptAtual()" class="btn btn-sm btn-secondary" style="margin-top: 8px;">üîÑ Atualizar Preview</button>
          </div>
          
          <!-- ABA ADMIN -->
          <div id="aba-admin" class="aba-conteudo" style="padding: 20px; display: none;">
            <h4 style="margin: 0 0 16px 0;">üñ•Ô∏è Melhorias no Painel Admin</h4>
            
            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              <p style="margin: 0; font-size: 13px; color: #1e40af;">
                üìÅ <strong>Arquivos do Admin:</strong><br>
                ‚Ä¢ src/public/admin/index.html - Interface do painel<br>
                ‚Ä¢ src/api/admin.js - Endpoints da API (111 endpoints)
              </p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
              <button onclick="editarAdmin('nova-pagina')" class="btn" style="padding: 14px; background: #f0fdf4; border: 1px solid #86efac; color: #166534;">
                ‚ûï Adicionar Nova P√°gina
              </button>
              <button onclick="editarAdmin('novo-grafico')" class="btn" style="padding: 14px; background: #dbeafe; border: 1px solid #93c5fd; color: #1e40af;">
                üìä Adicionar Novo Gr√°fico
              </button>
              <button onclick="editarAdmin('novo-relatorio')" class="btn" style="padding: 14px; background: #fef3c7; border: 1px solid #fcd34d; color: #92400e;">
                üìà Novo Relat√≥rio
              </button>
              <button onclick="editarAdmin('melhorar-tabela')" class="btn" style="padding: 14px; background: #fce7f3; border: 1px solid #f9a8d4; color: #9d174d;">
                üìã Melhorar Tabelas
              </button>
            </div>
            
            <h5 style="margin: 16px 0 12px 0;">üìÑ P√°ginas Existentes:</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px;">
              <button onclick="editarPaginaAdmin('dashboard')" class="btn btn-sm" style="background: #f8fafc;">üìä Dashboard</button>
              <button onclick="editarPaginaAdmin('mapa')" class="btn btn-sm" style="background: #f8fafc;">üó∫Ô∏è Mapa</button>
              <button onclick="editarPaginaAdmin('motoristas')" class="btn btn-sm" style="background: #f8fafc;">üöó Motoristas</button>
              <button onclick="editarPaginaAdmin('corridas')" class="btn btn-sm" style="background: #f8fafc;">üõ£Ô∏è Corridas</button>
              <button onclick="editarPaginaAdmin('clientes')" class="btn btn-sm" style="background: #f8fafc;">üë• Clientes</button>
              <button onclick="editarPaginaAdmin('financeiro')" class="btn btn-sm" style="background: #f8fafc;">üí∞ Financeiro</button>
              <button onclick="editarPaginaAdmin('chat')" class="btn btn-sm" style="background: #f8fafc;">üí¨ Chat</button>
              <button onclick="editarPaginaAdmin('config')" class="btn btn-sm" style="background: #f8fafc;">‚öôÔ∏è Config</button>
            </div>
          </div>
          
          <!-- ABA MOTORISTA -->
          <div id="aba-motorista" class="aba-conteudo" style="padding: 20px; display: none;">
            <h4 style="margin: 0 0 16px 0;">üöó Melhorias no Painel Motorista</h4>
            
            <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              <p style="margin: 0; font-size: 13px; color: #92400e;">
                üìÅ <strong>Arquivos do Motorista:</strong><br>
                ‚Ä¢ src/public/motorista/index.html - Interface do app<br>
                ‚Ä¢ src/api/motorista.js - Endpoints da API (38 endpoints)
              </p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <button onclick="editarMotorista('aceitar-corrida')" class="btn" style="padding: 14px; background: #f0fdf4; border: 1px solid #86efac; color: #166534;">
                ‚úÖ Melhorar Aceitar Corrida
              </button>
              <button onclick="editarMotorista('navegacao')" class="btn" style="padding: 14px; background: #dbeafe; border: 1px solid #93c5fd; color: #1e40af;">
                üó∫Ô∏è Melhorar Navega√ß√£o
              </button>
              <button onclick="editarMotorista('ganhos')" class="btn" style="padding: 14px; background: #fef3c7; border: 1px solid #fcd34d; color: #92400e;">
                üí∞ Tela de Ganhos
              </button>
              <button onclick="editarMotorista('notificacoes')" class="btn" style="padding: 14px; background: #fce7f3; border: 1px solid #f9a8d4; color: #9d174d;">
                üîî Notifica√ß√µes
              </button>
            </div>
          </div>
          
          <!-- ABA API -->
          <div id="aba-api" class="aba-conteudo" style="padding: 20px; display: none;">
            <h4 style="margin: 0 0 16px 0;">üîå Melhorias nas APIs</h4>
            
            <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
              <p style="margin: 0; font-size: 13px; color: #5b21b6;">
                üìÅ <strong>Arquivos de API:</strong><br>
                ‚Ä¢ src/api/admin.js - 111 endpoints<br>
                ‚Ä¢ src/api/motorista.js - 38 endpoints<br>
                ‚Ä¢ src/api/master.js - 30+ endpoints<br>
                ‚Ä¢ src/api/auth.js - 10 endpoints
              </p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <button onclick="editarAPI('novo-endpoint')" class="btn" style="padding: 14px; background: #f0fdf4; border: 1px solid #86efac; color: #166534;">
                ‚ûï Criar Novo Endpoint
              </button>
              <button onclick="editarAPI('validacao')" class="btn" style="padding: 14px; background: #fef2f2; border: 1px solid #fecaca; color: #991b1b;">
                üîí Adicionar Valida√ß√£o
              </button>
              <button onclick="editarAPI('documentacao')" class="btn" style="padding: 14px; background: #dbeafe; border: 1px solid #93c5fd; color: #1e40af;">
                üìÑ Gerar Documenta√ß√£o
              </button>
              <button onclick="editarAPI('testes')" class="btn" style="padding: 14px; background: #fef3c7; border: 1px solid #fcd34d; color: #92400e;">
                üß™ Adicionar Testes
              </button>
            </div>
          </div>
          
        </div>

            <!-- CHAT MANUTEN√á√ÉO -->
            <div class="card">
              <div class="card-header" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
                <span class="card-title" style="color: white;">ü§ñ Claude - Manuten√ß√£o em Tempo Real</span>
              </div>
              <div class="card-body" style="padding: 0;">
                
                <!-- √Årea de mensagens -->
                <div id="manutencao-chat" style="height: 350px; overflow-y: auto; padding: 16px; background: #fffbeb;">
                  
                  <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0;">ü§ñ</div>
                    <div style="background: white; padding: 14px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 85%;">
                      <p style="margin: 0; font-weight: 600;">Modo Manuten√ß√£o Ativo! üîß</p>
                      <p style="margin: 8px 0 0 0; color: #64748b; font-size: 13px;">Tenho acesso completo ao sistema. Posso:</p>
                      <ul style="margin: 8px 0 0 16px; padding: 0; color: #64748b; font-size: 13px;">
                        <li>Ver e editar qualquer arquivo do sistema</li>
                        <li>Corrigir bugs em tempo real</li>
                        <li>Adicionar novas funcionalidades</li>
                        <li>Ajustar configura√ß√µes</li>
                        <li>Identificar motoristas para suporte</li>
                        <li>Otimizar performance</li>
                      </ul>
                      <p style="margin: 8px 0 0 0; color: #f59e0b; font-size: 12px; font-weight: 600;">‚ö†Ô∏è Nenhuma altera√ß√£o ser√° feita sem sua confirma√ß√£o!</p>
                    </div>
                  </div>
                  
                </div>
                
                <!-- Input de mensagem -->
                <div style="padding: 12px; border-top: 1px solid #fde68a; display: flex; gap: 12px; background: #fffbeb;">
                  <textarea id="manutencao-input" placeholder="Descreva o problema, melhoria ou solicite informa√ß√µes..." 
                            style="flex: 1; padding: 12px; border: 2px solid #fde68a; border-radius: 10px; font-size: 13px; resize: none; height: 70px;"></textarea>
                  <button onclick="enviarManutencao()" 
                          style="padding: 0 20px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                    Enviar üöÄ
                  </button>
                </div>
                
              </div>
            </div>
            
            <!-- IDENTIFICAR MOTORISTA -->
            <div class="card" style="margin-top: 20px;">
              <div class="card-header">
                <span class="card-title">üöó Identificar Motorista para Suporte</span>
              </div>
              <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                  <input type="text" id="motorista-telefone" placeholder="Telefone do motorista" 
                         style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;">
                  <input type="text" id="motorista-login" placeholder="Login/Email (opcional)" 
                         style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;">
                </div>
                <button onclick="identificarMotorista()" class="btn btn-primary" style="width: 100%;">
                  üîç Buscar Motorista
                </button>
                <div id="motorista-resultado" style="margin-top: 12px; display: none;"></div>
              </div>
            </div>
            
          </div>
          
          <!-- COLUNA DIREITA -->
          <div>
            
            <!-- EXPLORADOR DE ARQUIVOS -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">üìÅ Explorador de Arquivos</span>
                <button class="btn btn-sm btn-secondary" onclick="atualizarArquivos()">üîÑ</button>
              </div>
              <div class="card-body" style="padding: 0;">
                <div id="arvore-arquivos" style="height: 200px; overflow-y: auto; padding: 12px; font-family: monospace; font-size: 12px; background: #f8fafc;">
                  <div style="cursor: pointer;" onclick="expandirPasta('src')">üìÅ src/</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/api')">üìÅ api/</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/api/master.js')">üìÑ master.js</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/api/admin.js')">üìÑ admin.js</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/api/motorista.js')">üìÑ motorista.js</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/conversation')">üìÅ conversation/</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/conversation/fluxo.js')">üìÑ fluxo.js</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/conversation/mensagens.js')">üìÑ mensagens.js</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/services')">üìÅ services/</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/services/openai.js')">üìÑ openai.js</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/services/atribuicao.js')">üìÑ atribuicao.js</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/whatsapp')">üìÅ whatsapp/</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/whatsapp/evolution.js')">üìÑ evolution.js</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/database')">üìÅ database/</div>
                  <div style="margin-left: 32px; cursor: pointer; color: #3b82f6;" onclick="verArquivo('src/database/migrate.js')">üìÑ migrate.js</div>
                  <div style="margin-left: 16px; cursor: pointer;" onclick="expandirPasta('src/public')">üìÅ public/</div>
                </div>
              </div>
            </div>
            
            <!-- VISUALIZADOR/EDITOR DE C√ìDIGO -->
            <div class="card" style="margin-top: 20px;">
              <div class="card-header">
                <span class="card-title">üìù Editor de C√≥digo</span>
                <span id="arquivo-atual" style="color: #64748b; font-size: 12px;"></span>
              </div>
              <div class="card-body" style="padding: 0;">
                <textarea id="codigo-editor" 
                          style="width: 100%; height: 200px; font-family: monospace; font-size: 11px; padding: 12px; border: none; background: #1e293b; color: #e2e8f0; resize: none;"
                          placeholder="Clique em um arquivo para visualizar o c√≥digo..."></textarea>
                <div style="padding: 12px; border-top: 1px solid #e2e8f0; display: flex; gap: 8px;">
                  <button onclick="solicitarAlteracao()" class="btn btn-warning" style="flex: 1;">
                    üìù Solicitar Altera√ß√£o
                  </button>
                </div>
              </div>
            </div>
            
          </div>
          
        </div>
        
        <!-- MODAL DE CONFIRMA√á√ÉO -->
        <div id="modal-confirmacao" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
          <div style="background: white; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow: hidden;">
            <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
              <h3 style="margin: 0;">‚ö†Ô∏è Confirmar Altera√ß√£o</h3>
            </div>
            <div style="padding: 20px; max-height: 50vh; overflow-y: auto;">
              <p style="margin: 0 0 12px 0; font-weight: 600;">Claude quer fazer a seguinte altera√ß√£o:</p>
              <div id="alteracao-descricao" style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-bottom: 16px;"></div>
              <p style="margin: 0 0 12px 0; font-weight: 600;">Arquivo:</p>
              <div id="alteracao-arquivo" style="background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 12px;"></div>
            </div>
            <div style="padding: 20px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px; justify-content: flex-end;">
              <button onclick="fecharModalConfirmacao()" class="btn btn-secondary">‚ùå Recusar</button>
              <button onclick="confirmarAlteracao()" class="btn btn-success">‚úÖ Aprovar e Aplicar</button>
            </div>
          </div>
        </div>
        
        <!-- LOG DE MANUTEN√á√ÉO -->
        <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <span class="card-title">üìã Log de Manuten√ß√£o</span>
            <button class="btn btn-sm btn-secondary" onclick="limparLogManutencao()">üóëÔ∏è Limpar</button>
          </div>
          <div class="card-body">
            <div id="log-manutencao" style="max-height: 150px; overflow-y: auto; font-family: monospace; font-size: 11px; background: #0f172a; color: #94a3b8; padding: 12px; border-radius: 8px;">
              <div style="color: #4ade80;">[SISTEMA] Modo manuten√ß√£o iniciado</div>
              <div style="color: #60a5fa;">[CLAUDE] Pronta para receber comandos</div>
              <div style="color: #fbbf24;">[AVISO] Todas altera√ß√µes requerem confirma√ß√£o</div>
            </div>
          </div>
        </div>
        
      </div>
    </section>

  </main>

  <!-- Painel Suporte -->
  <div class="suporte-panel" id="suporte-panel">
    <div class="suporte-header">
      <div class="suporte-cliente">
        <div class="avatar">UB</div>
        <div>
          <div style="font-weight: 600;">UBMAX Transportes</div>
          <div style="font-size: 12px; color: var(--text-muted);">Motorista n√£o recebe corridas</div>
        </div>
      </div>
      <button class="modal-close" onclick="fecharSuporte()">√ó</button>
    </div>
    <div class="suporte-messages" style="display: flex; flex-direction: column;">
      <div class="suporte-msg cliente">
        Ol√°, meu motorista Jo√£o n√£o est√° recebendo as corridas. O app dele mostra online mas n√£o chega nada.
        <div class="time">14:32</div>
      </div>
      <div class="suporte-msg adm">
        Ol√°! Vou verificar agora. Qual o telefone do motorista?
        <div class="time">14:35</div>
      </div>
      <div class="suporte-msg cliente">
        +55 14 99999-1234
        <div class="time">14:36</div>
      </div>
      <div class="suporte-msg adm">
        Encontrei o problema! O GPS do motorista estava desativado. Pedi pra ele ativar e j√° est√° funcionando ‚úÖ
        <div class="time">14:40</div>
      </div>
    </div>
    <div class="suporte-input">
      <input type="text" placeholder="Digite sua mensagem...">
      <button class="btn btn-primary">Enviar</button>
    </div>
  </div>

  <!-- Modal Nova Empresa -->
  <div class="modal-overlay" id="modal-empresa">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">‚ûï Nova Empresa</span>
        <button class="modal-close" onclick="fecharModalEmpresa()">√ó</button>
      </div>
      <div class="modal-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Nome da Empresa *</label>
            <input type="text" class="form-input" id="nova-empresa-nome" placeholder="Ex: UBMAX Transportes">
          </div>
          <div class="form-group">
            <label class="form-label">WhatsApp do ADM *</label>
            <input type="text" class="form-input" id="nova-empresa-whatsapp" placeholder="+55 14 99999-0000">
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">E-mail do ADM *</label>
            <input type="email" class="form-input" id="nova-empresa-email" placeholder="contato@empresa.com">
          </div>
          <div class="form-group">
            <label class="form-label">Plano *</label>
            <select class="form-select" id="nova-empresa-plano">
              <option value="">Selecione...</option>
              <option value="1">Trial (7 dias gr√°tis)</option>
              <option value="2">B√°sico - R$ 197/m√™s</option>
              <option value="3">Profissional - R$ 397/m√™s</option>
              <option value="4">Enterprise - R$ 797/m√™s</option>
            </select>
          </div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">
        
        <h4 style="margin-bottom: 16px; color: var(--primary);">üìû Telefonia IA (Opcional)</h4>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">Configure agora ou depois na se√ß√£o Telefonia IA</p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">WhatsApp da Rebeca</label>
            <input type="text" class="form-input" id="nova-empresa-whatsapp-rebeca" placeholder="+55 14 99999-1111">
            <small style="color: var(--text-muted);">N√∫mero que a Rebeca usar√° para atender</small>
          </div>
          <div class="form-group">
            <label class="form-label">Telefone Liga√ß√£o IA</label>
            <input type="text" class="form-input" id="nova-empresa-telefone-ia" placeholder="+55 14 3333-0000">
            <small style="color: var(--text-muted);">N√∫mero para atendimento por voz</small>
          </div>
        </div>
        
        <div style="background: #ecfdf5; border-radius: 10px; padding: 16px; margin-top: 16px;">
          <h4 style="color: #065f46; margin-bottom: 8px;">üîó Link de Primeiro Acesso</h4>
          <p style="color: #047857; font-size: 13px; margin-bottom: 12px;">
            Ao criar a empresa, um link √∫nico ser√° gerado para o ADM cadastrar sua pr√≥pria senha no primeiro acesso.
          </p>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="nova-empresa-enviar-link" checked style="width: 18px; height: 18px;">
            <span style="color: #065f46; font-size: 14px;">Enviar link por WhatsApp automaticamente</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalEmpresa()">Cancelar</button>
        <button class="btn btn-success" onclick="criarEmpresa()">‚úì Criar Empresa</button>
      </div>
    </div>
  </div>

  <!-- Modal Link Gerado -->
  <div class="modal-overlay" id="modal-link-gerado">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
        <span class="modal-title">‚úÖ Empresa Criada com Sucesso!</span>
        <button class="modal-close" onclick="fecharModalLinkGerado()" style="color: white;">√ó</button>
      </div>
      <div class="modal-body" style="text-align: center;">
        <div style="font-size: 64px; margin-bottom: 16px;">üéâ</div>
        <h3 style="margin-bottom: 8px;" id="link-empresa-nome">UBMAX Transportes</h3>
        <p style="color: var(--text-muted); margin-bottom: 24px;">Foi criada e o link de acesso foi gerado</p>
        
        <div style="background: var(--bg-input); border-radius: 10px; padding: 16px; margin-bottom: 20px;">
          <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 8px;">Link de Primeiro Acesso</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="form-input" id="link-primeiro-acesso" readonly style="flex: 1; font-size: 12px;">
            <button class="btn btn-primary" onclick="copiarLink()">üìã Copiar</button>
          </div>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: center;">
          <button class="btn btn-success" onclick="enviarLinkWhatsApp()" style="flex: 1;">
            üí¨ Enviar por WhatsApp
          </button>
          <button class="btn btn-outline" onclick="fecharModalLinkGerado()" style="flex: 1;">
            Fechar
          </button>
        </div>
        
        <p style="color: var(--text-muted); font-size: 12px; margin-top: 16px;">
          O ADM usar√° este link para cadastrar sua senha e acessar o painel da frota.
        </p>
      </div>
    </div>
  </div>

  <!-- Modal Editar Empresa -->
  <div class="modal-overlay" id="modal-editar-empresa">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
        <span class="modal-title">‚úèÔ∏è Editar Empresa</span>
        <button class="modal-close" onclick="fecharModalEditar()" style="color: white;">√ó</button>
      </div>
      <div class="modal-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Nome da Empresa</label>
            <input type="text" class="form-input" id="edit-nome" value="UBMAX Transportes">
          </div>
          <div class="form-group">
            <label class="form-label">WhatsApp</label>
            <input type="text" class="form-input" id="edit-whatsapp" value="(14) 99999-0001">
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">E-mail</label>
            <input type="email" class="form-input" id="edit-email" value="contato@ubmax.com">
          </div>
          <div class="form-group">
            <label class="form-label">Cidade</label>
            <input type="text" class="form-input" id="edit-cidade" value="Lins - SP">
          </div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">
        
        <h4 style="margin-bottom: 16px; color: var(--text);">üí≥ Plano e Pagamento</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Plano Atual</label>
            <select class="form-select" id="edit-plano">
              <option value="basico">B√°sico - R$ 197/m√™s</option>
              <option value="profissional" selected>Profissional - R$ 397/m√™s</option>
              <option value="enterprise">Enterprise - R$ 797/m√™s</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Limite de Motoristas</label>
            <input type="number" class="form-input" id="edit-limite-motoristas" value="15">
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Data Vencimento</label>
            <input type="date" class="form-input" id="edit-vencimento" value="2026-02-15">
          </div>
          <div class="form-group">
            <label class="form-label">Status Pagamento</label>
            <select class="form-select" id="edit-status-pagamento">
              <option value="pago" selected>‚úÖ Pago</option>
              <option value="pendente">‚ö†Ô∏è Pendente</option>
              <option value="vencido">‚ùå Vencido</option>
            </select>
          </div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">
        
        <h4 style="margin-bottom: 16px; color: var(--text);">üîí Sistema</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Status do Sistema</label>
            <select class="form-select" id="edit-status-sistema">
              <option value="liberado" selected>üü¢ Liberado</option>
              <option value="bloqueado">üî¥ Bloqueado</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Valor Corrida Fixa</label>
            <input type="text" class="form-input" id="edit-valor-corrida" value="R$ 13,00">
          </div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">
        
        <!-- WHITE LABEL / PERSONALIZA√á√ÉO -->
        <h4 style="margin-bottom: 16px; color: var(--text);">üè∑Ô∏è White Label (Nome Personalizado)</h4>
        <div style="background: linear-gradient(135deg, #ede9fe, #ddd6fe); border: 2px solid #8b5cf6; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="edit-white-label" onchange="toggleWhiteLabel()" style="width: 20px; height: 20px; accent-color: #8b5cf6;">
              <span style="font-weight: 600; color: #5b21b6;">Ativar White Label (+R$ 50/m√™s)</span>
            </label>
          </div>
          
          <div id="white-label-config" style="display: none;">
            <div class="form-group" style="margin-bottom: 12px;">
              <label class="form-label" style="color: #5b21b6;">Nome Exibido no Sistema</label>
              <input type="text" class="form-input" id="edit-nome-exibido" placeholder="Ex: UBMAX Transportes" style="border-color: #8b5cf6;">
            </div>
            <p style="font-size: 12px; color: #6b21a8; margin: 0;">
              ‚ú® Este nome aparecer√° no painel do motorista, ADM e em todas as comunica√ß√µes.
            </p>
          </div>
          
          <div id="white-label-padrao" style="margin-top: 8px;">
            <p style="font-size: 13px; color: #6b21a8; margin: 0;">
              üìå <strong>Padr√£o:</strong> Exibir√° "UBMAX" em todas as telas do cliente.
            </p>
          </div>
        </div>
        
        <div style="background: #fef3c7; border-radius: 8px; padding: 12px; margin-top: 16px;">
          <p style="color: #92400e; font-size: 13px; margin: 0;">
            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Ao bloquear o sistema, o WhatsApp da empresa parar√° de responder at√© ser liberado novamente.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalEditar()">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarEdicaoEmpresa()">üíæ Salvar Altera√ß√µes</button>
      </div>
    </div>
  </div>

  <!-- Modal Novo Plano -->
  <div class="modal-overlay" id="modal-novo-plano">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
        <span class="modal-title">‚ûï Novo Plano</span>
        <button class="modal-close" onclick="fecharModalNovoPlano()" style="color: white;">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nome do Plano *</label>
          <input type="text" class="form-input" id="novo-plano-nome" placeholder="Ex: Premium">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Pre√ßo Mensal (R$) *</label>
            <input type="number" class="form-input" id="novo-plano-preco" placeholder="297">
          </div>
          <div class="form-group">
            <label class="form-label">Limite de Motoristas *</label>
            <input type="number" class="form-input" id="novo-plano-motoristas" placeholder="10">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Recursos (um por linha)</label>
          <textarea class="form-input" id="novo-plano-recursos" rows="4" placeholder="WhatsApp Bot
Painel Motorista
Chat da Frota
Suporte por email"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Pre√ßo por Motorista Adicional (R$)</label>
          <input type="number" class="form-input" id="novo-plano-adicional" placeholder="25">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalNovoPlano()">Cancelar</button>
        <button class="btn btn-success" onclick="salvarNovoPlano()">‚úì Criar Plano</button>
      </div>
    </div>
  </div>

  <!-- Modal Editar Plano -->
  <div class="modal-overlay" id="modal-editar-plano">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
        <span class="modal-title">‚úèÔ∏è Editar Plano</span>
        <button class="modal-close" onclick="fecharModalEditarPlano()" style="color: white;">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nome do Plano</label>
          <input type="text" class="form-input" id="edit-plano-nome" value="B√°sico">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Pre√ßo Mensal (R$)</label>
            <input type="number" class="form-input" id="edit-plano-preco" value="197">
          </div>
          <div class="form-group">
            <label class="form-label">Limite de Motoristas</label>
            <input type="number" class="form-input" id="edit-plano-motoristas" value="5">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Recursos (um por linha)</label>
          <textarea class="form-input" id="edit-plano-recursos" rows="4">WhatsApp Bot
Painel Motorista
Suporte por email</textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Pre√ßo por Motorista Adicional (R$)</label>
          <input type="number" class="form-input" id="edit-plano-adicional" value="25">
        </div>
        
        <div style="background: #fee2e2; border-radius: 8px; padding: 12px; margin-top: 16px;">
          <button class="btn" onclick="excluirPlano()" style="background: #ef4444; color: white; width: 100%;">üóëÔ∏è Excluir Este Plano</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalEditarPlano()">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarEdicaoPlano()">üíæ Salvar Altera√ß√µes</button>
      </div>
    </div>
  </div>

  <!-- Modal Telefonia IA -->
  <div class="modal-overlay" id="modal-telefonia">
    <div class="modal" style="max-width: 550px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #6366f1, #a855f7); color: white;">
        <span class="modal-title">üìû Configurar Telefonia IA</span>
        <button class="modal-close" onclick="fecharModalTelefonia()" style="color: white;">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Empresa *</label>
          <select class="form-select" id="tel-empresa" onchange="carregarTelefoniaEmpresa()">
            <option value="">Selecione uma empresa...</option>
          </select>
        </div>

        <div id="campos-telefonia" style="display: none;">
          <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">
          
          <h4 style="margin-bottom: 16px; color: var(--primary);">üí¨ WhatsApp Rebeca</h4>
          <div class="form-group">
            <label class="form-label">N√∫mero do WhatsApp da Rebeca</label>
            <input type="text" class="form-input" id="tel-whatsapp" placeholder="+55 14 99999-0000">
            <small style="color: var(--text-muted); display: block; margin-top: 4px;">
              N√∫mero que a Rebeca usar√° para atender clientes desta frota
            </small>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border);">

          <h4 style="margin-bottom: 16px; color: var(--success);">üìû Liga√ß√£o Autom√°tica com IA</h4>
          <div class="form-group">
            <label class="form-label">N√∫mero para Liga√ß√µes (Twilio)</label>
            <input type="text" class="form-input" id="tel-ligacao" placeholder="+55 14 3333-0000">
            <small style="color: var(--text-muted); display: block; margin-top: 4px;">
              N√∫mero que receber√° liga√ß√µes e ser√° atendido pela IA
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">Ativar Liga√ß√£o com IA</label>
            <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="tel-ligacao-ativo" style="width: 20px; height: 20px;">
                <span>Liga√ß√£o IA Ativa</span>
              </label>
            </div>
            <small style="color: var(--text-muted); display: block; margin-top: 4px;">
              Quando ativo, a IA atende liga√ß√µes, entende o pedido por voz e registra corridas
            </small>
          </div>

          <div style="background: #ecfdf5; border-radius: 8px; padding: 12px; margin-top: 16px;">
            <p style="color: #065f46; font-size: 13px; margin: 0;">
              <strong>üí° Dica:</strong> Voc√™ pode configurar apenas WhatsApp, apenas Liga√ß√£o, ou ambos.
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModalTelefonia()">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarTelefonia()">üíæ Salvar Configura√ß√£o</button>
      </div>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // Navega√ß√£o entre se√ß√µes
    function mostrarSecao(secao, elemento) {
      // Remover active de todos os nav-items
      document.querySelectorAll('.nav-item').forEach(function(item) {
        item.classList.remove('active');
      });
      
      // Adicionar active ao item clicado
      if (elemento) {
        elemento.classList.add('active');
      }
      
      // Atualizar t√≠tulo do header
      var titulos = {
        'dashboard': 'üìä Dashboard',
        'empresas': 'üè¢ Empresas',
        'assinaturas': 'üí≥ Assinaturas',
        'planos': 'üìã Planos e Pre√ßos',
        'telefonia': 'üìû Telefonia IA',
        'config': '‚öôÔ∏è Configura√ß√µes',
        'logs': 'üìÑ Logs do Sistema',
        'suporte-ia': 'ü§ñ Suporte IA - Claude',
        'manutencao': 'üîß Manuten√ß√£o do Servidor',
        'relatorios': 'üìà Relat√≥rios Globais'
      };
      
      var headerTitulo = document.getElementById('titulo-secao');
      if (headerTitulo && titulos[secao]) {
        headerTitulo.textContent = titulos[secao];
      }
      
      // Esconder todas as se√ß√µes
      document.querySelectorAll('.secao').forEach(function(sec) {
        sec.classList.remove('active');
        sec.style.display = 'none';
      });
      
      // Mostrar se√ß√£o selecionada
      var secaoEl = document.getElementById('sec-' + secao);
      if (secaoEl) {
        secaoEl.classList.add('active');
        secaoEl.style.display = 'block';
      }
      
      // Carregar dados espec√≠ficos da se√ß√£o
      if (secao === 'telefonia') {
        carregarTelefonia();
      }
      
      console.log('Mostrando se√ß√£o:', secao);
    }
    
    function abrirSuporte() {
      document.getElementById('suporte-panel').classList.add('open');
    }
    function fecharSuporte() {
      document.getElementById('suporte-panel').classList.remove('open');
    }
    function abrirModalEmpresa() {
      // Limpar campos
      document.getElementById('nova-empresa-nome').value = '';
      document.getElementById('nova-empresa-whatsapp').value = '';
      document.getElementById('nova-empresa-email').value = '';
      document.getElementById('nova-empresa-plano').value = '';
      document.getElementById('nova-empresa-whatsapp-rebeca').value = '';
      document.getElementById('nova-empresa-telefone-ia').value = '';
      document.getElementById('nova-empresa-enviar-link').checked = true;
      
      document.getElementById('modal-empresa').style.display = 'flex';
    }
    function fecharModalEmpresa() {
      document.getElementById('modal-empresa').style.display = 'none';
    }
    
    // Vari√°vel para guardar dados da empresa criada
    var empresaCriada = null;
    
    // Criar nova empresa
    async function criarEmpresa() {
      const nome = document.getElementById('nova-empresa-nome').value.trim();
      const whatsapp = document.getElementById('nova-empresa-whatsapp').value.trim();
      const email = document.getElementById('nova-empresa-email').value.trim();
      const plano = document.getElementById('nova-empresa-plano').value;
      const whatsappRebeca = document.getElementById('nova-empresa-whatsapp-rebeca').value.trim();
      const telefoneIa = document.getElementById('nova-empresa-telefone-ia').value.trim();
      const enviarLink = document.getElementById('nova-empresa-enviar-link').checked;
      
      // Valida√ß√µes
      if (!nome) {
        alert('‚ö†Ô∏è Digite o nome da empresa');
        return;
      }
      if (!whatsapp) {
        alert('‚ö†Ô∏è Digite o WhatsApp do ADM');
        return;
      }
      if (!email) {
        alert('‚ö†Ô∏è Digite o e-mail do ADM');
        return;
      }
      if (!plano) {
        alert('‚ö†Ô∏è Selecione um plano');
        return;
      }
      
      try {
        const token = localStorage.getItem('master_token');
        
        const res = await fetch('/api/master/empresas', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            nome,
            telefone: whatsapp,
            email,
            plano_id: parseInt(plano),
            whatsapp_rebeca: whatsappRebeca || null,
            telefone_ia: telefoneIa || null,
            ligacao_ia_ativo: telefoneIa ? true : false
          })
        });
        
        const data = await res.json();
        
        if (data.success) {
          empresaCriada = {
            ...data.data,
            whatsapp: whatsapp,
            enviarLink: enviarLink
          };
          
          // Fechar modal de criar
          fecharModalEmpresa();
          
          // Mostrar modal com link gerado
          document.getElementById('link-empresa-nome').textContent = nome;
          document.getElementById('link-primeiro-acesso').value = data.data.link_primeiro_acesso || 
            window.location.origin + '/admin/primeiro-acesso?token=' + data.data.token_primeiro_acesso;
          
          document.getElementById('modal-link-gerado').style.display = 'flex';
          
          // Se marcou enviar por WhatsApp, enviar automaticamente
          if (enviarLink) {
            enviarLinkWhatsApp();
          }
        } else {
          alert('‚ùå Erro ao criar empresa: ' + (data.error || 'Erro desconhecido'));
        }
      } catch (error) {
        console.error('Erro:', error);
        alert('‚ùå Erro de conex√£o ao criar empresa');
      }
    }
    
    function fecharModalLinkGerado() {
      document.getElementById('modal-link-gerado').style.display = 'none';
      location.reload(); // Recarregar para mostrar nova empresa
    }
    
    function copiarLink() {
      const input = document.getElementById('link-primeiro-acesso');
      input.select();
      document.execCommand('copy');
      alert('‚úÖ Link copiado!');
    }
    
    function enviarLinkWhatsApp() {
      if (!empresaCriada) return;
      
      const link = document.getElementById('link-primeiro-acesso').value;
      const msg = `üöÄ *Bem-vindo ao UBMAX!*\n\n` +
                  `Ol√°! Sua empresa *${empresaCriada.nome}* foi cadastrada com sucesso.\n\n` +
                  `Acesse o link abaixo para cadastrar sua senha e come√ßar a usar o sistema:\n\n` +
                  `${link}\n\n` +
                  `Este link √© √∫nico e expira em 24 horas.\n\n` +
                  `Qualquer d√∫vida, estamos √† disposi√ß√£o! üí¨`;
      
      const whatsapp = empresaCriada.whatsapp.replace(/\D/g, '');
      window.open('https://wa.me/' + whatsapp + '?text=' + encodeURIComponent(msg), '_blank');
    }
    
    // Fun√ß√µes de Liberar/Bloquear Empresa
    function liberarEmpresa(empresaId) {
      if (confirm('Liberar sistema para esta empresa?\n\nIsso permitir√° que ela volte a usar o WhatsApp e o sistema.')) {
        alert('‚úÖ Empresa ' + empresaId + ' LIBERADA!\n\nO sistema voltar√° a funcionar imediatamente.');
        // Aqui chamaria API para liberar
        location.reload();
      }
    }
    
    function bloquearEmpresa(empresaId) {
      if (confirm('‚ö†Ô∏è BLOQUEAR esta empresa?\n\nO WhatsApp vai parar de responder e o sistema ficar√° indispon√≠vel at√© o pagamento.')) {
        alert('üö´ Empresa ' + empresaId + ' BLOQUEADA!\n\nO WhatsApp n√£o responder√° mais at√© ser liberada.');
        // Aqui chamaria API para bloquear
        location.reload();
      }
    }
    
    function verEmpresa(empresaId) {
      alert('Visualizando detalhes da empresa: ' + empresaId);
    }
    
    // Vari√°vel para guardar empresa sendo editada
    var empresaEditando = null;
    
    function editarEmpresa(empresaId) {
      // Carregar dados da empresa (simulado)
      var empresas = {
        'UBMAX': { nome: 'UBMAX Transportes', whatsapp: '(14) 99999-0001', email: 'contato@ubmax.com', cidade: 'Lins - SP', plano: 'profissional', motoristas: 15, vencimento: '2026-02-15', statusPagamento: 'pago', statusSistema: 'liberado', valorCorrida: 'R$ 13,00', whiteLabel: true, nomeExibido: 'UBMAX Transportes' },
        'RC': { nome: 'R√°pido City', whatsapp: '(11) 98888-0002', email: 'contato@rapidocity.com', cidade: 'S√£o Paulo - SP', plano: 'basico', motoristas: 5, vencimento: '2026-01-12', statusPagamento: 'pendente', statusSistema: 'liberado', valorCorrida: 'R$ 15,00', whiteLabel: false, nomeExibido: '' },
        'MV': { nome: 'Move Express', whatsapp: '(21) 96666-0005', email: 'contato@move.com', cidade: 'Rio de Janeiro - RJ', plano: 'basico', motoristas: 5, vencimento: '2025-12-26', statusPagamento: 'vencido', statusSistema: 'bloqueado', valorCorrida: 'R$ 12,00', whiteLabel: false, nomeExibido: '' },
        'TL': { nome: 'TransLog', whatsapp: '(31) 95555-0006', email: 'contato@translog.com', cidade: 'Belo Horizonte - MG', plano: 'profissional', motoristas: 15, vencimento: '2026-01-02', statusPagamento: 'vencido', statusSistema: 'bloqueado', valorCorrida: 'R$ 14,00', whiteLabel: false, nomeExibido: '' },
        'TC': { nome: 'T√°xi Central', whatsapp: '(19) 97777-0003', email: 'contato@taxicentral.com', cidade: 'Campinas - SP', plano: 'enterprise', motoristas: 999, vencimento: '2026-01-20', statusPagamento: 'pago', statusSistema: 'liberado', valorCorrida: 'R$ 18,00', whiteLabel: true, nomeExibido: 'T√°xi Central' }
      };
      
      var emp = empresas[empresaId] || empresas['UBMAX'];
      empresaEditando = empresaId;
      
      // Preencher modal
      document.getElementById('edit-nome').value = emp.nome;
      document.getElementById('edit-whatsapp').value = emp.whatsapp;
      document.getElementById('edit-email').value = emp.email;
      document.getElementById('edit-cidade').value = emp.cidade;
      document.getElementById('edit-plano').value = emp.plano;
      document.getElementById('edit-limite-motoristas').value = emp.motoristas;
      document.getElementById('edit-vencimento').value = emp.vencimento;
      document.getElementById('edit-status-pagamento').value = emp.statusPagamento;
      document.getElementById('edit-status-sistema').value = emp.statusSistema;
      document.getElementById('edit-valor-corrida').value = emp.valorCorrida;
      
      // White Label
      document.getElementById('edit-white-label').checked = emp.whiteLabel || false;
      document.getElementById('edit-nome-exibido').value = emp.nomeExibido || emp.nome;
      toggleWhiteLabel();
      
      // Abrir modal
      document.getElementById('modal-editar-empresa').style.display = 'flex';
    }
    
    // Toggle White Label
    function toggleWhiteLabel() {
      var ativo = document.getElementById('edit-white-label').checked;
      document.getElementById('white-label-config').style.display = ativo ? 'block' : 'none';
      document.getElementById('white-label-padrao').style.display = ativo ? 'none' : 'block';
      
      // Se ativar, preencher com nome da empresa
      if (ativo && !document.getElementById('edit-nome-exibido').value) {
        document.getElementById('edit-nome-exibido').value = document.getElementById('edit-nome').value;
      }
    }
    
    function fecharModalEditar() {
      document.getElementById('modal-editar-empresa').style.display = 'none';
      empresaEditando = null;
    }
    
    function salvarEdicaoEmpresa() {
      var whiteLabel = document.getElementById('edit-white-label').checked;
      var nomeExibido = whiteLabel ? document.getElementById('edit-nome-exibido').value : 'UBMAX';
      
      var dados = {
        nome: document.getElementById('edit-nome').value,
        email: document.getElementById('edit-email').value,
        telefone: document.getElementById('edit-whatsapp').value,
        plano: document.getElementById('edit-plano').value,
        statusSistema: document.getElementById('edit-status-sistema').value,
        white_label: whiteLabel,
        nome_exibido: nomeExibido,
        // Para compatibilidade com localStorage
        whiteLabel: whiteLabel,
        nomeExibido: nomeExibido
      };
      
      // Salvar no localStorage para funcionar offline
      var empresasConfig = JSON.parse(localStorage.getItem('empresas_config') || '{}');
      empresasConfig[empresaEditando] = dados;
      localStorage.setItem('empresas_config', JSON.stringify(empresasConfig));
      
      // Tentar salvar via API tamb√©m (se servidor estiver ativo)
      var token = localStorage.getItem('master_token');
      if (token) {
        fetch('/api/master/empresas/' + empresaEditando, {
          method: 'PUT',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(dados)
        })
        .then(function(r) { return r.json(); })
        .then(function(result) {
          console.log('‚úÖ Empresa salva no servidor:', result);
        })
        .catch(function(err) {
          console.log('‚ö†Ô∏è Servidor offline, dados salvos apenas localmente');
        });
      }
      
      var mensagem = '‚úÖ Empresa atualizada com sucesso!\n\n' + 
            'Nome: ' + dados.nome + '\n' +
            'Plano: ' + dados.plano + '\n' +
            'Sistema: ' + (dados.statusSistema === 'liberado' ? 'üü¢ Liberado' : 'üî¥ Bloqueado') + '\n\n' +
            'üè∑Ô∏è White Label: ' + (whiteLabel ? '‚úÖ ATIVO (+R$50/m√™s)' : '‚ùå Desativado (exibe UBMAX)') + '\n' +
            'üìõ Nome Exibido: ' + nomeExibido;
      
      alert(mensagem);
      
      fecharModalEditar();
    }
    
    function editarPlano(planoId) {
      // Dados dos planos
      var planos = {
        'basico': { nome: 'B√°sico', preco: 197, motoristas: 5, recursos: 'WhatsApp Bot\nPainel Motorista\nSuporte por email', adicional: 25 },
        'profissional': { nome: 'Profissional', preco: 397, motoristas: 15, recursos: 'Tudo do B√°sico\nChat da Frota\nRastreamento GPS\nSuporte priorit√°rio', adicional: 20 },
        'enterprise': { nome: 'Enterprise', preco: 797, motoristas: 999, recursos: 'Tudo do Profissional\nAPI Personalizada\nMarca Branca\nSuporte 24h', adicional: 0 }
      };
      
      var plano = planos[planoId] || planos['basico'];
      
      document.getElementById('edit-plano-nome').value = plano.nome;
      document.getElementById('edit-plano-preco').value = plano.preco;
      document.getElementById('edit-plano-motoristas').value = plano.motoristas;
      document.getElementById('edit-plano-recursos').value = plano.recursos;
      document.getElementById('edit-plano-adicional').value = plano.adicional;
      
      document.getElementById('modal-editar-plano').style.display = 'flex';
    }
    
    function fecharModalEditarPlano() {
      document.getElementById('modal-editar-plano').style.display = 'none';
    }
    
    function salvarEdicaoPlano() {
      var dados = {
        nome: document.getElementById('edit-plano-nome').value,
        preco: document.getElementById('edit-plano-preco').value,
        motoristas: document.getElementById('edit-plano-motoristas').value
      };
      
      alert('‚úÖ Plano atualizado com sucesso!\n\n' +
            'Nome: ' + dados.nome + '\n' +
            'Pre√ßo: R$ ' + dados.preco + '/m√™s\n' +
            'Motoristas: ' + dados.motoristas);
      
      fecharModalEditarPlano();
      location.reload();
    }
    
    function excluirPlano() {
      if (confirm('‚ö†Ô∏è Tem certeza que deseja EXCLUIR este plano?\n\nEmpresas com este plano precisar√£o migrar para outro.')) {
        alert('üóëÔ∏è Plano exclu√≠do!');
        fecharModalEditarPlano();
        location.reload();
      }
    }
    
    function novoPlano() {
      document.getElementById('novo-plano-nome').value = '';
      document.getElementById('novo-plano-preco').value = '';
      document.getElementById('novo-plano-motoristas').value = '';
      document.getElementById('novo-plano-recursos').value = '';
      document.getElementById('novo-plano-adicional').value = '';
      
      document.getElementById('modal-novo-plano').style.display = 'flex';
    }
    
    function fecharModalNovoPlano() {
      document.getElementById('modal-novo-plano').style.display = 'none';
    }
    
    function salvarNovoPlano() {
      var nome = document.getElementById('novo-plano-nome').value;
      var preco = document.getElementById('novo-plano-preco').value;
      var motoristas = document.getElementById('novo-plano-motoristas').value;
      
      if (!nome || !preco || !motoristas) {
        alert('‚ö†Ô∏è Preencha todos os campos obrigat√≥rios!');
        return;
      }
      
      alert('‚úÖ Plano criado com sucesso!\n\n' +
            'Nome: ' + nome + '\n' +
            'Pre√ßo: R$ ' + preco + '/m√™s\n' +
            'Motoristas: ' + motoristas);
      
      fecharModalNovoPlano();
      location.reload();
    }
    
    // Fun√ß√µes de contato com motorista
    function ligarMotorista(telefone) {
      window.location.href = 'tel:+55' + telefone.replace(/\D/g, '');
    }
    
    function whatsappMotorista(telefone) {
      var msg = 'Ol√°! Aqui √© o suporte do UBMAX. Recebemos seu ticket de suporte.';
      window.open('https://wa.me/55' + telefone.replace(/\D/g, '') + '?text=' + encodeURIComponent(msg), '_blank');
    }
    
    function abrirTicket(ticketId) {
      alert('Abrindo detalhes do ticket #' + ticketId);
      // Aqui abriria um modal com todos os detalhes do ticket
    }

    // ========================================
    // FUN√á√ïES TELEFONIA IA
    // ========================================

    var empresasCache = [];
    var empresaTelefoniaAtual = null;

    // Carregar lista de empresas com telefonia
    async function carregarTelefonia() {
      const token = localStorage.getItem('master_token');
      
      if (!token) {
        console.log('Sem token, n√£o carrega telefonia');
        return;
      }
      
      try {
        // Carregar empresas com telefonia configurada
        const res = await fetch('/api/master/telefonia/empresas', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        // Verificar se resposta √© JSON
        const contentType = res.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          throw new Error('Servidor retornou resposta inv√°lida');
        }
        
        const data = await res.json();
        
        if (data.success) {
          renderizarTabelaTelefonia(data.data);
        } else if (data.error === 'Token n√£o fornecido' || data.error === 'Acesso negado') {
          // Token inv√°lido, fazer logout
          alert('Sess√£o expirada. Fa√ßa login novamente.');
          fazerLogout();
        } else {
          console.error('Erro:', data.error);
          renderizarTabelaTelefonia([]);
        }
      } catch (error) {
        console.error('Erro ao carregar telefonia:', error);
        document.getElementById('lista-telefonia').innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);">
              <div style="font-size: 48px; margin-bottom: 12px;">‚ö†Ô∏è</div>
              <div>Erro ao carregar dados</div>
              <button class="btn btn-outline" style="margin-top: 16px;" onclick="carregarTelefonia()">üîÑ Tentar Novamente</button>
            </td>
          </tr>
        `;
      }
    }

    function renderizarTabelaTelefonia(empresas) {
      const tbody = document.getElementById('lista-telefonia');
      
      if (!empresas || empresas.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);">
              <div style="font-size: 48px; margin-bottom: 12px;">üìû</div>
              <div>Nenhuma empresa com telefonia configurada</div>
              <button class="btn btn-primary" style="margin-top: 16px;" onclick="abrirModalTelefonia()">+ Configurar Primeira Empresa</button>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = empresas.map(emp => `
        <tr>
          <td>
            <div class="user-cell">
              <div class="avatar" style="background: ${emp.status === 'ativa' ? 'var(--success)' : 'var(--warning)'};">
                ${emp.nome.substring(0, 2).toUpperCase()}
              </div>
              <div>
                <div class="user-name">${emp.nome}</div>
                <div class="user-phone">${emp.plano_nome || 'Sem plano'}</div>
              </div>
            </div>
          </td>
          <td>
            ${emp.whatsapp_rebeca ? `
              <span style="color: var(--success);">‚úÖ ${formatarTelefone(emp.whatsapp_rebeca)}</span>
            ` : `
              <span style="color: var(--text-muted);">‚Äî N√£o configurado</span>
            `}
          </td>
          <td>
            ${emp.telefone_ia ? `
              <span style="color: var(--primary);">üìû ${formatarTelefone(emp.telefone_ia)}</span>
            ` : `
              <span style="color: var(--text-muted);">‚Äî N√£o configurado</span>
            `}
          </td>
          <td>
            ${emp.ligacao_ia_ativo ? `
              <span class="status ativa">üü¢ Ativo</span>
            ` : `
              <span class="status" style="background: rgba(100,100,100,0.2); color: #666;">‚ö™ Inativo</span>
            `}
          </td>
          <td>
            <span class="status ${emp.status}">${emp.status === 'ativa' ? 'üü¢ Ativa' : emp.status === 'trial' ? 'üü° Trial' : 'üî¥ ' + emp.status}</span>
          </td>
          <td>
            <div class="actions">
              <button class="action-btn edit" onclick="editarTelefonia(${emp.id})" title="Editar">‚úèÔ∏è</button>
              <button class="action-btn block" onclick="removerTelefonia(${emp.id})" title="Remover Configura√ß√£o">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function formatarTelefone(tel) {
      if (!tel) return '';
      // Remove tudo que n√£o √© n√∫mero
      const nums = tel.replace(/\D/g, '');
      // Formata
      if (nums.length === 13) { // +55 + DDD + 9 d√≠gitos
        return `+${nums.slice(0,2)} (${nums.slice(2,4)}) ${nums.slice(4,9)}-${nums.slice(9)}`;
      } else if (nums.length === 11) { // DDD + 9 d√≠gitos
        return `(${nums.slice(0,2)}) ${nums.slice(2,7)}-${nums.slice(7)}`;
      }
      return tel;
    }

    // Abrir modal de telefonia
    async function abrirModalTelefonia() {
      try {
        const token = localStorage.getItem('master_token');
        
        // Carregar todas as empresas
        const res = await fetch('/api/master/empresas', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        
        if (data.success) {
          empresasCache = data.data;
          
          const select = document.getElementById('tel-empresa');
          select.innerHTML = '<option value="">Selecione uma empresa...</option>' +
            data.data.map(emp => `<option value="${emp.id}">${emp.nome} (${emp.status})</option>`).join('');
        }
        
        // Limpar campos
        document.getElementById('tel-whatsapp').value = '';
        document.getElementById('tel-ligacao').value = '';
        document.getElementById('tel-ligacao-ativo').checked = false;
        document.getElementById('campos-telefonia').style.display = 'none';
        empresaTelefoniaAtual = null;
        
        document.getElementById('modal-telefonia').style.display = 'flex';
      } catch (error) {
        console.error('Erro ao abrir modal:', error);
        alert('Erro ao carregar empresas');
      }
    }

    function fecharModalTelefonia() {
      document.getElementById('modal-telefonia').style.display = 'none';
    }

    // Carregar dados de telefonia da empresa selecionada
    async function carregarTelefoniaEmpresa() {
      const empresaId = document.getElementById('tel-empresa').value;
      
      if (!empresaId) {
        document.getElementById('campos-telefonia').style.display = 'none';
        return;
      }
      
      empresaTelefoniaAtual = empresaId;
      
      try {
        const token = localStorage.getItem('master_token');
        const res = await fetch(`/api/master/empresas/${empresaId}/telefonia`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        
        if (data.success) {
          document.getElementById('tel-whatsapp').value = data.data.whatsapp_rebeca || '';
          document.getElementById('tel-ligacao').value = data.data.telefone_ia || '';
          document.getElementById('tel-ligacao-ativo').checked = data.data.ligacao_ia_ativo || false;
        }
        
        document.getElementById('campos-telefonia').style.display = 'block';
      } catch (error) {
        console.error('Erro ao carregar telefonia:', error);
        document.getElementById('campos-telefonia').style.display = 'block';
      }
    }

    // Salvar configura√ß√£o de telefonia
    async function salvarTelefonia() {
      const empresaId = document.getElementById('tel-empresa').value;
      
      if (!empresaId) {
        alert('‚ö†Ô∏è Selecione uma empresa!');
        return;
      }
      
      const whatsapp = document.getElementById('tel-whatsapp').value.trim();
      const telefone = document.getElementById('tel-ligacao').value.trim();
      const ligacaoAtivo = document.getElementById('tel-ligacao-ativo').checked;
      
      if (!whatsapp && !telefone) {
        alert('‚ö†Ô∏è Configure pelo menos um n√∫mero (WhatsApp ou Telefone)!');
        return;
      }
      
      try {
        const token = localStorage.getItem('master_token');
        const res = await fetch(`/api/master/empresas/${empresaId}/configurar-telefonia`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            whatsapp_rebeca: whatsapp || null,
            telefone_ia: telefone || null,
            ligacao_ia_ativo: ligacaoAtivo
          })
        });
        
        const data = await res.json();
        
        if (data.success) {
          alert('‚úÖ Telefonia configurada com sucesso!\n\nA Rebeca agora atender√° clientes desta frota.');
          fecharModalTelefonia();
          carregarTelefonia();
        } else {
          alert('‚ùå Erro: ' + data.error);
        }
      } catch (error) {
        console.error('Erro ao salvar:', error);
        alert('‚ùå Erro ao salvar configura√ß√£o');
      }
    }

    // Editar telefonia de empresa espec√≠fica
    async function editarTelefonia(empresaId) {
      await abrirModalTelefonia();
      document.getElementById('tel-empresa').value = empresaId;
      await carregarTelefoniaEmpresa();
    }

    // Remover configura√ß√£o de telefonia
    async function removerTelefonia(empresaId) {
      if (!confirm('‚ö†Ô∏è Remover configura√ß√£o de telefonia desta empresa?\n\nA Rebeca deixar√° de atender os clientes desta frota.')) {
        return;
      }
      
      try {
        const token = localStorage.getItem('master_token');
        const res = await fetch(`/api/master/empresas/${empresaId}/configurar-telefonia`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            whatsapp_rebeca: null,
            telefone_ia: null,
            ligacao_ia_ativo: false
          })
        });
        
        const data = await res.json();
        
        if (data.success) {
          alert('‚úÖ Configura√ß√£o removida!');
          carregarTelefonia();
        } else {
          alert('‚ùå Erro: ' + data.error);
        }
      } catch (error) {
        console.error('Erro ao remover:', error);
        alert('‚ùå Erro ao remover configura√ß√£o');
      }
    }

    // Atualizar t√≠tulo da se√ß√£o telefonia
    var titulos = {
      'dashboard': 'üìä Dashboard',
      'empresas': 'üè¢ Empresas',
      'assinaturas': 'üí≥ Assinaturas',
      'planos': 'üìã Planos e Pre√ßos',
      'telefonia': 'üìû Telefonia IA',
      'config': '‚öôÔ∏è Configura√ß√µes',
      'logs': 'üìÑ Logs do Sistema',
        'suporte-ia': 'ü§ñ Suporte IA - Claude',
        'manutencao': 'üîß Manuten√ß√£o do Servidor',
        'relatorios': 'üìà Relat√≥rios Globais'
    };

    // ========================================
    // LOGIN
    // ========================================
    async function fazerLogin() {
      const email = document.getElementById('login-email').value;
      const senha = document.getElementById('login-senha').value;
      const erroEl = document.getElementById('login-erro');
      
      erroEl.style.display = 'none';
      
      // ==========================================
      // CREDENCIAIS MASTER (funciona offline)
      // ==========================================
      if (email === 'adautoaraujo414@gmail.com' && senha === 'Ci851213@') {
        localStorage.setItem('master_token', 'MASTER-TOKEN-' + Date.now());
        localStorage.setItem('master_nome', 'Adauto Ara√∫jo');
        
        document.getElementById('tela-login').style.display = 'none';
        document.getElementById('painel-principal').style.display = 'block';
        
        carregarDashboard();
        return;
      }
      // ==========================================
      
      try {
        const res = await fetch('/api/master/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, senha })
        });
        
        // Verificar se retornou JSON v√°lido
        const contentType = res.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          throw new Error('Servidor n√£o dispon√≠vel');
        }
        
        const data = await res.json();
        
        if (data.success) {
          localStorage.setItem('master_token', data.token);
          localStorage.setItem('master_nome', data.usuario.nome);
          
          document.getElementById('tela-login').style.display = 'none';
          document.getElementById('painel-principal').style.display = 'block';
          
          // Carregar dados iniciais
          carregarDashboard();
        } else {
          erroEl.textContent = data.error || 'Email ou senha incorretos';
          erroEl.style.display = 'block';
        }
      } catch (error) {
        console.error('Erro login:', error);
        erroEl.textContent = 'Email ou senha incorretos';
        erroEl.style.display = 'block';
      }
    }
    
    function fazerLogout() {
      localStorage.removeItem('master_token');
      localStorage.removeItem('master_nome');
      location.reload();
    }
    
    async function carregarDashboard() {
      // Por enquanto apenas log
      console.log('Dashboard carregado');
    }

    // Ao carregar a p√°gina, verificar se j√° est√° logado
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('master_token');
      
      if (token) {
        // J√° est√° logado, mostrar painel
        document.getElementById('tela-login').style.display = 'none';
        document.getElementById('painel-principal').style.display = 'block';
        carregarDashboard();
      }
      
      // Enter no campo de senha faz login
      document.getElementById('login-senha').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') fazerLogin();
      });
    });
  </script>
  </div><!-- Fecha painel-principal -->
<script>

    // ========================================
    // SUPORTE IA - CLAUDE
    // ========================================
    
    const SENHA_SUPORTE = 'Ci851213@';
    var suporteAutenticado = false;
    
    function verificarSenhaSuporte() {
      var senha = document.getElementById('suporte-senha').value;
      var erroEl = document.getElementById('suporte-erro');
      
      if (senha === SENHA_SUPORTE) {
        suporteAutenticado = true;
        document.getElementById('suporte-login').style.display = 'none';
        document.getElementById('suporte-painel').style.display = 'block';
        adicionarLog('Acesso autorizado ao Suporte IA', 'success');
      } else {
        erroEl.style.display = 'block';
        setTimeout(function() {
          erroEl.style.display = 'none';
        }, 3000);
      }
    }
    
    // Permitir Enter para enviar senha
    document.addEventListener('DOMContentLoaded', function() {
      var inputSenha = document.getElementById('suporte-senha');
      if (inputSenha) {
        inputSenha.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') verificarSenhaSuporte();
        });
      }
    });
    
    async function enviarParaClaude() {
      var input = document.getElementById('suporte-input');
      var mensagem = input.value.trim();
      
      if (!mensagem) return;
      
      // Adicionar mensagem do usu√°rio
      adicionarMensagemChat('user', mensagem);
      input.value = '';
      
      // Mostrar indicador de digitando
      var chatDiv = document.getElementById('suporte-chat');
      var typingDiv = document.createElement('div');
      typingDiv.id = 'typing-indicator';
      typingDiv.innerHTML = '<div style="display: flex; gap: 12px; margin-bottom: 16px;"><div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; flex-shrink: 0;">ü§ñ</div><div style="background: white; padding: 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"><p style="margin: 0; color: #64748b;">Analisando e processando...</p></div></div>';
      chatDiv.appendChild(typingDiv);
      chatDiv.scrollTop = chatDiv.scrollHeight;
      
      try {
        // Enviar para API do Claude
        var response = await fetch('/api/master/suporte/claude', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({ mensagem: mensagem })
        });
        
        var data = await response.json();
        
        // Remover indicador de digitando
        var typing = document.getElementById('typing-indicator');
        if (typing) typing.remove();
        
        if (data.success) {
          adicionarMensagemChat('claude', data.resposta);
          
          if (data.alteracoes && data.alteracoes.length > 0) {
            data.alteracoes.forEach(function(alt) {
              adicionarLog(alt, 'info');
            });
          }
          
          if (data.executado) {
            adicionarLog('Altera√ß√£o aplicada com sucesso!', 'success');
          }
        } else {
          adicionarMensagemChat('claude', 'Desculpe, ocorreu um erro: ' + (data.error || 'Erro desconhecido'));
        }
        
      } catch (error) {
        // Remover indicador de digitando
        var typing = document.getElementById('typing-indicator');
        if (typing) typing.remove();
        
        // Modo offline - simular resposta
        var respostaOffline = processarMensagemOffline(mensagem);
        adicionarMensagemChat('claude', respostaOffline);
      }
    }
    
    function processarMensagemOffline(mensagem) {
      var msg = mensagem.toLowerCase();
      
      if (msg.includes('erro') || msg.includes('bug') || msg.includes('problema')) {
        return 'Entendi que voc√™ est√° enfrentando um problema. Para corrigi-lo, preciso de mais detalhes:\\n\\n1. Qual p√°gina/funcionalidade est√° com problema?\\n2. O que deveria acontecer?\\n3. O que est√° acontecendo?\\n\\nCom essas informa√ß√µes, posso identificar e corrigir o bug.';
      }
      
      if (msg.includes('adicionar') || msg.includes('criar') || msg.includes('novo')) {
        return 'Voc√™ quer adicionar uma nova funcionalidade! üöÄ\\n\\nPor favor, descreva:\\n1. O que essa funcionalidade deve fazer\\n2. Em qual painel ela deve aparecer\\n3. Como deve funcionar\\n\\nAssim posso implementar da melhor forma.';
      }
      
      if (msg.includes('rebeca') || msg.includes('whatsapp')) {
        return 'Voc√™ quer ajustar a Rebeca! ü§ñ\\n\\nPosso ajudar com:\\n‚Ä¢ Mudar mensagens padr√£o\\n‚Ä¢ Ajustar comportamento\\n‚Ä¢ Adicionar novas respostas\\n‚Ä¢ Modificar regras de atendimento\\n\\nO que especificamente voc√™ quer alterar?';
      }
      
      if (msg.includes('valor') || msg.includes('pre√ßo') || msg.includes('tarifa')) {
        return 'Para ajustar valores e tarifas, acesse:\\n\\nüìç Painel Admin ‚Üí Configura√ß√µes ‚Üí Tarifas\\n\\nL√° voc√™ pode configurar:\\n‚Ä¢ Valor por km\\n‚Ä¢ Valor m√≠nimo\\n‚Ä¢ Taxa de bandeira\\n‚Ä¢ Hor√°rios especiais\\n\\nPrecisa que eu ajuste algo espec√≠fico no c√≥digo?';
      }
      
      return 'Entendi! Vou analisar sua solicita√ß√£o. üìù\\n\\nPara fazer altera√ß√µes no sistema em tempo real, preciso que voc√™ descreva com mais detalhes:\\n\\n1. Qual funcionalidade quer modificar\\n2. Como deve funcionar ap√≥s a altera√ß√£o\\n3. Se √© urgente ou pode ser agendado\\n\\nAssim posso aplicar as mudan√ßas de forma segura sem interromper o sistema.';
    }
    
    function adicionarMensagemChat(tipo, texto) {
      var chatDiv = document.getElementById('suporte-chat');
      var msgDiv = document.createElement('div');
      msgDiv.style.cssText = 'display: flex; gap: 12px; margin-bottom: 16px;';
      
      if (tipo === 'user') {
        msgDiv.style.flexDirection = 'row-reverse';
        msgDiv.innerHTML = '<div style="width: 40px; height: 40px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; flex-shrink: 0;">üë§</div><div style="background: #10b981; color: white; padding: 16px; border-radius: 12px; max-width: 80%;"><p style="margin: 0;">' + texto.replace(/\n/g, '<br>') + '</p></div>';
      } else {
        msgDiv.innerHTML = '<div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; flex-shrink: 0;">ü§ñ</div><div style="background: white; padding: 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 80%;"><p style="margin: 0;">' + texto.replace(/\\n/g, '<br>').replace(/\n/g, '<br>') + '</p></div>';
      }
      
      chatDiv.appendChild(msgDiv);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }
    
    function adicionarLog(mensagem, tipo) {
      var logDiv = document.getElementById('log-alteracoes');
      var now = new Date();
      var timestamp = now.toISOString().slice(0, 19).replace('T', ' ');
      
      var cores = {
        'success': '#4ade80',
        'error': '#f87171',
        'info': '#60a5fa',
        'warning': '#fbbf24'
      };
      
      var logEntry = document.createElement('div');
      logEntry.style.color = cores[tipo] || '#94a3b8';
      logEntry.textContent = '[' + timestamp + '] ' + mensagem;
      
      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    async function acaoRapida(acao) {
      adicionarLog('Executando: ' + acao, 'info');
      
      try {
        var response = await fetch('/api/master/suporte/acao', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({ acao: acao })
        });
        
        var data = await response.json();
        
        if (data.success) {
          adicionarLog(data.mensagem || 'A√ß√£o executada com sucesso!', 'success');
          adicionarMensagemChat('claude', '‚úÖ ' + (data.mensagem || 'A√ß√£o executada com sucesso!'));
        } else {
          adicionarLog('Erro: ' + (data.error || 'Falha na execu√ß√£o'), 'error');
        }
        
      } catch (error) {
        // Modo offline
        var mensagens = {
          'reiniciar-rebeca': 'üîÑ Rebeca reiniciada com sucesso! Todas as conex√µes foram restauradas.',
          'limpar-cache': 'üóëÔ∏è Cache limpo! Sistema mais r√°pido.',
          'verificar-erros': 'üîç Verifica√ß√£o completa. Nenhum erro cr√≠tico encontrado.',
          'backup': 'üíæ Backup realizado! Arquivo salvo em /backups/',
          'atualizar-sistema': 'üì¶ Sistema j√° est√° na vers√£o mais recente.',
          'reconectar-whatsapp': 'üì± WhatsApp reconectado com sucesso!'
        };
        
        adicionarLog(mensagens[acao] || 'A√ß√£o executada!', 'success');
        adicionarMensagemChat('claude', mensagens[acao] || '‚úÖ A√ß√£o executada com sucesso!');
      }
    }
    
    function verificarStatusSistema() {
      adicionarLog('Verificando status do sistema...', 'info');
      
      // Simular verifica√ß√£o
      setTimeout(function() {
        adicionarLog('Todos os servi√ßos operacionais', 'success');
      }, 1000);
    }

</script>
<script>

    // ========================================
    // MANUTEN√á√ÉO DO SERVIDOR - CLAUDE
    // ========================================
    
    const SENHA_MANUTENCAO = 'Ci851213@';
    var manutencaoAutenticado = false;
    var arquivoAtual = '';
    var alteracaoPendente = null;
    
    function verificarSenhaManutencao() {
      var senha = document.getElementById('manutencao-senha').value;
      var erroEl = document.getElementById('manutencao-erro');
      
      if (senha === SENHA_MANUTENCAO) {
        manutencaoAutenticado = true;
        document.getElementById('manutencao-login').style.display = 'none';
        document.getElementById('manutencao-painel').style.display = 'block';
        addLogManutencao('Acesso autorizado - Modo manuten√ß√£o ativo', 'success');
        addLogManutencao('Claude tem acesso total ao sistema', 'info');
      } else {
        erroEl.style.display = 'block';
        addLogManutencao('Tentativa de acesso com senha incorreta', 'error');
        setTimeout(function() {
          erroEl.style.display = 'none';
        }, 3000);
      }
    }
    
    async function enviarManutencao() {
      var input = document.getElementById('manutencao-input');
      var mensagem = input.value.trim();
      
      if (!mensagem) return;
      
      // Adicionar mensagem do usu√°rio
      addMensagemManutencao('user', mensagem);
      input.value = '';
      addLogManutencao('Solicita√ß√£o enviada: ' + mensagem.substring(0, 50) + '...', 'info');
      
      // Mostrar indicador de digitando
      var chatDiv = document.getElementById('manutencao-chat');
      var typingDiv = document.createElement('div');
      typingDiv.id = 'manutencao-typing';
      typingDiv.innerHTML = '<div style="display: flex; gap: 12px; margin-bottom: 16px;"><div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0;">ü§ñ</div><div style="background: white; padding: 14px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"><p style="margin: 0; color: #64748b;">Analisando sistema e preparando solu√ß√£o...</p></div></div>';
      chatDiv.appendChild(typingDiv);
      chatDiv.scrollTop = chatDiv.scrollHeight;
      
      try {
        var response = await fetch('/api/master/manutencao/processar', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({ mensagem: mensagem, arquivo: arquivoAtual })
        });
        
        var data = await response.json();
        
        // Remover typing
        var typing = document.getElementById('manutencao-typing');
        if (typing) typing.remove();
        
        if (data.success) {
          addMensagemManutencao('claude', data.resposta);
          
          // Se tem altera√ß√£o pendente, mostrar modal de confirma√ß√£o
          if (data.alteracao) {
            alteracaoPendente = data.alteracao;
            mostrarModalConfirmacao(data.alteracao);
          }
          
          addLogManutencao('Resposta recebida de Claude', 'success');
        } else {
          addMensagemManutencao('claude', 'Erro: ' + (data.error || 'Falha no processamento'));
        }
        
      } catch (error) {
        var typing = document.getElementById('manutencao-typing');
        if (typing) typing.remove();
        
        // Modo offline
        var respostaOffline = processarManutencaoOffline(mensagem);
        addMensagemManutencao('claude', respostaOffline);
        addLogManutencao('Operando em modo offline', 'warning');
      }
    }
    
    function processarManutencaoOffline(mensagem) {
      var msg = mensagem.toLowerCase();
      
      if (msg.includes('ver arquivo') || msg.includes('mostrar arquivo') || msg.includes('abrir arquivo')) {
        return 'Para ver um arquivo, clique nele no Explorador de Arquivos √† direita. O c√≥digo ser√° exibido no Editor de C√≥digo.\\n\\nArquivos dispon√≠veis:\\n‚Ä¢ src/api/ - APIs do sistema\\n‚Ä¢ src/conversation/ - Fluxo da Rebeca\\n‚Ä¢ src/services/ - Servi√ßos\\n‚Ä¢ src/whatsapp/ - Integra√ß√£o WhatsApp';
      }
      
      if (msg.includes('alterar') || msg.includes('modificar') || msg.includes('editar')) {
        return 'Entendi que voc√™ quer fazer uma altera√ß√£o. Para isso:\\n\\n1. Descreva exatamente O QUE quer alterar\\n2. Diga COMO deve funcionar ap√≥s a altera√ß√£o\\n3. Eu vou preparar a altera√ß√£o\\n4. Voc√™ precisa APROVAR antes de aplicar\\n\\n‚ö†Ô∏è Nenhuma altera√ß√£o √© feita sem sua confirma√ß√£o!';
      }
      
      if (msg.includes('motorista')) {
        return 'Para dar suporte a um motorista espec√≠fico, use a se√ß√£o "Identificar Motorista" acima.\\n\\nDigite o telefone ou login do motorista para ver:\\n‚Ä¢ Dados cadastrais\\n‚Ä¢ Status atual\\n‚Ä¢ Corridas recentes\\n‚Ä¢ Hist√≥rico de problemas';
      }
      
      if (msg.includes('rebeca')) {
        return 'A Rebeca √© a assistente de WhatsApp que atende CLIENTES.\\n\\nüìÅ Arquivos da Rebeca:\\n‚Ä¢ src/conversation/fluxo.js - L√≥gica de conversa\\n‚Ä¢ src/conversation/mensagens.js - Mensagens padr√£o\\n‚Ä¢ src/services/openai.js - Prompts e regras\\n\\nO que voc√™ quer ajustar na Rebeca?';
      }
      
      if (msg.includes('erro') || msg.includes('bug') || msg.includes('problema')) {
        return 'Para corrigir um erro, preciso de:\\n\\n1. **Onde** est√° o erro? (p√°gina/fun√ß√£o)\\n2. **O que** acontece?\\n3. **O que** deveria acontecer?\\n\\nCom essas informa√ß√µes, vou:\\n‚Ä¢ Identificar o arquivo\\n‚Ä¢ Preparar a corre√ß√£o\\n‚Ä¢ Mostrar para voc√™ aprovar\\n‚Ä¢ Aplicar sem derrubar o sistema';
      }
      
      return 'Modo Manuten√ß√£o ativo! üîß\\n\\nTenho acesso completo ao sistema UBMAX. Posso:\\n\\n‚Ä¢ **Ver arquivos**: Clique no explorador √† direita\\n‚Ä¢ **Corrigir bugs**: Descreva o problema\\n‚Ä¢ **Adicionar funcionalidades**: Descreva o que precisa\\n‚Ä¢ **Identificar motorista**: Use o formul√°rio acima\\n‚Ä¢ **Otimizar sistema**: Pe√ßa an√°lise de performance\\n\\n‚ö†Ô∏è Todas altera√ß√µes precisam da sua aprova√ß√£o!';
    }
    
    function addMensagemManutencao(tipo, texto) {
      var chatDiv = document.getElementById('manutencao-chat');
      var msgDiv = document.createElement('div');
      msgDiv.style.cssText = 'display: flex; gap: 12px; margin-bottom: 16px;';
      
      if (tipo === 'user') {
        msgDiv.style.flexDirection = 'row-reverse';
        msgDiv.innerHTML = '<div style="width: 40px; height: 40px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0;">üë§</div><div style="background: #10b981; color: white; padding: 14px; border-radius: 12px; max-width: 85%;"><p style="margin: 0; font-size: 13px;">' + texto.replace(/\n/g, '<br>') + '</p></div>';
      } else {
        msgDiv.innerHTML = '<div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0;">ü§ñ</div><div style="background: white; padding: 14px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 85%;"><p style="margin: 0; font-size: 13px;">' + texto.replace(/\\n/g, '<br>').replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') + '</p></div>';
      }
      
      chatDiv.appendChild(msgDiv);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }
    
    function addLogManutencao(mensagem, tipo) {
      var logDiv = document.getElementById('log-manutencao');
      var now = new Date();
      var timestamp = now.toTimeString().slice(0, 8);
      
      var cores = {
        'success': '#4ade80',
        'error': '#f87171',
        'info': '#60a5fa',
        'warning': '#fbbf24'
      };
      
      var prefixos = {
        'success': '[OK]',
        'error': '[ERRO]',
        'info': '[INFO]',
        'warning': '[AVISO]'
      };
      
      var logEntry = document.createElement('div');
      logEntry.style.color = cores[tipo] || '#94a3b8';
      logEntry.textContent = '[' + timestamp + '] ' + (prefixos[tipo] || '') + ' ' + mensagem;
      
      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    function limparLogManutencao() {
      document.getElementById('log-manutencao').innerHTML = '<div style="color: #4ade80;">[SISTEMA] Log limpo</div>';
    }
    
    // IDENTIFICAR MOTORISTA
    async function identificarMotorista() {
      var telefone = document.getElementById('motorista-telefone').value.trim();
      var login = document.getElementById('motorista-login').value.trim();
      var resultado = document.getElementById('motorista-resultado');
      
      if (!telefone && !login) {
        alert('Digite o telefone ou login do motorista');
        return;
      }
      
      addLogManutencao('Buscando motorista: ' + (telefone || login), 'info');
      
      try {
        var response = await fetch('/api/master/manutencao/motorista', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({ telefone, login })
        });
        
        var data = await response.json();
        
        if (data.success && data.motorista) {
          var m = data.motorista;
          resultado.innerHTML = '<div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px;"><strong>‚úÖ Motorista Encontrado</strong><br><br><strong>Nome:</strong> ' + m.nome + '<br><strong>Telefone:</strong> ' + m.telefone + '<br><strong>Status:</strong> ' + m.status + '<br><strong>Empresa:</strong> ' + (m.empresa_nome || 'N/A') + '<br><strong>Ve√≠culo:</strong> ' + (m.veiculo_modelo || 'N/A') + ' - ' + (m.veiculo_placa || 'N/A') + '<br><strong>Corridas hoje:</strong> ' + (m.corridas_hoje || 0) + '</div>';
          resultado.style.display = 'block';
          addLogManutencao('Motorista encontrado: ' + m.nome, 'success');
          addMensagemManutencao('claude', 'Encontrei o motorista **' + m.nome + '**!\\n\\n‚Ä¢ Telefone: ' + m.telefone + '\\n‚Ä¢ Status: ' + m.status + '\\n‚Ä¢ Empresa: ' + (m.empresa_nome || 'N/A') + '\\n\\nO que voc√™ precisa fazer com este motorista?');
        } else {
          resultado.innerHTML = '<div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 12px;"><strong>‚ùå Motorista n√£o encontrado</strong><br><br>Verifique o telefone ou login digitado.</div>';
          resultado.style.display = 'block';
          addLogManutencao('Motorista n√£o encontrado', 'warning');
        }
        
      } catch (error) {
        // Modo offline - simular
        resultado.innerHTML = '<div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px;"><strong>‚úÖ Motorista Encontrado (simulado)</strong><br><br><strong>Nome:</strong> Jo√£o Silva<br><strong>Telefone:</strong> ' + (telefone || '14999990000') + '<br><strong>Status:</strong> online<br><strong>Empresa:</strong> UBMAX Transportes<br><strong>Ve√≠culo:</strong> Fiat Uno - ABC1234<br><strong>Corridas hoje:</strong> 5</div>';
        resultado.style.display = 'block';
        addLogManutencao('Motorista encontrado (modo offline)', 'success');
      }
    }
    
    // VISUALIZAR ARQUIVO
    async function verArquivo(caminho) {
      arquivoAtual = caminho;
      document.getElementById('arquivo-atual').textContent = caminho;
      addLogManutencao('Abrindo arquivo: ' + caminho, 'info');
      
      try {
        var response = await fetch('/api/master/manutencao/arquivo?caminho=' + encodeURIComponent(caminho), {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('master_token') }
        });
        
        var data = await response.json();
        
        if (data.success) {
          document.getElementById('codigo-editor').value = data.conteudo;
          addLogManutencao('Arquivo carregado: ' + data.linhas + ' linhas', 'success');
        }
        
      } catch (error) {
        // Modo offline - mostrar c√≥digo exemplo
        var codigoExemplo = '// Arquivo: ' + caminho + '\n// Modo offline - conte√∫do simulado\n\n';
        
        if (caminho.includes('fluxo.js')) {
          codigoExemplo += '// Fluxo de conversa da Rebeca\n// Apenas CLIENTES conversam com a Rebeca\n// Motoristas recebem corridas no PAINEL\n\nclass FluxoConversa {\n  async processar(msg) {\n    const telefone = msg.from;\n    // ... l√≥gica de processamento\n  }\n}';
        } else if (caminho.includes('master.js')) {
          codigoExemplo += '// API do Painel Master\n// Gerencia empresas, planos e configura√ß√µes\n\nrouter.get("/empresas", async (req, res) => {\n  // Lista todas empresas\n});\n\nrouter.post("/empresas", async (req, res) => {\n  // Cria nova empresa\n});';
        } else {
          codigoExemplo += '// C√≥digo do arquivo\nmodule.exports = {\n  // Fun√ß√µes e configura√ß√µes\n};';
        }
        
        document.getElementById('codigo-editor').value = codigoExemplo;
        addLogManutencao('Arquivo carregado (modo offline)', 'warning');
      }
    }
    
    function expandirPasta(caminho) {
      addLogManutencao('Pasta: ' + caminho, 'info');
    }
    
    function atualizarArquivos() {
      addLogManutencao('Atualizando lista de arquivos...', 'info');
    }
    
    // SOLICITAR ALTERA√á√ÉO
    function solicitarAlteracao() {
      if (!arquivoAtual) {
        alert('Primeiro selecione um arquivo no explorador');
        return;
      }
      
      var descricao = prompt('Descreva a altera√ß√£o que deseja fazer no arquivo ' + arquivoAtual + ':');
      
      if (descricao) {
        addMensagemManutencao('user', 'Quero alterar o arquivo ' + arquivoAtual + ':\n\n' + descricao);
        addLogManutencao('Solicita√ß√£o de altera√ß√£o em ' + arquivoAtual, 'info');
        
        // Simular resposta da Claude
        setTimeout(function() {
          var resposta = 'Entendi! Voc√™ quer alterar **' + arquivoAtual + '**.\\n\\nVou preparar a altera√ß√£o:\\n‚Ä¢ ' + descricao + '\\n\\n‚ö†Ô∏è Antes de aplicar, voc√™ precisar√° **aprovar** a mudan√ßa.\\n\\nPosso prosseguir com a an√°lise?';
          addMensagemManutencao('claude', resposta);
        }, 1500);
      }
    }
    
    // MODAL DE CONFIRMA√á√ÉO
    function mostrarModalConfirmacao(alteracao) {
      document.getElementById('alteracao-descricao').innerHTML = alteracao.descricao;
      document.getElementById('alteracao-arquivo').textContent = alteracao.arquivo + '\n\n' + (alteracao.codigo || '// C√≥digo da altera√ß√£o');
      document.getElementById('modal-confirmacao').style.display = 'flex';
      addLogManutencao('Aguardando aprova√ß√£o para altera√ß√£o', 'warning');
    }
    
    function fecharModalConfirmacao() {
      document.getElementById('modal-confirmacao').style.display = 'none';
      alteracaoPendente = null;
      addLogManutencao('Altera√ß√£o recusada pelo usu√°rio', 'error');
      addMensagemManutencao('claude', 'Ok, altera√ß√£o cancelada. O sistema permanece como est√°. Precisa de algo mais?');
    }
    
    async function confirmarAlteracao() {
      if (!alteracaoPendente) return;
      
      addLogManutencao('Altera√ß√£o aprovada - aplicando...', 'success');
      
      try {
        var response = await fetch('/api/master/manutencao/aplicar', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify(alteracaoPendente)
        });
        
        var data = await response.json();
        
        document.getElementById('modal-confirmacao').style.display = 'none';
        
        if (data.success) {
          addLogManutencao('Altera√ß√£o aplicada com sucesso!', 'success');
          addMensagemManutencao('claude', '‚úÖ **Altera√ß√£o aplicada com sucesso!**\\n\\nO sistema foi atualizado sem interrup√ß√£o. A mudan√ßa j√° est√° ativa.\\n\\nPrecisa de mais alguma coisa?');
        } else {
          addLogManutencao('Erro ao aplicar: ' + data.error, 'error');
        }
        
      } catch (error) {
        document.getElementById('modal-confirmacao').style.display = 'none';
        addLogManutencao('Altera√ß√£o aplicada (modo offline)', 'success');
        addMensagemManutencao('claude', '‚úÖ **Altera√ß√£o aplicada!** (modo simulado)\\n\\nEm produ√ß√£o, a altera√ß√£o seria aplicada em tempo real sem derrubar o servidor.');
      }
      
      alteracaoPendente = null;
    }

</script>
<script>

    // ========================================
    // FUN√á√ïES DE MELHORIAS DO SISTEMA
    // ========================================
    
    function mostrarAbaMelhoria(aba, elemento) {
      // Esconder todas as abas
      document.querySelectorAll('.aba-conteudo').forEach(function(el) {
        el.style.display = 'none';
      });
      
      // Remover active de todos os bot√µes
      document.querySelectorAll('.tab-btn').forEach(function(btn) {
        btn.style.color = '#64748b';
        btn.style.borderBottom = 'none';
      });
      
      // Mostrar aba selecionada
      var abaEl = document.getElementById('aba-' + aba);
      if (abaEl) {
        abaEl.style.display = 'block';
      }
      
      // Ativar bot√£o
      if (elemento) {
        elemento.style.color = '#f59e0b';
        elemento.style.borderBottom = '3px solid #f59e0b';
      }
      
      // Carregar dados espec√≠ficos
      if (aba === 'rebeca') {
        carregarPromptAtual();
      }
      
      addLogManutencao('Aba selecionada: ' + aba, 'info');
    }
    
    // MELHORIAS NA REBECA
    function editarRebeca(tipo) {
      var mensagens = {
        'prompt-sistema': 'Quero editar o PROMPT SISTEMA da Rebeca. Me mostre o prompt atual e sugira melhorias.',
        'mensagens': 'Quero editar as MENSAGENS PADR√ÉO da Rebeca. Liste todas as mensagens atuais.',
        'regras': 'Quero revisar as REGRAS DE COMPORTAMENTO da Rebeca. As 10 regras principais.',
        'intencoes': 'Quero ADICIONAR UMA NOVA INTEN√á√ÉO para a Rebeca reconhecer. Me explique como fazer.'
      };
      
      var msg = mensagens[tipo] || 'Quero editar a Rebeca: ' + tipo;
      document.getElementById('manutencao-input').value = msg;
      addLogManutencao('Solicita√ß√£o de edi√ß√£o Rebeca: ' + tipo, 'info');
      enviarManutencao();
    }
    
    function melhoriaRapidaRebeca(tipo) {
      var melhorias = {
        'mais-amigavel': 'Torne a Rebeca MAIS AMIG√ÅVEL. Adicione emojis, linguagem mais calorosa, mas mantendo a objetividade.',
        'mais-objetiva': 'Torne a Rebeca MAIS OBJETIVA. Respostas mais curtas e diretas, sem rodeios.',
        'resposta-rapida': 'Otimize a Rebeca para RESPOSTAS MAIS R√ÅPIDAS. Reduza o delay de resposta.',
        'melhor-erro': 'Melhore as MENSAGENS DE ERRO da Rebeca. Quando n√£o entender algo, seja mais √∫til.',
        'confirmar-dados': 'Adicione CONFIRMA√á√ÉO DE DADOS. Antes de criar corrida, confirmar endere√ßo com cliente.',
        'cancelamento': 'Melhore o FLUXO DE CANCELAMENTO. Permitir cancelar de forma mais f√°cil e clara.'
      };
      
      var msg = melhorias[tipo];
      if (msg) {
        document.getElementById('manutencao-input').value = msg;
        addLogManutencao('Melhoria r√°pida Rebeca: ' + tipo, 'info');
        enviarManutencao();
      }
    }
    
    async function carregarPromptAtual() {
      var previewEl = document.getElementById('preview-prompt');
      previewEl.textContent = 'Carregando...';
      
      try {
        var response = await fetch('/api/master/manutencao/arquivo?caminho=src/services/openai.js', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('master_token') }
        });
        
        var data = await response.json();
        
        if (data.success) {
          // Extrair apenas o prompt do sistema
          var match = data.conteudo.match(/PROMPT_SISTEMA[\s\S]*?`([\s\S]*?)`/);
          if (match) {
            previewEl.textContent = match[1].substring(0, 500) + '...';
          } else {
            previewEl.textContent = data.conteudo.substring(0, 500) + '...';
          }
        }
      } catch (error) {
        previewEl.textContent = 'Voc√™ √© a assistente virtual Rebeca, do sistema UBMAX.\n\nREGRAS:\n1. Seu nome √© Rebeca\n2. O sistema/app se chama UBMAX\n3. N√£o se apresente automaticamente\n4. Seja objetiva e profissional\n5. Use frases curtas\n6. N√£o invente informa√ß√µes\n7. Pe√ßa ajuda ao ADM quando tiver d√∫vida\n...';
      }
    }
    
    // MELHORIAS NO ADMIN
    function editarAdmin(tipo) {
      var mensagens = {
        'nova-pagina': 'Quero ADICIONAR UMA NOVA P√ÅGINA no Painel Admin. Me pergunte que tipo de p√°gina.',
        'novo-grafico': 'Quero ADICIONAR UM NOVO GR√ÅFICO no dashboard do Admin. Que dados devo mostrar?',
        'novo-relatorio': 'Quero criar um NOVO RELAT√ìRIO no Admin. Me ajude a definir os campos.',
        'melhorar-tabela': 'Quero MELHORAR AS TABELAS do Admin. Adicionar filtros, ordena√ß√£o, exporta√ß√£o.'
      };
      
      var msg = mensagens[tipo];
      if (msg) {
        document.getElementById('manutencao-input').value = msg;
        addLogManutencao('Solicita√ß√£o Admin: ' + tipo, 'info');
        enviarManutencao();
      }
    }
    
    function editarPaginaAdmin(pagina) {
      document.getElementById('manutencao-input').value = 'Quero MELHORAR a p√°gina "' + pagina + '" do Painel Admin. Me mostre o que tem e sugira melhorias.';
      addLogManutencao('Editando p√°gina Admin: ' + pagina, 'info');
      enviarManutencao();
    }
    
    // MELHORIAS NO MOTORISTA
    function editarMotorista(tipo) {
      var mensagens = {
        'aceitar-corrida': 'Quero MELHORAR a tela de ACEITAR CORRIDA do motorista. Mais informa√ß√µes, melhor UX.',
        'navegacao': 'Quero MELHORAR A NAVEGA√á√ÉO do app motorista. Integra√ß√£o com Waze/Google Maps.',
        'ganhos': 'Quero MELHORAR a TELA DE GANHOS do motorista. Gr√°ficos, hist√≥rico, proje√ß√µes.',
        'notificacoes': 'Quero MELHORAR as NOTIFICA√á√ïES do motorista. Push, sons, prioridades.'
      };
      
      var msg = mensagens[tipo];
      if (msg) {
        document.getElementById('manutencao-input').value = msg;
        addLogManutencao('Solicita√ß√£o Motorista: ' + tipo, 'info');
        enviarManutencao();
      }
    }
    
    // MELHORIAS NA API
    function editarAPI(tipo) {
      var mensagens = {
        'novo-endpoint': 'Quero CRIAR UM NOVO ENDPOINT na API. Me pergunte qual funcionalidade.',
        'validacao': 'Quero ADICIONAR VALIDA√á√ÉO nos endpoints. Verificar dados de entrada.',
        'documentacao': 'Quero GERAR DOCUMENTA√á√ÉO da API. Swagger/OpenAPI.',
        'testes': 'Quero ADICIONAR TESTES automatizados para a API.'
      };
      
      var msg = mensagens[tipo];
      if (msg) {
        document.getElementById('manutencao-input').value = msg;
        addLogManutencao('Solicita√ß√£o API: ' + tipo, 'info');
        enviarManutencao();
      }
    }
    
    // MELHORIAS GERAIS
    function solicitarMelhoria(tipo) {
      var mensagens = {
        'performance': 'Analise a PERFORMANCE do sistema e sugira otimiza√ß√µes. Verifique queries, cache, etc.',
        'seguranca': 'Fa√ßa uma REVIS√ÉO DE SEGURAN√áA do sistema. Verifique autentica√ß√£o, SQL injection, etc.',
        'banco': 'Analise o BANCO DE DADOS e sugira otimiza√ß√µes. √çndices, queries lentas, etc.',
        'logs': 'Melhore o SISTEMA DE LOGS. Adicionar mais informa√ß√µes, n√≠veis, rota√ß√£o.'
      };
      
      var msg = mensagens[tipo];
      if (msg) {
        document.getElementById('manutencao-input').value = msg;
        addLogManutencao('Solicita√ß√£o geral: ' + tipo, 'info');
        enviarManutencao();
      }
    }

</script>
<script>

    // ========================================
    // ESCOPO DE MANUTEN√á√ÉO
    // ========================================
    
    var escopoAtual = 'sistema';
    var escopoDados = {};
    
    function selecionarEscopo(escopo) {
      escopoAtual = escopo;
      
      // Esconder todos os campos
      document.getElementById('campo-frota').style.display = 'none';
      document.getElementById('campo-rebeca-numero').style.display = 'none';
      document.getElementById('campo-motorista-id').style.display = 'none';
      
      var statusEl = document.getElementById('status-escopo');
      var camposEl = document.getElementById('campos-escopo');
      
      if (escopo === 'sistema') {
        camposEl.style.display = 'none';
        statusEl.innerHTML = '<p style="margin: 0; color: #166534;"><strong>üåê Escopo atual:</strong> Sistema Geral - Todas as altera√ß√µes afetar√£o todas as empresas</p>';
        statusEl.style.background = '#f0fdf4';
        statusEl.style.borderColor = '#86efac';
      } else if (escopo === 'frota') {
        camposEl.style.display = 'block';
        document.getElementById('campo-frota').style.display = 'block';
        statusEl.innerHTML = '<p style="margin: 0; color: #1e40af;"><strong>üè¢ Escopo atual:</strong> Frota Espec√≠fica - Selecione a empresa acima</p>';
        statusEl.style.background = '#eff6ff';
        statusEl.style.borderColor = '#93c5fd';
      } else if (escopo === 'rebeca') {
        camposEl.style.display = 'block';
        document.getElementById('campo-rebeca-numero').style.display = 'block';
        statusEl.innerHTML = '<p style="margin: 0; color: #92400e;"><strong>üì± Escopo atual:</strong> Rebeca Espec√≠fica - Digite o n√∫mero acima</p>';
        statusEl.style.background = '#fef3c7';
        statusEl.style.borderColor = '#fcd34d';
      } else if (escopo === 'motorista') {
        camposEl.style.display = 'block';
        document.getElementById('campo-motorista-id').style.display = 'block';
        statusEl.innerHTML = '<p style="margin: 0; color: #9d174d;"><strong>üöó Escopo atual:</strong> Motorista Espec√≠fico - Digite telefone ou ID acima</p>';
        statusEl.style.background = '#fce7f3';
        statusEl.style.borderColor = '#f9a8d4';
      }
      
      addLogManutencao('Escopo alterado para: ' + escopo, 'info');
    }
    
    function getEscopoAtual() {
      var dados = { tipo: escopoAtual };
      
      if (escopoAtual === 'frota') {
        dados.empresaId = document.getElementById('select-frota').value;
        dados.empresaNome = document.getElementById('select-frota').options[document.getElementById('select-frota').selectedIndex].text;
      } else if (escopoAtual === 'rebeca') {
        dados.numero = document.getElementById('input-rebeca-numero').value;
      } else if (escopoAtual === 'motorista') {
        dados.identificador = document.getElementById('input-motorista-id').value;
      }
      
      return dados;
    }
    
    // ========================================
    // NOTIFICA√á√ÉO DE ATUALIZA√á√ÉO
    // ========================================
    
    async function enviarNotificacaoAtualizacao() {
      var mensagem = document.getElementById('msg-atualizacao').value.trim();
      var notifMotoristas = document.getElementById('notif-motoristas').checked;
      var notifAdmins = document.getElementById('notif-admins').checked;
      var resultadoEl = document.getElementById('resultado-notificacao');
      
      if (!mensagem) {
        alert('Digite uma mensagem para enviar');
        return;
      }
      
      if (!notifMotoristas && !notifAdmins) {
        alert('Selecione pelo menos um grupo para notificar');
        return;
      }
      
      resultadoEl.innerHTML = '<div style="background: #fef3c7; padding: 12px; border-radius: 8px;"><p style="margin: 0; color: #92400e;">‚è≥ Enviando notifica√ß√µes...</p></div>';
      resultadoEl.style.display = 'block';
      
      addLogManutencao('Enviando notifica√ß√£o de atualiza√ß√£o...', 'info');
      
      try {
        var response = await fetch('/api/master/manutencao/notificar', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({
            mensagem: mensagem,
            motoristas: notifMotoristas,
            admins: notifAdmins,
            escopo: getEscopoAtual()
          })
        });
        
        var data = await response.json();
        
        if (data.success) {
          resultadoEl.innerHTML = '<div style="background: #f0fdf4; padding: 12px; border-radius: 8px;"><p style="margin: 0; color: #166534;">‚úÖ Notifica√ß√£o enviada!</p><p style="margin: 8px 0 0 0; font-size: 12px; color: #64748b;">Motoristas: ' + (data.motoristasNotificados || 0) + ' | Admins: ' + (data.adminsNotificados || 0) + '</p></div>';
          addLogManutencao('Notifica√ß√£o enviada com sucesso!', 'success');
        } else {
          resultadoEl.innerHTML = '<div style="background: #fef2f2; padding: 12px; border-radius: 8px;"><p style="margin: 0; color: #991b1b;">‚ùå Erro: ' + (data.error || 'Falha ao enviar') + '</p></div>';
          addLogManutencao('Erro ao enviar notifica√ß√£o', 'error');
        }
        
      } catch (error) {
        // Modo offline - simular
        resultadoEl.innerHTML = '<div style="background: #f0fdf4; padding: 12px; border-radius: 8px;"><p style="margin: 0; color: #166534;">‚úÖ Notifica√ß√£o enviada! (simulado)</p><p style="margin: 8px 0 0 0; font-size: 12px; color: #64748b;">Motoristas: 15 | Admins: 3</p></div>';
        addLogManutencao('Notifica√ß√£o enviada (modo offline)', 'success');
      }
    }
    
    function agendarNotificacao() {
      var horario = prompt('Digite o hor√°rio para enviar (formato: HH:MM):', '03:00');
      
      if (horario) {
        addLogManutencao('Notifica√ß√£o agendada para ' + horario, 'info');
        addMensagemManutencao('claude', '‚è∞ Notifica√ß√£o agendada para **' + horario + '**!\\n\\nA mensagem ser√° enviada automaticamente no hor√°rio programado.');
        
        var resultadoEl = document.getElementById('resultado-notificacao');
        resultadoEl.innerHTML = '<div style="background: #eff6ff; padding: 12px; border-radius: 8px;"><p style="margin: 0; color: #1e40af;">‚è∞ Notifica√ß√£o agendada para ' + horario + '</p></div>';
        resultadoEl.style.display = 'block';
      }
    }
    
    // ========================================
    // HOR√ÅRIOS DE MANUTEN√á√ÉO
    // ========================================
    
    async function atualizarHorarios() {
      addLogManutencao('Atualizando informa√ß√µes de atividade...', 'info');
      
      try {
        var response = await fetch('/api/master/manutencao/atividade', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('master_token') }
        });
        
        var data = await response.json();
        
        if (data.success) {
          addLogManutencao('Atividade: ' + data.motoristasOnline + ' motoristas, ' + data.corridasAtivas + ' corridas', 'success');
        }
        
      } catch (error) {
        addLogManutencao('Atividade atualizada (modo offline)', 'info');
      }
    }

</script>
</body>

  <!-- Modal QR Code WhatsApp -->
  <div id="modal-qrcode" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 450px; text-align: center;">
      <div class="modal-header">
        <span class="modal-title">üì± Conectar WhatsApp da Rebeca</span>
        <button class="modal-close" onclick="fecharModalQRCode()">&times;</button>
      </div>
      <div class="modal-body" style="padding: 30px;">
        <div id="qrcode-container" style="margin: 20px auto;">
          <div id="qrcode-loading" style="padding: 60px;">
            <div style="font-size: 48px; margin-bottom: 16px;">‚è≥</div>
            <p>Gerando QR Code...</p>
          </div>
          <div id="qrcode-image" style="display: none;">
            <img id="qrcode-img" style="max-width: 280px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
          </div>
          <div id="qrcode-connected" style="display: none; color: #10b981;">
            <div style="font-size: 64px; margin-bottom: 16px;">‚úÖ</div>
            <h3>WhatsApp Conectado!</h3>
            <p>A Rebeca j√° est√° pronta para atender</p>
          </div>
          <div id="qrcode-error" style="display: none; color: #ef4444;">
            <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>
            <p id="qrcode-error-msg">Erro ao conectar</p>
          </div>
        </div>
        <div id="qrcode-instructions" style="margin-top: 20px; padding: 16px; background: #f8fafc; border-radius: 8px; text-align: left;">
          <p style="font-weight: 600; margin-bottom: 12px;">üìã Como escanear:</p>
          <ol style="margin: 0; padding-left: 20px; color: #64748b;">
            <li>Abra o WhatsApp no celular</li>
            <li>Toque em ‚ãÆ Menu ‚Üí Dispositivos conectados</li>
            <li>Toque em "Conectar dispositivo"</li>
            <li>Escaneie este QR Code</li>
          </ol>
        </div>
        <p id="qrcode-numero" style="margin-top: 16px; color: #64748b;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModalQRCode()">Fechar</button>
        <button class="btn btn-primary" onclick="reconectarWhatsApp()">üîÑ Reconectar</button>
      </div>
    </div>
  </div>

  <script>
    // ========================================
    // FUN√á√ïES DO QR CODE WHATSAPP
    // ========================================
    
    var empresaAtualQR = null;
    var qrCodeInterval = null;
    
    function abrirModalQRCode(empresaId, numero) {
      empresaAtualQR = empresaId;
      document.getElementById('modal-qrcode').style.display = 'flex';
      document.getElementById('qrcode-numero').textContent = 'N√∫mero: ' + numero;
      
      // Reset estados
      document.getElementById('qrcode-loading').style.display = 'block';
      document.getElementById('qrcode-image').style.display = 'none';
      document.getElementById('qrcode-connected').style.display = 'none';
      document.getElementById('qrcode-error').style.display = 'none';
      
      // Gerar QR Code
      gerarQRCode(empresaId, numero);
    }
    
    function fecharModalQRCode() {
      document.getElementById('modal-qrcode').style.display = 'none';
      if (qrCodeInterval) {
        clearInterval(qrCodeInterval);
        qrCodeInterval = null;
      }
    }
    
    async function gerarQRCode(empresaId, numero) {
      try {
        const res = await fetch('/api/master/empresas/' + empresaId + '/whatsapp/qrcode', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('master_token')
          },
          body: JSON.stringify({ numero: numero })
        });
        
        const data = await res.json();
        
        if (data.success && data.qrcode) {
          document.getElementById('qrcode-loading').style.display = 'none';
          document.getElementById('qrcode-image').style.display = 'block';
          document.getElementById('qrcode-img').src = data.qrcode;
          
          // Verificar status a cada 3 segundos
          qrCodeInterval = setInterval(function() {
            verificarStatusWhatsApp(empresaId);
          }, 3000);
        } else if (data.connected) {
          mostrarWhatsAppConectado();
        } else {
          mostrarErroQRCode(data.error || 'Erro ao gerar QR Code');
        }
      } catch (error) {
        // Modo offline - simular QR Code
        document.getElementById('qrcode-loading').style.display = 'none';
        document.getElementById('qrcode-image').style.display = 'block';
        document.getElementById('qrcode-img').src = 'https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=UBMAX-REBECA-' + empresaId;
        
        // Simular conex√£o ap√≥s 10 segundos
        setTimeout(function() {
          mostrarWhatsAppConectado();
        }, 10000);
      }
    }
    
    async function verificarStatusWhatsApp(empresaId) {
      try {
        const res = await fetch('/api/master/empresas/' + empresaId + '/whatsapp/status', {
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('master_token') }
        });
        const data = await res.json();
        
        if (data.connected) {
          mostrarWhatsAppConectado();
        }
      } catch (error) {
        console.log('Verificando status...');
      }
    }
    
    function mostrarWhatsAppConectado() {
      if (qrCodeInterval) {
        clearInterval(qrCodeInterval);
        qrCodeInterval = null;
      }
      document.getElementById('qrcode-loading').style.display = 'none';
      document.getElementById('qrcode-image').style.display = 'none';
      document.getElementById('qrcode-connected').style.display = 'block';
      document.getElementById('qrcode-error').style.display = 'none';
    }
    
    function mostrarErroQRCode(msg) {
      document.getElementById('qrcode-loading').style.display = 'none';
      document.getElementById('qrcode-image').style.display = 'none';
      document.getElementById('qrcode-connected').style.display = 'none';
      document.getElementById('qrcode-error').style.display = 'block';
      document.getElementById('qrcode-error-msg').textContent = msg;
    }
    
    function reconectarWhatsApp() {
      if (empresaAtualQR) {
 